<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°åˆ·å…¨æµç¨‹è®¡åˆ’ä¹¦ - æ–¹æ¡ˆé€‰æ‹©ä¸åˆåŒç”Ÿæˆ</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: "Microsoft YaHei", "PingFang SC", "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
        }
        .header h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        .content {
            padding: 30px;
        }
        /* æ ‡ç­¾é¡µæ ·å¼ */
        .tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 25px;
        }
        .tab {
            padding: 15px 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            margin-bottom: -2px;
        }
        .tab:hover {
            color: #1e3c72;
        }
        .tab.active {
            color: #1e3c72;
            border-bottom-color: #667eea;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        /* æ­¥éª¤æŒ‡ç¤ºå™¨ */
        .steps {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        .step {
            display: flex;
            align-items: center;
            color: #999;
        }
        .step-number {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #e0e0e0;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 10px;
        }
        .step.active .step-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .step.completed .step-number {
            background: #4caf50;
            color: white;
        }
        .step-line {
            width: 60px;
            height: 2px;
            background: #e0e0e0;
            margin: 0 15px;
        }
        .step.completed + .step-line,
        .step-line.completed {
            background: #4caf50;
        }
        /* è¡¨æ ¼æ ·å¼ */
        .table-wrapper {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            margin-bottom: 25px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        th {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 12px 10px;
            text-align: center;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        th:first-child {
            text-align: left;
            min-width: 280px;
        }
        th.plan-header {
            min-width: 120px;
            position: relative;
        }
        td {
            padding: 12px;
            border-bottom: 1px solid #eee;
            text-align: center;
            vertical-align: middle;
        }
        td:first-child {
            text-align: left;
            font-weight: 500;
            color: #333;
        }
        tr:hover {
            background-color: #f5f7ff;
        }
        .category-row {
            background: linear-gradient(135deg, #e8eaf6 0%, #f3e5f5 100%) !important;
        }
        .category-row td {
            font-weight: 700;
            color: #1e3c72;
            font-size: 15px;
            padding: 14px 12px;
        }
        .price-row {
            background: #fff8e1 !important;
        }
        .price-row td {
            font-weight: 700;
            color: #e65100;
            font-size: 16px;
        }
        /* æ–¹æ¡ˆåç§°ç¼–è¾‘æ ·å¼ */
        .plan-name-input {
            background: transparent;
            border: none;
            color: white;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            width: 100%;
            padding: 2px;
        }
        .plan-name-input:focus {
            outline: 2px solid #fff;
            border-radius: 4px;
            background: rgba(255,255,255,0.1);
        }
        .plan-subtitle {
            font-size: 12px;
            font-weight: normal;
            opacity: 0.8;
            margin-top: 4px;
        }
        .plan-subtitle input {
            background: transparent;
            border: none;
            color: white;
            font-size: 12px;
            text-align: center;
            width: 100%;
            opacity: 0.8;
        }
        .plan-subtitle input:focus {
            outline: 1px solid rgba(255,255,255,0.5);
            border-radius: 2px;
        }
        /* å‹¾é€‰æ¡†æ ·å¼ */
        .checkbox-cell {
            cursor: pointer;
            user-select: none;
            font-size: 18px;
        }
        .checkbox-cell:hover {
            transform: scale(1.1);
        }
        .check-mark {
            color: #4caf50;
            font-weight: bold;
        }
        .cross-mark {
            color: #f44336;
            font-weight: bold;
        }
        .empty-mark {
            color: #bdbdbd;
        }
        /* åˆ é™¤æŒ‰é’®æ ·å¼ */
        .delete-plan-btn {
            position: absolute;
            top: 2px;
            right: 2px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            line-height: 1;
            transition: all 0.2s;
        }
        .delete-plan-btn:hover {
            background: #f44336;
        }
        /* åˆåŒè¡¨å•æ ·å¼ */
        .contract-form {
            max-width: 900px;
            margin: 0 auto;
        }
        .form-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }
        .form-section h3 {
            color: #1e3c72;
            font-size: 18px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        .form-group {
            flex: 1;
        }
        .form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        /* æ–¹æ¡ˆé€‰æ‹©å¡ç‰‡ */
        .plan-cards {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        .plan-card {
            flex: 1;
            min-width: 200px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        .plan-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }
        .plan-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }
        .plan-card h4 {
            color: #1e3c72;
            font-size: 18px;
            margin-bottom: 8px;
        }
        .plan-card .price {
            color: #e65100;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        .plan-card .subtitle {
            color: #666;
            font-size: 14px;
        }
        .plan-card .check-icon {
            display: none;
            color: #4caf50;
            font-size: 24px;
            margin-top: 10px;
        }
        .plan-card.selected .check-icon {
            display: block;
        }
        /* æŒ‰é’®æ ·å¼ */
        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .btn {
            padding: 14px 35px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(17, 153, 142, 0.4);
        }
        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(245, 87, 108, 0.4);
        }
        .btn-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(79, 172, 254, 0.4);
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background: #5a6268;
        }
        .btn-large {
            padding: 18px 50px;
            font-size: 18px;
        }
        .btn-small {
            padding: 8px 16px;
            font-size: 13px;
        }
        /* æç¤ºä¿¡æ¯ */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #333;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        /* åˆåŒé¢„è§ˆæ ·å¼ */
        .contract-preview {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 40px;
            max-width: 900px;
            margin: 0 auto;
            font-size: 14px;
            line-height: 1.8;
        }
        .contract-preview h2 {
            text-align: center;
            font-size: 22px;
            margin-bottom: 20px;
            color: #333;
        }
        .contract-preview .contract-header {
            text-align: right;
            margin-bottom: 20px;
            color: #666;
        }
        .contract-preview .party-info {
            margin-bottom: 20px;
        }
        .contract-preview .party-info p {
            margin: 5px 0;
        }
        .contract-preview .section {
            margin-bottom: 20px;
        }
        .contract-preview .section-title {
            font-weight: 700;
            margin-bottom: 10px;
        }
        .contract-preview table {
            font-size: 12px;
        }
        .contract-preview .signature {
            display: flex;
            justify-content: space-between;
            margin-top: 50px;
        }
        .contract-preview .signature-box {
            width: 45%;
        }
        .contract-preview .signature-box p {
            margin: 10px 0;
        }
        /* è¯´æ˜æ¡† */
        .instructions {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px 20px;
            margin-bottom: 25px;
            border-radius: 0 8px 8px 0;
        }
        .instructions h3 {
            color: #2e7d32;
            margin-bottom: 8px;
            font-size: 16px;
        }
        .instructions p {
            color: #555;
            font-size: 14px;
            line-height: 1.8;
        }
        /* æœåŠ¡è¡¨æ ¼ - å¯ç¼–è¾‘æ ·å¼ */
        .service-section {
            margin-top: 30px;
        }
        .service-section h3 {
            color: #1e3c72;
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .editable-cell {
            cursor: text;
            min-height: 20px;
        }
        .editable-cell:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        .editable-cell:focus {
            outline: 2px solid #667eea;
            background: white;
        }
        .service-row {
            position: relative;
        }
        .service-row .delete-row-btn {
            position: absolute;
            right: -30px;
            top: 50%;
            transform: translateY(-50%);
            background: #f44336;
            border: none;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .service-row:hover .delete-row-btn {
            opacity: 1;
        }
        .service-table-container {
            position: relative;
            padding-right: 40px;
        }
        @media print {
            body {
                background: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
            }
            .tabs, .btn-group, .instructions, .steps {
                display: none !important;
            }
            .tab-content {
                display: block !important;
            }
            .contract-preview {
                border: none;
                padding: 0;
            }
        }
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            .plan-cards {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>å°åˆ·å…¨æµç¨‹è®¡åˆ’ä¹¦ - æ–¹æ¡ˆé€‰æ‹©ä¸åˆåŒç”Ÿæˆ</h1>
            <p>é€‰æ‹©æ–¹æ¡ˆé…ç½®ï¼Œå¡«å†™åˆåŒä¿¡æ¯ï¼Œä¸€é”®ç”ŸæˆåˆåŒ</p>
        </div>
        <div class="content">
            <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
            <div class="steps">
                <div class="step active" id="step1">
                    <div class="step-number">1</div>
                    <span>é€‰æ‹©æ–¹æ¡ˆ</span>
                </div>
                <div class="step-line"></div>
                <div class="step" id="step2">
                    <div class="step-number">2</div>
                    <span>å¡«å†™ä¿¡æ¯</span>
                </div>
                <div class="step-line"></div>
                <div class="step" id="step3">
                    <div class="step-number">3</div>
                    <span>ç”ŸæˆåˆåŒ</span>
                </div>
            </div>

            <!-- æ ‡ç­¾é¡µ -->
            <div class="tabs">
                <div class="tab active" onclick="switchTab('plan')">æ–¹æ¡ˆé…ç½®</div>
                <div class="tab" onclick="switchTab('info')">åˆåŒä¿¡æ¯</div>
                <div class="tab" onclick="switchTab('preview')">åˆåŒé¢„è§ˆ</div>
            </div>

            <!-- æ–¹æ¡ˆé…ç½®é¡µ -->
            <div class="tab-content active" id="tab-plan">
                <div class="instructions">
                    <h3>ğŸ“ æ“ä½œè¯´æ˜</h3>
                    <p>
                        â€¢ <strong>æ–¹æ¡ˆåç§°å¯ç¼–è¾‘</strong>ï¼šç‚¹å‡»è¡¨å¤´çš„æ–¹æ¡ˆåç§°æˆ–å‰¯æ ‡é¢˜å¯ç›´æ¥ä¿®æ”¹<br>
                        â€¢ <strong>æ·»åŠ /åˆ é™¤æ–¹æ¡ˆ</strong>ï¼šç‚¹å‡»"æ·»åŠ æ–¹æ¡ˆ"æŒ‰é’®æ–°å¢æ–¹æ¡ˆåˆ—ï¼Œç‚¹å‡»æ–¹æ¡ˆè¡¨å¤´å³ä¸Šè§’çš„ Ã— åˆ é™¤æ–¹æ¡ˆ<br>
                        â€¢ <strong>å‹¾é€‰åŠŸèƒ½</strong>ï¼šç‚¹å‡»å•å…ƒæ ¼å¯åœ¨ âœ” / âœ˜ / ç©ºç™½ ä¹‹é—´åˆ‡æ¢<br>
                        â€¢ <strong>ä»·æ ¼å¯ç¼–è¾‘</strong>ï¼šç‚¹å‡»ä»·æ ¼å•å…ƒæ ¼å¯ç›´æ¥è¾“å…¥ä»·æ ¼<br>
                        â€¢ <strong>æœåŠ¡çº§åˆ«å¯ç¼–è¾‘</strong>ï¼šç‚¹å‡»æœåŠ¡çº§åˆ«è¡¨æ ¼çš„å•å…ƒæ ¼å¯ç›´æ¥ç¼–è¾‘å†…å®¹ï¼Œå¯æ·»åŠ /åˆ é™¤æœåŠ¡çº§åˆ«<br>
                        â€¢ <strong>é€‰æ‹©æ–¹æ¡ˆ</strong>ï¼šå®Œæˆé…ç½®åï¼Œç‚¹å‡»ä¸‹æ–¹"ä¸‹ä¸€æ­¥"è¿›å…¥åˆåŒä¿¡æ¯å¡«å†™
                    </p>
                </div>
                <div class="table-wrapper">
                    <table id="mainTable">
                        <thead>
                            <tr id="headerRow">
                                <th>åŠŸèƒ½</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                        </tbody>
                    </table>
                </div>

                <div class="service-section">
                    <h3>
                        æœåŠ¡çº§åˆ«è¯´æ˜
                        <button class="btn btn-info btn-small" onclick="addServiceLevel()">â• æ·»åŠ æœåŠ¡çº§åˆ«</button>
                    </h3>
                    <div class="service-table-container">
                        <div class="table-wrapper">
                            <table id="serviceTable">
                                <thead>
                                    <tr>
                                        <th style="width:150px;">æœåŠ¡çº§åˆ«</th>
                                        <th>æœåŠ¡å†…å®¹</th>
                                        <th style="width:150px;">ä»·æ ¼</th>
                                    </tr>
                                </thead>
                                <tbody id="serviceTableBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-info" onclick="addPlan()">â• æ·»åŠ æ–¹æ¡ˆ</button>
                    <button class="btn btn-primary" onclick="exportToExcel()">ğŸ“Š å¯¼å‡ºExcel</button>
                    <button class="btn btn-warning" onclick="resetAll()">ğŸ”„ é‡ç½®</button>
                    <button class="btn btn-success btn-large" onclick="goToStep2()">ä¸‹ä¸€æ­¥ï¼šå¡«å†™åˆåŒä¿¡æ¯ â†’</button>
                </div>
            </div>

            <!-- åˆåŒä¿¡æ¯é¡µ -->
            <div class="tab-content" id="tab-info">
                <div class="contract-form">
                    <div class="instructions">
                        <h3>ğŸ“‹ é€‰æ‹©è¦ä½¿ç”¨çš„æ–¹æ¡ˆ</h3>
                        <p>è¯·ä»ä¸‹æ–¹é€‰æ‹©ä¸€ä¸ªæ–¹æ¡ˆç”¨äºç”ŸæˆåˆåŒï¼Œç„¶åå¡«å†™ç”²ä¹™åŒæ–¹ä¿¡æ¯ã€‚</p>
                    </div>

                    <div class="plan-cards" id="planCards">
                        <!-- æ–¹æ¡ˆå¡ç‰‡å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>

                    <div class="form-section">
                        <h3>ç”²æ–¹ä¿¡æ¯ï¼ˆå®¢æˆ·ï¼‰</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>å…¬å¸åç§° *</label>
                                <input type="text" id="partyA_name" placeholder="è¯·è¾“å…¥ç”²æ–¹å…¬å¸å…¨ç§°">
                            </div>
                            <div class="form-group">
                                <label>åˆåŒç¼–å·</label>
                                <input type="text" id="contract_no" placeholder="å¦‚ï¼šINV-20252155">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>å…¬å¸åœ°å€ *</label>
                                <input type="text" id="partyA_address" placeholder="è¯·è¾“å…¥ç”²æ–¹å…¬å¸åœ°å€">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>é¡¹ç›®ç»ç†å§“å</label>
                                <input type="text" id="partyA_pm_name" placeholder="è¯·è¾“å…¥é¡¹ç›®ç»ç†å§“å">
                            </div>
                            <div class="form-group">
                                <label>é¡¹ç›®ç»ç†ç”µè¯</label>
                                <input type="text" id="partyA_pm_phone" placeholder="è¯·è¾“å…¥é¡¹ç›®ç»ç†ç”µè¯">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>ä¹™æ–¹ä¿¡æ¯ï¼ˆä¾›åº”å•†ï¼‰</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>å…¬å¸åç§°</label>
                                <input type="text" id="partyB_name" value="å¹¿å·å¤šæ™®ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>å…¬å¸åœ°å€</label>
                                <input type="text" id="partyB_address" value="ä½›å±±å¸‚å—æµ·åŒºä¸‰å±±æ–°åŸå›½é™…åˆ›æ™ºå›­13B906">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>é¡¹ç›®ç»ç†å§“å</label>
                                <input type="text" id="partyB_pm_name" value="æœä¿Šè£">
                            </div>
                            <div class="form-group">
                                <label>é¡¹ç›®ç»ç†ç”µè¯</label>
                                <input type="text" id="partyB_pm_phone" value="18688891984">
                            </div>
                            <div class="form-group">
                                <label>é¡¹ç›®ç»ç†å¾®ä¿¡</label>
                                <input type="text" id="partyB_pm_wechat" value="Jorvikdu">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>ä»·æ ¼ä¸ä»˜æ¬¾</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>åŸä»·ï¼ˆä¸‡å…ƒï¼‰</label>
                                <input type="text" id="original_price" placeholder="å¦‚ï¼š52">
                            </div>
                            <div class="form-group">
                                <label>ä¼˜æƒ ä»·ï¼ˆä¸‡å…ƒï¼‰</label>
                                <input type="text" id="discount_price" placeholder="å¦‚ï¼š36.8">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>å¹´åº¦æœåŠ¡è´¹ï¼ˆå…ƒ/å¹´ï¼‰</label>
                                <input type="text" id="annual_fee" value="30000" placeholder="å¦‚ï¼š30000">
                            </div>
                            <div class="form-group">
                                <label>ä¼˜æƒ å¹´åº¦æœåŠ¡è´¹ï¼ˆå…ƒ/å¹´ï¼‰</label>
                                <input type="text" id="discount_annual_fee" placeholder="å¦‚ï¼š58000ï¼ˆå¯é€‰ï¼‰">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>ä»˜æ¬¾æ–¹å¼è¯´æ˜</label>
                                <textarea id="payment_terms" placeholder="å¦‚ï¼šåˆåŒç­¾ç½²åæ”¯ä»˜50%ï¼Œç³»ç»ŸæŠ•äº§åæ”¯ä»˜30%ï¼Œä½™æ¬¾20%åœ¨ç³»ç»Ÿä¸Šçº¿å3ä¸ªæœˆå†…ä»˜æ¸…">åˆåŒç­¾ç½²åæ”¯ä»˜50%ã€‚
åˆåŒç­¾è®¢åçš„ç¬¬ä¸€å¹´ï¼Œèµ é€ç¬¬ä¸€å¹´æœåŠ¡è´¹ã€‚
ç³»ç»ŸæŠ•äº§åï¼Œæ”¯ä»˜30%ã€‚
ä½™æ¬¾20%åœ¨ç³»ç»Ÿä¸Šçº¿å3ä¸ªæœˆå†…ä»˜æ¸…ã€‚
åˆåŒç­¾è®¢æ—¥çš„æ¯12ä¸ªæœˆï¼Œç”²æ–¹æ”¯ä»˜ä¸‹ä¸€å¹´åº¦çš„å¹´è´¹ã€‚</textarea>
                            </div>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="goToStep1()">â† ä¸Šä¸€æ­¥</button>
                        <button class="btn btn-success" onclick="saveContractInfo()">ğŸ’¾ ä¿å­˜ä¿¡æ¯</button>
                        <button class="btn btn-primary btn-large" onclick="generateContract()">ç”ŸæˆåˆåŒé¢„è§ˆ â†’</button>
                    </div>
                </div>
            </div>

            <!-- åˆåŒé¢„è§ˆé¡µ -->
            <div class="tab-content" id="tab-preview">
                <div class="contract-preview" id="contractPreview">
                    <!-- åˆåŒå†…å®¹å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="goToStep2FromPreview()">â† ä¿®æ”¹ä¿¡æ¯</button>
                    <button class="btn btn-primary" onclick="printContract()">ğŸ–¨ï¸ æ‰“å°åˆåŒ</button>
                    <button class="btn btn-success btn-large" onclick="downloadContract()">ğŸ“¥ ä¸‹è½½åˆåŒ</button>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // åŠŸèƒ½æ•°æ®
        const features = [
            { category: 'å•†åŠ¡ç³»ç»Ÿ', items: null },
            { name: 'ç§æœ‰åŒ–è½¯ä»¶éƒ¨ç½²', default2: 'âœ”', default3: 'âœ”' },
            { name: 'å•†åŠ¡ç³»ç»Ÿæ¥æ”¶è®¢å•æ–¹å¼', default2: 'âœ”', default3: 'âœ”' },
            { name: 'å®¢æˆ·ç”µè„‘è‡ªåŠ©å¼ä¸‹å•ã€æŸ¥å•', default2: 'âœ”', default3: 'âœ”' },
            { name: 'å®¢æˆ·è‡ªåŠ©å°ç¨‹åºä¸‹å•ã€æŸ¥å•', default2: 'âœ”', default3: 'âœ”' },
            { name: 'å†…éƒ¨å‘˜å·¥ä»£å®¢ä¸‹å•', default2: 'âœ”', default3: 'âœ”' },
            { name: 'å¯¹æ¥ç¬¬ä¸‰æ–¹å•†åŸ', default2: 'âœ˜', default3: 'âœ˜' },
            { name: 'ä¸‹å•å±æ€§è‡ªåŠ¨æ ¡éªŒï¼ˆé˜²æ­¢ææ–™ä¸å·¥è‰ºäº’æ–¥å‡ºé”™ï¼‰', default2: 'âœ”', default3: 'âœ”' },
            { name: 'æ ‡å‡†äº§å“æŠ¥ä»·ï¼ˆçº¸å¼ +æŠ„è¡¨+åé“è´¹ç”¨ï¼‰', default2: 'âœ”', default3: 'âœ”' },
            { name: 'ç”¨Excelè¡¨æ ¼å¼€å•', default2: 'âœ˜', default3: 'âœ”' },
            { name: 'ä»£ç†å•†æ¨¡å¼ï¼ˆç‹¬ç«‹åŸŸåã€å“ç‰Œã€æŠ¥ä»·ä½“ç³»ï¼‰', default2: 'âœ˜', default3: 'âœ˜' },
            { name: 'å¤šå“ç‰Œï¼Œå„å“ç‰Œç‹¬ç«‹æ ¸ç®—', default2: 'âœ˜', default3: 'âœ˜' },
            { category: 'å®¢æˆ·ç®¡ç†', items: null },
            { name: 'å®¢æˆ·åˆ†ç»„ç®¡ç†', default2: 'âœ”', default3: 'âœ”' },
            { name: 'é˜¶æ¢¯ä»·æ ¼', default2: 'âœ”', default3: 'âœ”' },
            { name: 'åè®®ä»·', default2: 'âœ”', default3: 'âœ”' },
            { name: 'æŒ‰é”€å”®å•æ”¶æ¬¾', default2: 'âœ”', default3: 'âœ”' },
            { name: 'æŒ‰å‘è´§å•æ”¶æ¬¾', default2: 'âœ”', default3: 'âœ”' },
            { name: 'åº”æ”¶æ¬¾å¯¹è´¦è®°é”€å¸', default2: 'âœ”', default3: 'âœ”' },
            { name: 'é€€æ¬¾ç®¡ç†', default2: 'âœ”', default3: 'âœ”' },
            { category: 'æ–‡ä»¶å¤„ç†ï¼ˆå¯¹æ¥Tflowå°å‰å¤„ç†ç³»ç»Ÿï¼‰', items: null },
            { name: 'æ–‡ä»¶å°ºå¯¸ã€é¡µæ•°ã€å•åŒé¢ã€è‰²å½©æ¨¡å¼é¢„æ£€', default2: 'âœ˜', default3: 'âœ”' },
            { name: 'æ•°ç å°åˆ·è‡ªåŠ¨æ‹¼ç‰ˆ', default2: 'âœ˜', default3: 'âœ”' },
            { name: 'è‡ªåŠ¨æ‰“è§’çº¿', default2: 'âœ˜', default3: 'âœ”' },
            { name: 'è‡ªåŠ¨æ‰“ç”Ÿäº§æ¡ç ', default2: 'âœ˜', default3: 'âœ”' },
            { name: 'æ•°ç çš„éª‘é©¬é’‰ï¼Œæ— çº¿èƒ¶è£…ã€é”çº¿ã€ç²¾è£…æ‹¼ç‰ˆ', default2: 'âœ˜', default3: 'âœ”' },
            { name: 'åˆæ‰¹æ¬¡å•ç”Ÿäº§ï¼ˆè®¢å•è“„æ°´æ± ï¼Œè‡ªåŠ¨åˆæ‰¹æ··åˆåˆç‰ˆï¼‰', default2: 'âœ˜', default3: 'âœ˜' },
            { name: 'ä¼ ç»Ÿåç‰‡ã€å•å¼ æ‹¼ç‰ˆåˆç‰ˆ', default2: 'âœ˜', default3: 'âœ˜' },
            { name: 'ä¼ ç»Ÿå°åˆ·ä¹¦åˆŠæ‹¼ç‰ˆã€åˆç‰ˆ', default2: 'âœ˜', default3: 'âœ˜' },
            { name: 'åªæ¥å—åšå¥½çš„PDFæ–‡ä»¶ï¼ˆåŒ…å«å‡ºè¡€ï¼‰', default2: 'âœ”', default3: 'âœ”' },
            { name: 'åŒ…è£…äº§å“ï¼ˆéª‘é©¬è®¢ã€é”çº¿èƒ¶è£…ï¼‰', default2: 'âœ˜', default3: 'âœ˜' },
            { name: 'CDRã€AIæ–‡ä»¶è‡ªåŠ¨è½¬æˆPDF', default2: 'âœ˜', default3: 'âœ˜' },
            { name: 'è‡ªåŠ¨åˆ†ç¦»åˆ€çº¿', default2: 'âœ˜', default3: 'âœ”' },
            { category: 'ç”Ÿäº§ç®¡ç†', items: null },
            { name: 'ç”Ÿäº§è¿›åº¦ç›‘æ§', default2: 'âœ”', default3: 'âœ”' },
            { name: 'åé“è®¾å¤‡ï¼ˆè¦†è†œã€è£åˆ‡ï¼‰', default2: 'âœ”', default3: 'âœ”' },
            { name: 'ç‰©æ–™ä½¿ç”¨è®¡ç®—ï¼Œåº“å­˜æ‰£å‡', default2: 'âœ˜', default3: 'âœ”' },
            { name: 'ç¼©ç•¥å›¾æ˜¾ç¤º', default2: 'âœ”', default3: 'âœ”' },
            { name: 'è‡ªå®šä¹‰å·¥å•æ ·å¼', default2: 'âœ”', default3: 'âœ”' },
            { name: 'åˆ€ç‰ˆç®¡ç†', default2: 'âœ˜', default3: 'âœ˜' },
            { name: 'å¥—åŸæœ‰åˆ€ç‰ˆ', default2: 'âœ˜', default3: 'âœ˜' },
            { name: 'å¤šç”Ÿäº§ç«™ç‚¹ï¼ˆæ‰«ç ç”Ÿäº§ç®¡ç†ã€å‡ºè´§ï¼‰', default2: 'âœ˜', default3: 'âœ˜' },
            { category: 'è´¢åŠ¡ç®¡ç†', items: null },
            { name: 'å¾€æ¥æµæ°´è´¦', default2: 'âœ”', default3: 'âœ”' },
            { name: 'å¾€æ¥è´¦', default2: 'âœ”', default3: 'âœ”' },
            { name: 'ä¸šåŠ¡å‘˜è´Ÿè´£å®¢æˆ·ç®¡ç†', default2: 'âœ”', default3: 'âœ”' },
            { name: 'é€€æ¬¾ç®¡ç†', default2: 'âœ”', default3: 'âœ”' },
            { name: 'è‡ªå®šä¹‰å‘˜å·¥ç»©æ•ˆè®¡ç®—ï¼ˆExcelè¡¨æ ¼è®¡ç®—ï¼‰', default2: 'âœ˜', default3: 'âœ”' },
            { category: 'é«˜çº§è´¢åŠ¡ï¼ˆä¸šè´¢èåˆï¼‰', items: null },
            { name: 'å¯¹æ¥é‡‘è¶ï¼ˆé‡‘è¶å®æ–½è´¹ç”¨ç”²æ–¹è‡ªè¡Œç­¾åˆåŒï¼‰', default2: 'âœ˜', default3: 'âœ˜' },
            { name: 'åˆ†ç±»æ˜ç»†è´¦', default2: 'âœ˜', default3: 'âœ˜' },
            { name: 'åˆ†ç±»æ€»è´¦', default2: 'âœ˜', default3: 'âœ˜' },
            { name: 'é“¶è¡Œæ—¥è®°è´¦', default2: 'âœ˜', default3: 'âœ˜' },
            { name: 'ç°é‡‘æ—¥è®°è´¦', default2: 'âœ˜', default3: 'âœ˜' },
            { name: 'èµ„äº§è´Ÿå€ºè¡¨ã€ç°é‡‘æµé‡è¡¨ã€åˆ©æ¶¦è¡¨', default2: 'âœ˜', default3: 'âœ˜' },
            { name: 'ç”Ÿäº§æˆæœ¬ä¼šè®¡æ ¸ç®—ã€ç»“è½¬', default2: 'âœ˜', default3: 'âœ˜' },
            { category: 'å‘è´§ç®¡ç†', items: null },
            { name: 'æ‰‹å·¥å¡«å…¥è®¡ç®—è¿è´¹', default2: 'âœ”', default3: 'âœ”' },
            { name: 'è‡ªåŠ¨è®¡ç®—è¿è´¹', default2: 'âœ˜', default3: 'âœ˜' },
            { name: 'å¯¹æ¥é¡ºä¸°', default2: 'âœ”', default3: 'âœ”' },
            { name: 'å¯¹æ¥å¿«é€’100', default2: 'âœ”', default3: 'âœ”' },
            { name: 'åˆ†æ‰¹æ¬¡å‘è´§', default2: 'âœ”', default3: 'âœ”' },
            { name: 'å¤šåœ°å€å‘è´§', default2: 'âœ”', default3: 'âœ”' },
            { category: 'æœåŠ¡', items: null },
            { name: 'ç°åœºæœåŠ¡ï¼ˆä¸¤å‘¨ï¼‰', default2: 'âœ”', default3: 'âœ”' },
            { name: '5x8å°æ—¶å”®åæœåŠ¡', default2: 'âœ”', default3: 'âœ”' },
            { name: 'å¹´åº¦æœåŠ¡è´¹', default2: 'âœ”', default3: 'âœ”' }
        ];

        // é»˜è®¤æ–¹æ¡ˆé…ç½®
        const defaultPlans = [
            { id: 1, name: 'æ–¹æ¡ˆä¸€', subtitle: 'è‡ªå®šä¹‰', price: '', editable: true },
            { id: 2, name: 'æ–¹æ¡ˆäºŒ', subtitle: 'ç»æµå‹', price: '15ä¸‡', editable: false },
            { id: 3, name: 'æ–¹æ¡ˆä¸‰', subtitle: 'å…¨å¥—', price: '49ä¸‡', editable: false }
        ];

        // é»˜è®¤æœåŠ¡çº§åˆ«æ•°æ®
        const defaultServiceLevels = [
            {
                id: 1,
                level: 'æ‰€æœ‰çº§åˆ«å…±ç”¨',
                content: '1. è½¯ä»¶Bugä¿®æ­£\n2. è½¯ä»¶å‡çº§\n3. å¬å–å®¢æˆ·ä¿®æ”¹åŠå‡çº§æ„è§\n4. å¦‚åˆåŒæ¨¡å—æœ‰ç›¸åº”çº¦å®šï¼Œä¸Šäº†æŸäº›æ¨¡å—åå¿…é¡»è´­ä¹°2çº§åˆ«ä»¥ä¸ŠæœåŠ¡\n5. è‹¥å®¢æˆ·è´­ä¹°äº†1çº§åˆ«æœåŠ¡ï¼Œæƒ³å®šåˆ¶å…¶ä»–åŠŸèƒ½ï¼Œç”²ä¹™åŒæ–¹å¯å•†è®¨è´¹ç”¨',
                price: '-'
            },
            {
                id: 2,
                level: 'çº§åˆ«1',
                content: '1. æ ‡å‡†å¹´åº¦å‡çº§\n2. 5x8å°æ—¶æ ‡å‡†æœåŠ¡ï¼ˆå‘¨ä¸€è‡³å‘¨äº” 9:00-18:00ï¼‰\n3. æ ‡å‡†æ‹¼ç‰ˆæ–¹æ³•\n4. ç¬¬ä¸€æ¬¡ç°åœºæœåŠ¡ä¸¤å¤©ï¼Œå…¶ä½™è¿œç¨‹æœåŠ¡',
                price: 'Â¥30,000/å¹´'
            },
            {
                id: 3,
                level: 'çº§åˆ«2',
                content: 'å®šåˆ¶åŒ–å”®åæœåŠ¡ï¼Œå¦‚æœåŠ¡æ—¶é—´ã€å®šåˆ¶åŒ–å†…å®¹ä¿®æ”¹',
                price: 'åŒæ–¹å•†è®¨'
            }
        ];

        // å½“å‰æ–¹æ¡ˆæ•°æ®
        let plans = [];
        // å½“å‰å‹¾é€‰æ•°æ®
        let checkData = {};
        // é€‰ä¸­çš„æ–¹æ¡ˆç´¢å¼•
        let selectedPlanIndex = -1;
        // åˆåŒä¿¡æ¯
        let contractInfo = {};
        // æœåŠ¡çº§åˆ«æ•°æ®
        let serviceLevels = [];

        // åˆå§‹åŒ–
        function init() {
            loadFromLocal();
            renderTable();
            renderServiceTable();
            renderPlanCards();
            loadContractInfo();
        }

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            document.querySelector(`.tab:nth-child(${tabName === 'plan' ? 1 : tabName === 'info' ? 2 : 3})`).classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
            updateSteps(tabName === 'plan' ? 1 : tabName === 'info' ? 2 : 3);
        }

        // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
        function updateSteps(currentStep) {
            for (let i = 1; i <= 3; i++) {
                const step = document.getElementById(`step${i}`);
                step.classList.remove('active', 'completed');
                if (i < currentStep) {
                    step.classList.add('completed');
                } else if (i === currentStep) {
                    step.classList.add('active');
                }
            }
        }

        // æ¸²æŸ“è¡¨æ ¼
        function renderTable() {
            renderHeader();
            renderBody();
        }

        // æ¸²æŸ“è¡¨å¤´
        function renderHeader() {
            const headerRow = document.getElementById('headerRow');
            while (headerRow.children.length > 1) {
                headerRow.removeChild(headerRow.lastChild);
            }
            
            plans.forEach((plan, index) => {
                const th = document.createElement('th');
                th.className = 'plan-header';
                th.innerHTML = `
                    <input type="text" class="plan-name-input" value="${plan.name}" 
                           onchange="updatePlanName(${index}, this.value)" 
                           onclick="event.stopPropagation()">
                    <div class="plan-subtitle">
                        <input type="text" value="${plan.subtitle}" 
                               onchange="updatePlanSubtitle(${index}, this.value)"
                               onclick="event.stopPropagation()"
                               placeholder="å‰¯æ ‡é¢˜">
                    </div>
                    ${plans.length > 1 ? `<button class="delete-plan-btn" onclick="deletePlan(${index})" title="åˆ é™¤æ­¤æ–¹æ¡ˆ">Ã—</button>` : ''}
                `;
                headerRow.appendChild(th);
            });
        }

        // æ¸²æŸ“è¡¨æ ¼å†…å®¹
        function renderBody() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            // ä»·æ ¼è¡Œ
            const priceRow = document.createElement('tr');
            priceRow.className = 'price-row';
            priceRow.innerHTML = '<td>ä»·æ ¼</td>';
            plans.forEach((plan, index) => {
                const td = document.createElement('td');
                td.contentEditable = 'true';
                td.textContent = plan.price;
                td.onblur = function() {
                    plans[index].price = this.textContent;
                    saveToLocal();
                    renderPlanCards();
                };
                priceRow.appendChild(td);
            });
            tbody.appendChild(priceRow);
            
            // åŠŸèƒ½è¡Œ
            features.forEach((feature, fIndex) => {
                const tr = document.createElement('tr');
                
                if (feature.category) {
                    tr.className = 'category-row';
                    tr.innerHTML = `<td colspan="${plans.length + 1}">${feature.category}</td>`;
                } else {
                    tr.innerHTML = `<td>${feature.name}</td>`;
                    plans.forEach((plan, pIndex) => {
                        const td = document.createElement('td');
                        td.className = 'checkbox-cell';
                        td.onclick = function() { toggleCheck(this, fIndex, pIndex); };
                        
                        const key = `${fIndex}_${pIndex}`;
                        let value = checkData[key];
                        
                        if (value === undefined) {
                            if (pIndex === 0) {
                                value = '';
                            } else if (pIndex === 1) {
                                value = feature.default2 || '';
                            } else if (pIndex === 2) {
                                value = feature.default3 || '';
                            } else {
                                value = '';
                            }
                        }
                        
                        td.textContent = value;
                        if (value === 'âœ”') {
                            td.className = 'checkbox-cell check-mark';
                        } else if (value === 'âœ˜') {
                            td.className = 'checkbox-cell cross-mark';
                        } else {
                            td.className = 'checkbox-cell empty-mark';
                        }
                        tr.appendChild(td);
                    });
                }
                tbody.appendChild(tr);
            });
        }

        // æ¸²æŸ“æœåŠ¡çº§åˆ«è¡¨æ ¼
        function renderServiceTable() {
            const tbody = document.getElementById('serviceTableBody');
            tbody.innerHTML = '';
            
            serviceLevels.forEach((service, index) => {
                const tr = document.createElement('tr');
                tr.className = 'service-row';
                tr.innerHTML = `
                    <td>
                        <div class="editable-cell" contenteditable="true" 
                             onblur="updateServiceLevel(${index}, 'level', this.textContent)">${service.level}</div>
                    </td>
                    <td style="text-align:left;">
                        <div class="editable-cell" contenteditable="true" 
                             style="white-space: pre-wrap;"
                             onblur="updateServiceLevel(${index}, 'content', this.textContent)">${service.content}</div>
                    </td>
                    <td>
                        <div class="editable-cell" contenteditable="true" 
                             onblur="updateServiceLevel(${index}, 'price', this.textContent)">${service.price}</div>
                    </td>
                    ${serviceLevels.length > 1 ? `<button class="delete-row-btn" onclick="deleteServiceLevel(${index})" title="åˆ é™¤">Ã—</button>` : ''}
                `;
                tbody.appendChild(tr);
            });
        }

        // æ›´æ–°æœåŠ¡çº§åˆ«
        function updateServiceLevel(index, field, value) {
            serviceLevels[index][field] = value;
            saveToLocal();
        }

        // æ·»åŠ æœåŠ¡çº§åˆ«
        function addServiceLevel() {
            const newId = serviceLevels.length + 1;
            serviceLevels.push({
                id: newId,
                level: `çº§åˆ«${newId}`,
                content: 'è¯·è¾“å…¥æœåŠ¡å†…å®¹',
                price: 'å¾…å®š'
            });
            renderServiceTable();
            saveToLocal();
            showToast('å·²æ·»åŠ æ–°æœåŠ¡çº§åˆ«');
        }

        // åˆ é™¤æœåŠ¡çº§åˆ«
        function deleteServiceLevel(index) {
            if (serviceLevels.length <= 1) {
                showToast('è‡³å°‘ä¿ç•™ä¸€ä¸ªæœåŠ¡çº§åˆ«');
                return;
            }
            if (confirm(`ç¡®å®šè¦åˆ é™¤"${serviceLevels[index].level}"å—ï¼Ÿ`)) {
                serviceLevels.splice(index, 1);
                renderServiceTable();
                saveToLocal();
                showToast('å·²åˆ é™¤æœåŠ¡çº§åˆ«');
            }
        }

        // æ¸²æŸ“æ–¹æ¡ˆé€‰æ‹©å¡ç‰‡
        function renderPlanCards() {
            const container = document.getElementById('planCards');
            container.innerHTML = '';
            
            plans.forEach((plan, index) => {
                const card = document.createElement('div');
                card.className = 'plan-card' + (selectedPlanIndex === index ? ' selected' : '');
                card.onclick = function() { selectPlan(index); };
                card.innerHTML = `
                    <h4>${plan.name}</h4>
                    <div class="price">${plan.price || 'å¾…å®š'}</div>
                    <div class="subtitle">${plan.subtitle}</div>
                    <div class="check-icon">âœ“</div>
                `;
                container.appendChild(card);
            });
        }

        // é€‰æ‹©æ–¹æ¡ˆ
        function selectPlan(index) {
            selectedPlanIndex = index;
            renderPlanCards();
            
            // è‡ªåŠ¨å¡«å……ä»·æ ¼
            const plan = plans[index];
            if (plan.price) {
                const priceNum = plan.price.replace(/[^0-9.]/g, '');
                document.getElementById('original_price').value = priceNum;
            }
            
            saveToLocal();
            showToast(`å·²é€‰æ‹© ${plan.name}`);
        }

        // åˆ‡æ¢å‹¾é€‰çŠ¶æ€
        function toggleCheck(cell, featureIndex, planIndex) {
            const currentText = cell.textContent.trim();
            let newValue;
            if (currentText === 'âœ”') {
                newValue = 'âœ˜';
                cell.className = 'checkbox-cell cross-mark';
            } else if (currentText === 'âœ˜') {
                newValue = '';
                cell.className = 'checkbox-cell empty-mark';
            } else {
                newValue = 'âœ”';
                cell.className = 'checkbox-cell check-mark';
            }
            cell.textContent = newValue;
            
            const key = `${featureIndex}_${planIndex}`;
            checkData[key] = newValue;
            saveToLocal();
        }

        // æ›´æ–°æ–¹æ¡ˆåç§°
        function updatePlanName(index, value) {
            plans[index].name = value;
            saveToLocal();
            renderPlanCards();
        }

        // æ›´æ–°æ–¹æ¡ˆå‰¯æ ‡é¢˜
        function updatePlanSubtitle(index, value) {
            plans[index].subtitle = value;
            saveToLocal();
            renderPlanCards();
        }

        // æ·»åŠ æ–¹æ¡ˆ
        function addPlan() {
            const newId = plans.length + 1;
            plans.push({
                id: newId,
                name: `æ–¹æ¡ˆ${numberToChinese(newId)}`,
                subtitle: 'è‡ªå®šä¹‰',
                price: '',
                editable: true
            });
            renderTable();
            renderPlanCards();
            saveToLocal();
            showToast('å·²æ·»åŠ æ–°æ–¹æ¡ˆ');
        }

        // åˆ é™¤æ–¹æ¡ˆ
        function deletePlan(index) {
            if (plans.length <= 1) {
                showToast('è‡³å°‘ä¿ç•™ä¸€ä¸ªæ–¹æ¡ˆ');
                return;
            }
            if (confirm(`ç¡®å®šè¦åˆ é™¤"${plans[index].name}"å—ï¼Ÿ`)) {
                plans.splice(index, 1);
                const newCheckData = {};
                Object.keys(checkData).forEach(key => {
                    const [fIdx, pIdx] = key.split('_').map(Number);
                    if (pIdx < index) {
                        newCheckData[key] = checkData[key];
                    } else if (pIdx > index) {
                        newCheckData[`${fIdx}_${pIdx - 1}`] = checkData[key];
                    }
                });
                checkData = newCheckData;
                if (selectedPlanIndex === index) {
                    selectedPlanIndex = -1;
                } else if (selectedPlanIndex > index) {
                    selectedPlanIndex--;
                }
                renderTable();
                renderPlanCards();
                saveToLocal();
                showToast('å·²åˆ é™¤æ–¹æ¡ˆ');
            }
        }

        // æ•°å­—è½¬ä¸­æ–‡
        function numberToChinese(num) {
            const chinese = ['é›¶', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'ä¸ƒ', 'å…«', 'ä¹', 'å'];
            if (num <= 10) return chinese[num];
            if (num < 20) return 'å' + (num % 10 === 0 ? '' : chinese[num % 10]);
            return num.toString();
        }

        // æ˜¾ç¤ºæç¤º
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        function saveToLocal() {
            const data = {
                plans: plans,
                checkData: checkData,
                selectedPlanIndex: selectedPlanIndex,
                serviceLevels: serviceLevels
            };
            localStorage.setItem('contractSystemData', JSON.stringify(data));
        }

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½
        function loadFromLocal() {
            const saved = localStorage.getItem('contractSystemData');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    plans = data.plans || JSON.parse(JSON.stringify(defaultPlans));
                    checkData = data.checkData || {};
                    selectedPlanIndex = data.selectedPlanIndex !== undefined ? data.selectedPlanIndex : -1;
                    serviceLevels = data.serviceLevels || JSON.parse(JSON.stringify(defaultServiceLevels));
                } catch (e) {
                    plans = JSON.parse(JSON.stringify(defaultPlans));
                    checkData = {};
                    selectedPlanIndex = -1;
                    serviceLevels = JSON.parse(JSON.stringify(defaultServiceLevels));
                }
            } else {
                plans = JSON.parse(JSON.stringify(defaultPlans));
                checkData = {};
                selectedPlanIndex = -1;
                serviceLevels = JSON.parse(JSON.stringify(defaultServiceLevels));
            }
        }

        // ä¿å­˜åˆåŒä¿¡æ¯
        function saveContractInfo() {
            contractInfo = {
                partyA_name: document.getElementById('partyA_name').value,
                partyA_address: document.getElementById('partyA_address').value,
                partyA_pm_name: document.getElementById('partyA_pm_name').value,
                partyA_pm_phone: document.getElementById('partyA_pm_phone').value,
                partyB_name: document.getElementById('partyB_name').value,
                partyB_address: document.getElementById('partyB_address').value,
                partyB_pm_name: document.getElementById('partyB_pm_name').value,
                partyB_pm_phone: document.getElementById('partyB_pm_phone').value,
                partyB_pm_wechat: document.getElementById('partyB_pm_wechat').value,
                contract_no: document.getElementById('contract_no').value,
                original_price: document.getElementById('original_price').value,
                discount_price: document.getElementById('discount_price').value,
                annual_fee: document.getElementById('annual_fee').value,
                discount_annual_fee: document.getElementById('discount_annual_fee').value,
                payment_terms: document.getElementById('payment_terms').value
            };
            localStorage.setItem('contractInfo', JSON.stringify(contractInfo));
            showToast('åˆåŒä¿¡æ¯å·²ä¿å­˜');
        }

        // åŠ è½½åˆåŒä¿¡æ¯
        function loadContractInfo() {
            const saved = localStorage.getItem('contractInfo');
            if (saved) {
                contractInfo = JSON.parse(saved);
                Object.keys(contractInfo).forEach(key => {
                    const el = document.getElementById(key);
                    if (el) el.value = contractInfo[key];
                });
            }
        }

        // é‡ç½®å…¨éƒ¨
        function resetAll() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ•°æ®å—ï¼Ÿ')) {
                localStorage.removeItem('contractSystemData');
                plans = JSON.parse(JSON.stringify(defaultPlans));
                checkData = {};
                selectedPlanIndex = -1;
                serviceLevels = JSON.parse(JSON.stringify(defaultServiceLevels));
                renderTable();
                renderServiceTable();
                renderPlanCards();
                showToast('å·²é‡ç½®');
            }
        }

        // æ­¥éª¤å¯¼èˆª
        function goToStep1() {
            switchTab('plan');
        }

        function goToStep2() {
            renderPlanCards();
            switchTab('info');
        }

        function goToStep2FromPreview() {
            switchTab('info');
        }

        // ç”ŸæˆåˆåŒ
        function generateContract() {
            saveContractInfo();
            
            if (selectedPlanIndex === -1) {
                showToast('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ–¹æ¡ˆ');
                return;
            }
            
            if (!document.getElementById('partyA_name').value) {
                showToast('è¯·å¡«å†™ç”²æ–¹å…¬å¸åç§°');
                return;
            }
            
            const plan = plans[selectedPlanIndex];
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth() + 1;
            
            // è·å–é€‰ä¸­æ–¹æ¡ˆçš„åŠŸèƒ½åˆ—è¡¨
            let featureTableHtml = '<table style="width:100%;border-collapse:collapse;font-size:12px;"><thead><tr><th style="border:1px solid #333;padding:8px;background:#f0f0f0;text-align:left;">åŠŸèƒ½</th><th style="border:1px solid #333;padding:8px;background:#f0f0f0;text-align:center;width:80px;">çŠ¶æ€</th></tr></thead><tbody>';
            
            features.forEach((feature, fIndex) => {
                if (feature.category) {
                    featureTableHtml += `<tr><td colspan="2" style="border:1px solid #333;padding:8px;background:#e8eaf6;font-weight:bold;">${feature.category}</td></tr>`;
                } else {
                    const key = `${fIndex}_${selectedPlanIndex}`;
                    let value = checkData[key];
                    if (value === undefined) {
                        if (selectedPlanIndex === 0) value = '';
                        else if (selectedPlanIndex === 1) value = feature.default2 || '';
                        else if (selectedPlanIndex === 2) value = feature.default3 || '';
                        else value = '';
                    }
                    const statusColor = value === 'âœ”' ? '#4caf50' : value === 'âœ˜' ? '#f44336' : '#999';
                    featureTableHtml += `<tr><td style="border:1px solid #333;padding:6px;">${feature.name}</td><td style="border:1px solid #333;padding:6px;text-align:center;color:${statusColor};font-weight:bold;">${value || '-'}</td></tr>`;
                }
            });
            featureTableHtml += '</tbody></table>';

            // ç”ŸæˆæœåŠ¡çº§åˆ«è¡¨æ ¼
            let serviceTableHtml = '<table style="width:100%;border-collapse:collapse;font-size:12px;margin-top:15px;"><thead><tr><th style="border:1px solid #333;padding:8px;background:#f0f0f0;">æœåŠ¡çº§åˆ«</th><th style="border:1px solid #333;padding:8px;background:#f0f0f0;">æœåŠ¡å†…å®¹</th><th style="border:1px solid #333;padding:8px;background:#f0f0f0;">ä»·æ ¼</th></tr></thead><tbody>';
            
            serviceLevels.forEach(service => {
                serviceTableHtml += `<tr>
                    <td style="border:1px solid #333;padding:8px;font-weight:bold;">${service.level}</td>
                    <td style="border:1px solid #333;padding:8px;text-align:left;white-space:pre-wrap;">${service.content}</td>
                    <td style="border:1px solid #333;padding:8px;font-weight:bold;">${service.price}</td>
                </tr>`;
            });
            serviceTableHtml += '</tbody></table>';
            
            const contractHtml = `
                <h2>è½¯ä»¶ä½¿ç”¨è®¸å¯åŠæŠ€æœ¯å’¨è¯¢ã€æŠ€æœ¯å¼€å‘åˆåŒ</h2>
                <div class="contract-header">
                    <p>åˆåŒç¼–å·ï¼š${contractInfo.contract_no || 'INV-' + year + Math.floor(Math.random() * 10000)}</p>
                </div>
                
                <div class="party-info">
                    <p><strong>ç”²æ–¹ï¼š</strong>${contractInfo.partyA_name}</p>
                    <p><strong>åœ°å€ï¼š</strong>${contractInfo.partyA_address}</p>
                    <p><strong>ä¹™æ–¹ï¼š</strong>${contractInfo.partyB_name}</p>
                    <p><strong>åœ°å€ï¼š</strong>${contractInfo.partyB_address}</p>
                </div>
                
                <div class="section">
                    <p>ç”²ä¹™åŒæ–¹ç»å‹å¥½åå•†è¾¾æˆå¦‚ä¸‹åè®®ï¼Œä»¥å…±åŒéµå®ˆï¼š</p>
                    <p>1. ç”²æ–¹å‘ä¹™æ–¹è´­ä¹°"OPSæ¥å•åŠç”Ÿäº§ç®¡ç†ç³»ç»ŸåŠTflowå°å‰è‡ªåŠ¨åŒ–ç³»ç»Ÿ"ä½¿ç”¨æˆæƒåŠç›¸åº”çš„è½¯ä»¶å¼€å‘ã€æŠ€æœ¯å’¨è¯¢ç­‰æœåŠ¡ï¼›</p>
                </div>
                
                <div class="section">
                    <p class="section-title">2. åˆåŒæ€»åˆ™ï¼š</p>
                    <p>æœ¬åˆåŒæ¬²è¾¾æˆçš„ç›®çš„ä¸ºï¼š</p>
                    <p>1) ç”²æ–¹é€šè¿‡ä¹™æ–¹äº¤ä»˜çš„ç³»ç»Ÿæˆ–æœåŠ¡ï¼Œå…¶å®¢æˆ·æˆ–å†…éƒ¨è½¯ä»¶èƒ½å°†æ–‡ä»¶ï¼Œé€šè¿‡è®¢å•ç³»ç»Ÿæ¥å…¥ï¼Œè¿›è¡Œç”Ÿäº§è®¢å•ç®¡ç†ã€å‘è´§ç®¡ç†ï¼›</p>
                    <p>2) ä¹™æ–¹è®¢å•ç®¡ç†ç³»ç»Ÿå°†ç”Ÿäº§æ–‡ä»¶å¯¹æ¥åˆ°ç”²æ–¹å°åˆ·è®¾å¤‡çš„çƒ­æ–‡ä»¶å¤¹æˆ–è€…JDFå…¥å£ï¼›</p>
                    <p>3) ç”²æ–¹é€šè¿‡ç”Ÿäº§ç®¡ç†ç³»ç»Ÿï¼Œèƒ½çŸ¥é“ç›®å‰è®¾å¤‡å°åˆ·åˆ°å“ªä¸ªæ–‡ä»¶ï¼Œè®¢å•çš„ç”Ÿäº§çŠ¶æ€ï¼›</p>
                    <p>4) åœ¨åˆåŒå±¥è¡Œè¿‡ç¨‹ä¸­è‹¥é‡åˆ°åˆ†æ­§æˆ–éšœç¢ï¼Œç”²ä¹™åŒæ–¹åº”ä»¥æœ‰åˆ©äºå®ç°åˆåŒç›®çš„åŠä¿ƒè¿›äº¤æ˜“çš„åŸåˆ™å±¥è¡ŒåˆåŒã€è§£é‡ŠåˆåŒï¼›</p>
                    <p>5) æœ¬åˆåŒæˆæƒçš„è½¯ä»¶ä¸ªæ•°ä¸ºé’ˆå¯¹å£¹ä¸ªOPSçš„æˆæƒåŠå£¹ä¸ªæ‹¼ç‰ˆè½¯ä»¶æˆæƒï¼Œå¦‚éœ€å¢åŠ ï¼Œå¦è¡Œæ”¯ä»˜è´¹ç”¨ï¼›</p>
                </div>
                
                <div class="section">
                    <p class="section-title">é¡¹ç›®ç»ç†ä¿¡æ¯ï¼š</p>
                    <p><strong>ç”²æ–¹é¡¹ç›®ç»ç†ï¼š</strong>${contractInfo.partyA_pm_name || '________'}ï¼Œç”µè¯ï¼š${contractInfo.partyA_pm_phone || '________'}</p>
                    <p><strong>ä¹™æ–¹é¡¹ç›®ç»ç†ï¼š</strong>${contractInfo.partyB_pm_name}ï¼Œç”µè¯ï¼š${contractInfo.partyB_pm_phone}ï¼Œå¾®ä¿¡ï¼š${contractInfo.partyB_pm_wechat}</p>
                </div>
                
                <div class="section">
                    <p class="section-title">ä¸€ã€è½¯ä»¶è®¸å¯è¯è´¹ç”¨ã€ç»´æŠ¤è´¹</p>
                    <p>æœ¬åˆåŒæ‰€æœ‰ä»·æ ¼å«ç¨è´¹ã€‚æœ¬åˆåŒæ‰€æœ‰ä»·æ ¼å«1%å¢å€¼ç¨ä¸“ç”¨å‘ç¥¨ã€‚</p>
                    <p><strong>é€‰ç”¨æ–¹æ¡ˆï¼š${plan.name}ï¼ˆ${plan.subtitle}ï¼‰</strong></p>
                    <p>è½¯ä»¶ç³»ç»Ÿæˆæƒä½¿ç”¨å†…å®¹åŠç›¸åº”å¼€å‘ã€æŠ€æœ¯å’¨è¯¢æœåŠ¡å¦‚ä¸‹ï¼š</p>
                    ${featureTableHtml}
                    <p style="margin-top:20px;"><strong>æœåŠ¡çº§åˆ«è¯´æ˜ï¼š</strong></p>
                    ${serviceTableHtml}
                </div>
                
                <div class="section">
                    <p class="section-title">äºŒã€ä»˜æ¬¾æ–¹å¼</p>
                    <p><strong>æ€»ä»·ï¼š</strong>åŸä»·${contractInfo.original_price || '____'}ä¸‡å…ƒï¼Œç”²æ–¹ä¼˜æƒ ä»·ä¸º<strong>${contractInfo.discount_price || '____'}ä¸‡å…ƒ</strong>ã€‚</p>
                    <p><strong>å¹´åº¦æœåŠ¡è´¹ï¼š</strong>${contractInfo.annual_fee || '30000'}å…ƒ/å¹´${contractInfo.discount_annual_fee ? 'ï¼Œä¼˜æƒ ä»·ï¼š' + contractInfo.discount_annual_fee + 'å…ƒ/å¹´' : ''}</p>
                    <p><strong>ä»˜æ¬¾æ–¹å¼ï¼š</strong></p>
                    <pre style="white-space:pre-wrap;font-family:inherit;margin:10px 0;padding:10px;background:#f5f5f5;border-radius:4px;">${contractInfo.payment_terms || 'å¾…å®š'}</pre>
                    <p>ä¹™æ–¹åœ¨æ”¶åˆ°ç”²æ–¹ä»˜æ¬¾å5ä¸ªå·¥ä½œæ—¥å†…ï¼Œå¼€å…·ç›¸åº”çš„å¢å€¼ç¨ä¸“ç”¨å‘ç¥¨ã€‚</p>
                </div>
                
                <div class="section">
                    <p class="section-title">ä¸‰ã€äº¤ä»˜ã€éªŒæ”¶åŠæŠ•äº§</p>
                    <p>ï¼ˆä¸€ï¼‰è½¯ä»¶äº¤ä»˜ï¼šè½¯ä»¶å®‰è£…åˆ°ç”²æ–¹æŒ‡å®šæœåŠ¡å™¨å¹¶æ¿€æ´»åï¼Œä¸ºè½¯ä»¶çš„äº¤ä»˜ã€‚</p>
                    <p>ï¼ˆäºŒï¼‰éªŒæ”¶æ€»åŸåˆ™åŠæŠ•äº§ï¼šç”²æ–¹çš„è®¢å•é€šè¿‡è½¯ä»¶çš„å„åŠŸèƒ½æ¨¡å—ï¼Œæ­£å¸¸æµè½¬ï¼Œç”²æ–¹é€šè¿‡ä¹™æ–¹ç³»ç»Ÿèƒ½å°†æˆå“äº¤ä»˜ç»™é¡¾å®¢çš„ï¼Œä¸ºæŠ•äº§æˆåŠŸã€‚</p>
                </div>
                
                <div class="section">
                    <p class="section-title">å››ã€åŒæ–¹æƒåˆ©åŠä¹‰åŠ¡</p>
                    <p>1. ç”²æ–¹æ”¯ä»˜æ¬¾é¡¹ï¼›</p>
                    <p>2. ä¹™æ–¹åœ¨æ”¶åˆ°ä»˜æ¬¾åï¼Œä½œå‡ºå‘ç”²æ–¹æŒ‡å®šæœåŠ¡å™¨å®‰è£…çš„å‡†å¤‡å·¥ä½œï¼›</p>
                    <p>3. ç”²æ–¹æä¾›ç¬¦åˆç³»ç»Ÿè¦æ±‚çš„æœåŠ¡å™¨åŠç½‘ç»œç¯å¢ƒä¾›ä¹™æ–¹å®‰è£…è½¯ä»¶ï¼›</p>
                    <p>4. ä¹™æ–¹å®‰è£…æ¥å•ç³»ç»Ÿåˆ°ç”²æ–¹æŒ‡å®šçš„æœåŠ¡å™¨å¹¶æ¿€æ´»è½¯ä»¶ï¼›</p>
                    <p>5. ä¹™æ–¹æŒ‰æœ¬åˆåŒçš„ç»´æŠ¤æ¡æ¬¾è¿›è¡Œç»´æŠ¤ã€‚</p>
                </div>
                
                <div class="section">
                    <p class="section-title">äº”ã€è®¡ç®—æœºè½¯ä»¶è‘—ä½œæƒåŠç›¸å…³çš„çŸ¥è¯†äº§æƒå½’å±</p>
                    <p>æœ¬åˆåŒçš„è®¸å¯æ–¹å¼ä¸º"ä¸€èˆ¬è®¸å¯"ï¼Œç”±ä¹™æ–¹æˆæƒç”²æ–¹ä½¿ç”¨è½¯ä»¶ã€‚ç”²æ–¹åŒæ„æ¥å—ä¸€ä¸ªä¸å¯è½¬è®©çš„éç‹¬å çš„ä½¿ç”¨è®¸å¯ã€‚</p>
                </div>
                
                <div class="section">
                    <p class="section-title">å…­ã€ä¿å¯†çº¦å®š</p>
                    <p>ç”²ä¹™åŒæ–¹å¯¹åœ¨åˆä½œä¸­äº’ç›¸çŸ¥æ™“çš„å¯¹æ–¹çš„å•†ä¸šç§˜å¯†åŠæ•°æ®æœ‰ä¿å¯†çš„è´£ä»»ï¼Œæœªç»å¯¹æ–¹å…è®¸ä¸å¾—æ³„éœ²æˆ–ç”¨äºå…¶å®ƒç”¨é€”ã€‚</p>
                </div>
                
                <div class="section">
                    <p class="section-title">ä¸ƒã€ä¸å¯æŠ—åŠ›</p>
                    <p>ç”²ä¹™åŒæ–¹çš„ä»»ä½•ä¸€æ–¹ç”±äºä¸å¯æŠ—åŠ›çš„åŸå› ä¸èƒ½å±¥è¡ŒåˆåŒæ—¶ï¼Œåº”åŠæ—¶å‘å¯¹æ–¹é€šæŠ¥ä¸èƒ½å±¥è¡Œæˆ–ä¸èƒ½å®Œå…¨å±¥è¡Œçš„ç†ç”±ã€‚</p>
                </div>
                
                <div class="section">
                    <p class="section-title">å…«ã€è¿çº¦è´£ä»»</p>
                    <p>ç”²ä¹™åŒæ–¹æœ¬ç€çœŸè¯šåˆä½œã€ç›¸äº’ä¿¡èµ–çš„åŸåˆ™ï¼Œæ ¹æ®å›½å®¶ç›¸å…³çš„æ³•å¾‹ã€æ³•è§„ï¼Œåå•†è§£å†³åœ¨æœ¬åˆåŒæ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„è¿çº¦çº çº·å’Œè¿çº¦è´£ä»»ã€‚</p>
                </div>
                
                <div class="section">
                    <p class="section-title">ä¹ã€äº‰è®®è§£å†³æ–¹å¼</p>
                    <p>åŒæ–¹åˆåŒå±¥è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿäº‰è®®ï¼ŒåŒæ–¹åº”åå•†è§£å†³ã€‚å¦‚æœä¸èƒ½åå•†è§£å†³äº‰è®®ï¼Œä»»ä½•ä¸€æ–¹å‡å¯å°†æ­¤äº‰è®®å‘åŒæ–¹æ‰€åœ¨åœ°äººæ°‘æ³•é™¢èµ·è¯‰ã€‚</p>
                </div>
                
                <div class="section">
                    <p class="section-title">åã€å…¶ä»–</p>
                    <p>æœ¬åˆåŒè‡ªåŒæ–¹ç­¾ç½²ä¹‹æ—¥èµ·æˆç«‹å¹¶ç”Ÿæ•ˆï¼Œé™¤éç”²ä¹™åŒæ–¹è¾¾æˆåˆæ„ç»ˆæ­¢ï¼ŒåˆåŒè‡ªåŠ¨å»¶ç»­ã€‚æœ¬åˆåŒä¸€å¼ä¸¤ä»½ï¼ŒåˆåŒåŒæ–¹å„æŒä¸€ä»½ï¼Œå‡å…·æœ‰åŒç­‰æ³•å¾‹æ•ˆåŠ›ã€‚</p>
                </div>
                
                <div class="signature">
                    <div class="signature-box">
                        <p><strong>ç”²æ–¹ï¼š</strong>${contractInfo.partyA_name}</p>
                        <p>ç­¾çº¦ä»£è¡¨ï¼š________________</p>
                        <p>æ—¥æœŸï¼š${year}å¹´____æœˆ____æ—¥</p>
                    </div>
                    <div class="signature-box">
                        <p><strong>ä¹™æ–¹ï¼š</strong>${contractInfo.partyB_name}</p>
                        <p>ç­¾çº¦ä»£è¡¨ï¼š________________</p>
                        <p>æ—¥æœŸï¼š${year}å¹´____æœˆ____æ—¥</p>
                    </div>
                </div>
            `;
            
            document.getElementById('contractPreview').innerHTML = contractHtml;
            switchTab('preview');
            showToast('åˆåŒå·²ç”Ÿæˆ');
        }

        // æ‰“å°åˆåŒ
        function printContract() {
            window.print();
        }

        // ä¸‹è½½åˆåŒ
        function downloadContract() {
            const content = document.getElementById('contractPreview').innerHTML;
            const html = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>è½¯ä»¶ä½¿ç”¨è®¸å¯åˆåŒ</title>
    <style>
        body { font-family: "Microsoft YaHei", sans-serif; padding: 40px; line-height: 1.8; }
        h2 { text-align: center; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #333; padding: 8px; }
        th { background: #f0f0f0; }
        .signature { display: flex; justify-content: space-between; margin-top: 50px; }
        .signature-box { width: 45%; }
    </style>
</head>
<body>${content}</body>
</html>`;
            
            const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `è½¯ä»¶ä½¿ç”¨è®¸å¯åˆåŒ_${contractInfo.partyA_name || 'æœªå‘½å'}.html`;
            link.click();
            showToast('åˆåŒå·²ä¸‹è½½');
        }

        // å¯¼å‡ºExcel
        function exportToExcel() {
            let csv = '\uFEFF';
            const headers = ['åŠŸèƒ½'];
            plans.forEach(plan => {
                headers.push(`"${plan.name}(${plan.subtitle})"`);
            });
            csv += headers.join(',') + '\n';
            
            const priceRow = ['ä»·æ ¼'];
            plans.forEach(plan => {
                priceRow.push(`"${plan.price}"`);
            });
            csv += priceRow.join(',') + '\n';
            
            features.forEach((feature, fIndex) => {
                if (feature.category) {
                    const row = [`"${feature.category}"`];
                    for (let i = 0; i < plans.length; i++) {
                        row.push('""');
                    }
                    csv += row.join(',') + '\n';
                } else {
                    const row = [`"${feature.name}"`];
                    plans.forEach((plan, pIndex) => {
                        const key = `${fIndex}_${pIndex}`;
                        let value = checkData[key];
                        if (value === undefined) {
                            if (pIndex === 0) value = '';
                            else if (pIndex === 1) value = feature.default2 || '';
                            else if (pIndex === 2) value = feature.default3 || '';
                            else value = '';
                        }
                        row.push(`"${value}"`);
                    });
                    csv += row.join(',') + '\n';
                }
            });

            // æ·»åŠ æœåŠ¡çº§åˆ«åˆ°å¯¼å‡º
            csv += '\n"æœåŠ¡çº§åˆ«è¯´æ˜"\n';
            csv += '"æœåŠ¡çº§åˆ«","æœåŠ¡å†…å®¹","ä»·æ ¼"\n';
            serviceLevels.forEach(service => {
                csv += `"${service.level}","${service.content.replace(/\n/g, ' ')}","${service.price}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'æ–¹æ¡ˆé…ç½®è¡¨.csv';
            link.click();
            showToast('å·²å¯¼å‡ºExcel');
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = init;
    </script>
</body>
</html>
