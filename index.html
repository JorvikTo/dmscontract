<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°åˆ·å…¨æµç¨‹è®¡åˆ’ä¹¦ä¸åˆåŒç”Ÿæˆç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%);
            min-height: 100vh;
            color: #333;
        }
        .header {
            background: linear-gradient(135deg, #4a4a4a 0%, #2d2d2d 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 25px;
        }
        .header-logo {
            height: 70px;
            width: auto;
        }
        .header-text {
            text-align: left;
        }
        .header h1 {
            font-size: 24px;
            margin-bottom: 6px;
            font-weight: 400;
            letter-spacing: 1px;
        }
        .header p {
            font-size: 12px;
            opacity: 0.75;
            font-weight: 300;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .customer-bar {
            background: #f8f9fa;
            padding: 12px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: center;
        }
        .customer-selector {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .customer-selector label {
            font-weight: 500;
            color: #333;
        }
        .customer-selector select {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            min-width: 180px;
            background: white;
        }
        .customer-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s;
        }
        .customer-btn.add {
            background: #27ae60;
            color: white;
        }
        .customer-btn.add:hover {
            background: #219a52;
        }
        .customer-btn.delete {
            background: #e74c3c;
            color: white;
        }
        .customer-btn.delete:hover {
            background: #c0392b;
        }
        .customer-btn.save {
            background: #3498db;
            color: white;
        }
        .customer-btn.save:hover {
            background: #2980b9;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab {
            padding: 12px 30px;
            background: rgba(255,255,255,0.1);
            color: white;
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        .tab.active {
            background: white;
            color: #333;
        }
        .tab:hover:not(.active) {
            background: rgba(255,255,255,0.15);
        }
        .panel {
            display: none;
            background: white;
            border-radius: 0 12px 12px 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .panel.active {
            display: block;
        }
        .instructions {
            background: #f0f9ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        .instructions h3 {
            color: #2980b9;
            margin-bottom: 10px;
        }
        .instructions ul {
            margin-left: 20px;
            color: #666;
        }
        .instructions li {
            margin: 5px 0;
        }
        /* æ–¹æ¡ˆè¡¨æ ¼æ ·å¼ */
        .table-container {
            overflow-x: auto;
            margin-bottom: 30px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        th, td {
            padding: 12px 15px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }
        th {
            background: #2c5282;
            color: white;
            font-weight: 500;
        }
        .feature-col {
            text-align: left;
            background: #f8f9fa;
            font-weight: 500;
            min-width: 300px;
            width: 40%;
        }
        .plan-col {
            width: 20%;
            min-width: 150px;
        }
        .category-row td {
            background: linear-gradient(135deg, #e8f6f3 0%, #d5f5e3 100%);
            font-weight: bold;
            color: #27ae60;
            text-align: left;
        }
        .price-row td {
            background: #fff8e6;
            color: #d35400;
            font-weight: bold;
            font-size: 16px;
        }
        .check {
            color: #27ae60;
            font-size: 20px;
            cursor: pointer;
        }
        .cross {
            color: #e74c3c;
            font-size: 20px;
            cursor: pointer;
        }
        .empty {
            color: #ccc;
            cursor: pointer;
        }
        .price-value {
            color: #d35400;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
        }
        .editable {
            cursor: text;
            min-width: 50px;
            display: inline-block;
        }
        .editable:hover {
            background: rgba(0, 0, 0, 0.08);
            border-radius: 4px;
        }
        .plan-header {
            position: relative;
        }
        .plan-name {
            cursor: pointer;
            display: block;
        }
        .plan-name:hover {
            text-decoration: underline;
        }
        .plan-subtitle {
            font-size: 12px;
            opacity: 0.8;
            cursor: pointer;
        }
        .plan-subtitle:hover {
            text-decoration: underline;
        }
        .delete-plan {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255,255,255,0.3);
            border: none;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: none;
        }
        .plan-header:hover .delete-plan {
            display: block;
        }
        .delete-plan:hover {
            background: #e74c3c;
        }
        .delete-plan-top {
            position: absolute;
            top: 3px;
            right: 3px;
            background: rgba(231, 76, 60, 0.8);
            border: none;
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            line-height: 18px;
            text-align: center;
            opacity: 0.6;
            transition: opacity 0.2s;
        }
        .delete-plan-top:hover {
            opacity: 1;
            background: #c0392b;
        }
        .remark-row td {
            background: #f5f5f5;
            font-size: 12px;
            color: #666;
        }
        .remark-text {
            font-style: italic;
            color: #888;
        }
        /* æœåŠ¡çº§åˆ«è¡¨æ ¼ */
        .service-table {
            margin-top: 30px;
        }
        .service-table h3 {
            color: #27ae60;
            margin-bottom: 15px;
        }
        .service-table table {
            table-layout: fixed;
            width: 100%;
        }
        .service-table th:nth-child(1),
        .service-table td:nth-child(1) {
            width: 15%;
        }
        .service-table th:nth-child(2),
        .service-table td:nth-child(2) {
            width: 55%;
        }
        .service-table th:nth-child(3),
        .service-table td:nth-child(3) {
            width: 30%;
        }
        .service-table td {
            text-align: left;
            vertical-align: top;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: normal;
        }
        .service-table td:nth-child(3) {
            text-align: right;
            font-weight: bold;
            color: #d35400;
        }
        .service-row {
            position: relative;
        }
        .service-row:hover .service-row-actions {
            opacity: 1;
        }
        .service-row-actions {
            position: absolute;
            left: 5px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 3px;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 10;
        }
        .service-action-btn {
            width: 20px;
            height: 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            color: white;
            padding: 0;
            line-height: 20px;
            text-align: center;
        }
        .service-action-btn.add-above {
            background: #3498db;
        }
        .service-action-btn.add-below {
            background: #27ae60;
        }
        .service-action-btn.del-row {
            background: #e74c3c;
        }
        .editable-cell {
            cursor: text;
            min-height: 20px;
        }
        .editable-cell:hover {
            background: rgba(0, 0, 0, 0.05);
        }
        /* è¡Œæ“ä½œæŒ‰é’®æ ·å¼ */
        .feature-row {
            position: relative;
        }
        .feature-row:hover .row-actions {
            opacity: 1;
        }
        .row-actions {
            position: absolute;
            left: 5px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 3px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .row-action-btn {
            width: 20px;
            height: 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            line-height: 20px;
            text-align: center;
            color: white;
            padding: 0;
        }
        .row-action-btn.add-above {
            background: #3498db;
        }
        .row-action-btn.add-below {
            background: #27ae60;
        }
        .row-action-btn.delete-row {
            background: #e74c3c;
        }
        .row-action-btn:hover {
            opacity: 0.8;
        }
        .feature-name-cell {
            position: relative;
            padding-left: 75px !important;
        }
        .feature-name-text {
            cursor: pointer;
        }
        .feature-name-text:hover {
            text-decoration: underline;
            color: #2980b9;
        }
        /* åˆ†ç±»è¡Œæ“ä½œæŒ‰é’® */
        .category-row {
            position: relative;
        }
        .category-row:hover .category-actions {
            opacity: 1;
        }
        .category-actions {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .category-action-btn {
            padding: 3px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            color: white;
        }
        .category-action-btn.edit {
            background: #3498db;
        }
        .category-action-btn.add {
            background: #27ae60;
        }
        .category-action-btn.delete {
            background: #e74c3c;
        }
        /* æŒ‰é’®æ ·å¼ */
        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(39, 174, 96, 0.4);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(52, 152, 219, 0.4);
        }
        .btn-warning {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(231, 76, 60, 0.4);
        }
        .btn-info {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
        }
        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(155, 89, 182, 0.4);
        }
        .btn-next {
            background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%);
            color: white;
            padding: 15px 50px;
            font-size: 16px;
        }
        .btn-next:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(39, 174, 96, 0.4);
        }
        /* åˆåŒä¿¡æ¯è¡¨å• */
        .form-section {
            margin-bottom: 30px;
        }
        .form-section h3 {
            color: #2980b9;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        /* æ–¹æ¡ˆé€‰æ‹©å¡ç‰‡ */
        .plan-cards {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }
        .plan-card {
            flex: 1;
            min-width: 200px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        .plan-card:hover {
            border-color: #3498db;
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(52, 152, 219, 0.2);
        }
        .plan-card.selected {
            border-color: #27ae60;
            background: #f0fff4;
        }
        .plan-card h4 {
            color: #2980b9;
            margin-bottom: 5px;
        }
        .plan-card .price {
            color: #d35400;
            font-size: 24px;
            font-weight: bold;
        }
        /* åˆåŒé¢„è§ˆ */
        .contract-preview {
            background: white;
            padding: 50px;
            border: 1px solid #ddd;
            max-width: 900px;
            margin: 0 auto;
            font-size: 14px;
            line-height: 1.8;
        }
        .contract-preview h1 {
            text-align: center;
            font-size: 22px;
            margin-bottom: 20px;
        }
        .contract-preview h2 {
            font-size: 16px;
            margin: 20px 0 10px;
            color: #2980b9;
        }
        .contract-preview .contract-header {
            text-align: right;
            margin-bottom: 30px;
            color: #666;
        }
        .contract-preview .party-info {
            margin: 20px 0;
        }
        .contract-preview .signature {
            display: flex;
            justify-content: space-between;
            margin-top: 50px;
        }
        .contract-preview .signature-block {
            width: 45%;
        }
        .contract-preview .signature-line {
            border-bottom: 1px solid #333;
            margin: 10px 0;
            height: 30px;
        }
        .contract-preview table {
            font-size: 12px;
        }
        .contract-preview th {
            background: #2c5282;
        }
        .contract-preview .footer-info {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #666;
            font-size: 12px;
        }
        .contract-preview .article {
            margin: 15px 0;
            text-align: justify;
        }
        .contract-preview .article-title {
            font-weight: bold;
            color: #2980b9;
        }
        .contract-preview .sub-item {
            margin-left: 20px;
        }
        .contract-preview .appendix {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #3498db;
        }
        .contract-preview .appendix h2 {
            font-size: 18px;
            text-align: center;
            margin-bottom: 20px;
        }
        /* åˆåŒç¼–è¾‘æ¨¡å¼æ ·å¼ */
        .contract-edit-toolbar {
            background: #f0f4f8;
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: space-between;
        }
        .contract-edit-toolbar .toolbar-left {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        .contract-edit-toolbar .toolbar-info {
            font-size: 13px;
            color: #666;
        }
        .edit-mode-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s;
        }
        .edit-mode-btn.edit-on {
            background: #e74c3c;
            color: white;
        }
        .edit-mode-btn.edit-off {
            background: #27ae60;
            color: white;
        }
        .edit-mode-btn.save-contract {
            background: #3498db;
            color: white;
        }
        .edit-mode-btn.reset-contract {
            background: #e67e22;
            color: white;
        }
        .contract-preview.editing .editable-block {
            border: 1px dashed #3498db;
            padding: 8px;
            margin: 4px 0;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        .contract-preview.editing .editable-block:hover {
            background: #edf5ff;
            border-color: #2980b9;
        }
        .contract-preview.editing .editable-block:hover::after {
            content: 'ç‚¹å‡»ç¼–è¾‘';
            position: absolute;
            top: 2px;
            right: 8px;
            font-size: 11px;
            color: #3498db;
            background: white;
            padding: 1px 6px;
            border-radius: 3px;
            border: 1px solid #3498db;
        }
        .block-actions {
            display: none;
            position: absolute;
            left: -40px;
            top: 50%;
            transform: translateY(-50%);
            flex-direction: column;
            gap: 4px;
            padding: 6px;
            padding-right: 15px;
            z-index: 100;
        }
        .contract-preview.editing .editable-block:hover .block-actions {
            display: flex;
        }
        .block-actions:hover {
            display: flex !important;
        }
        .block-action-btn {
            width: 28px;
            height: 28px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            color: white;
            padding: 0;
            line-height: 28px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: transform 0.15s;
        }
        .block-action-btn:hover {
            transform: scale(1.15);
        }
        .block-action-btn.add-block {
            background: #27ae60;
        }
        .block-action-btn.del-block {
            background: #e74c3c;
        }
        .block-action-btn.move-up {
            background: #3498db;
        }
        .block-action-btn.move-down {
            background: #3498db;
        }
        /* åˆåŒç¼–è¾‘å¯¹è¯æ¡† */
        .contract-edit-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        .contract-edit-dialog .dialog-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .contract-edit-dialog h3 {
            margin-bottom: 15px;
            color: #2c5282;
        }
        .contract-edit-dialog textarea {
            width: 100%;
            min-height: 200px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: 'Microsoft YaHei', sans-serif;
            line-height: 1.8;
            resize: vertical;
        }
        .contract-edit-dialog .dialog-btns {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 15px;
        }
        .contract-edit-dialog .dialog-btns button {
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        @media print {
            body {
                background: white;
            }
            .header, .tabs, .btn-group, .instructions, .contract-edit-toolbar, .block-actions, .service-row-actions, .row-actions {
                display: none !important;
            }
            .panel {
                box-shadow: none;
            }
            .contract-preview {
                border: none;
                padding: 20px;
            }
            .contract-preview.editing .editable-block {
                border: none;
                padding: 0;
                margin: 0;
            }
            .contract-preview.editing .editable-block:hover::after {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="logo.png" alt="DMS Logo" class="header-logo">
        <div class="header-text">
            <h1 id="mainTitle" onclick="editMainTitle()" style="cursor: pointer;" title="ç‚¹å‡»ä¿®æ”¹æ ‡é¢˜">å°åˆ·å…¨æµç¨‹è®¡åˆ’ä¹¦ä¸åˆåŒç”Ÿæˆç³»ç»Ÿ</h1>
            <p id="mainSubtitle" onclick="editMainSubtitle()" style="cursor: pointer;" title="ç‚¹å‡»ä¿®æ”¹å‰¯æ ‡é¢˜">ä»¥ä¸‹ä¸ºæ–¹æ¡ˆæ˜ç»†ï¼Œåˆ—æ˜å»ºè®®çš„æ ‡å‡†é…ç½®æ¨¡å—åŠå¯é€‰æ¨¡å—</p>
        </div>
    </div>

    <!-- å®¢æˆ·ç®¡ç†æ  -->
    <div class="customer-bar">
        <div class="customer-selector">
            <label>å½“å‰å®¢æˆ·ï¼š</label>
            <select id="customerSelect" onchange="switchCustomer()">
                <option value="default">é»˜è®¤å®¢æˆ·</option>
            </select>
            <button class="customer-btn add" onclick="addCustomer()">â• æ–°å¢å®¢æˆ·</button>
            <button class="customer-btn delete" onclick="deleteCustomer()">â– åˆ é™¤å®¢æˆ·</button>
            <button class="customer-btn save" onclick="saveCurrentCustomer()">âœ” ä¿å­˜å½“å‰æ–¹æ¡ˆ</button>
        </div>
    </div>

    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="showTab('plan')">æ–¹æ¡ˆé…ç½®</button>
            <button class="tab" onclick="showTab('contract')">åˆåŒä¿¡æ¯</button>
            <button class="tab" onclick="showTab('preview')">åˆåŒé¢„è§ˆ</button>
        </div>

        <!-- æ–¹æ¡ˆé…ç½®é¢æ¿ -->
        <div id="plan-panel" class="panel active">
            <div class="instructions">
                <h3>ğŸ“ æ“ä½œè¯´æ˜</h3>
                <ul>
                    <li>ç‚¹å‡»æ–¹æ¡ˆåç§°æˆ–å‰¯æ ‡é¢˜å¯ç›´æ¥ä¿®æ”¹</li>
                    <li>ç‚¹å‡»å•å…ƒæ ¼å¯åœ¨ âœ” / âœ˜ / ç©ºç™½ ä¹‹é—´åˆ‡æ¢</li>
                    <li>ç‚¹å‡»"æ·»åŠ æ–¹æ¡ˆ"å¯æ–°å¢æ–¹æ¡ˆåˆ—ï¼Œé¼ æ ‡æ‚¬åœåœ¨æ–¹æ¡ˆè¡¨å¤´å¯åˆ é™¤</li>
                    <li>æœåŠ¡çº§åˆ«è¡¨æ ¼ä¹Ÿå¯ç¼–è¾‘å’Œæ·»åŠ /åˆ é™¤</li>
                    <li>æ‰€æœ‰ä¿®æ”¹ä¼šè‡ªåŠ¨ä¿å­˜åˆ°æµè§ˆå™¨æœ¬åœ°å­˜å‚¨</li>
                </ul>
            </div>

            <div class="table-container">
                <table id="plan-table">
                    <thead>
                        <tr id="header-row">
                            <th class="feature-col">åŠŸèƒ½</th>
                            <!-- æ–¹æ¡ˆåˆ—å°†åŠ¨æ€ç”Ÿæˆ -->
                        </tr>
                    </thead>
                    <tbody id="plan-body">
                        <!-- è¡¨æ ¼å†…å®¹å°†åŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>

            <div class="service-table">
                <h3>æœåŠ¡çº§åˆ«è¯´æ˜</h3>
                <table id="service-table">
                    <thead>
                        <tr>
                            <th>æœåŠ¡çº§åˆ«</th>
                            <th>æœåŠ¡å†…å®¹</th>
                            <th>ä»·æ ¼</th>
                        </tr>
                    </thead>
                    <tbody id="service-body">
                        <!-- æœåŠ¡çº§åˆ«å†…å®¹å°†åŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="addPlan()">â• æ·»åŠ æ–¹æ¡ˆ</button>
                <button class="btn btn-info" onclick="addServiceLevel()">â• æ·»åŠ æœåŠ¡çº§åˆ«</button>
                <button class="btn btn-secondary" onclick="exportExcel()">ğŸ“Š å¯¼å‡ºExcel</button>
                <button class="btn btn-warning" onclick="resetData()">ğŸ”„ é‡ç½®</button>
                <button class="btn" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); color: white;" onclick="exportPlanOnly()">ğŸ“„ è¾“å‡ºæ–¹æ¡ˆæ˜ç»†</button>
                <button class="btn btn-next" onclick="showTab('contract')">ä¸‹ä¸€æ­¥ï¼šå¡«å†™åˆåŒä¿¡æ¯ â†’</button>
            </div>
        </div>

        <!-- åˆåŒä¿¡æ¯é¢æ¿ -->
        <div id="contract-panel" class="panel">
            <div class="form-section">
                <h3>é€‰æ‹©æ–¹æ¡ˆ</h3>
                <div class="plan-cards" id="plan-cards">
                    <!-- æ–¹æ¡ˆå¡ç‰‡å°†åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <div class="form-section">
                <h3>ç”²æ–¹ä¿¡æ¯</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>å…¬å¸åç§°</label>
                        <input type="text" id="party-a-name" placeholder="è¯·è¾“å…¥ç”²æ–¹å…¬å¸åç§°">
                    </div>
                    <div class="form-group">
                        <label>åœ°å€</label>
                        <input type="text" id="party-a-address" placeholder="è¯·è¾“å…¥ç”²æ–¹åœ°å€">
                    </div>
                    <div class="form-group">
                        <label>é¡¹ç›®ç»ç†å§“å</label>
                        <input type="text" id="party-a-pm" placeholder="è¯·è¾“å…¥ç”²æ–¹é¡¹ç›®ç»ç†å§“å">
                    </div>
                    <div class="form-group">
                        <label>é¡¹ç›®ç»ç†ç”µè¯</label>
                        <input type="text" id="party-a-phone" placeholder="è¯·è¾“å…¥ç”²æ–¹é¡¹ç›®ç»ç†ç”µè¯">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>ä¹™æ–¹ä¿¡æ¯</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>å…¬å¸åç§°</label>
                        <input type="text" id="party-b-name" value="å¹¿å·å¤šæ™®ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸">
                    </div>
                    <div class="form-group">
                        <label>åœ°å€</label>
                        <input type="text" id="party-b-address" value="ä½›å±±å¸‚å—æµ·åŒºä¸‰å±±æ–°åŸå›½é™…åˆ›æ™ºå›­13B906">
                    </div>
                    <div class="form-group">
                        <label>é¡¹ç›®ç»ç†å§“å</label>
                        <input type="text" id="party-b-pm" value="æœä¿Šè£">
                    </div>
                    <div class="form-group">
                        <label>é¡¹ç›®ç»ç†ç”µè¯</label>
                        <input type="text" id="party-b-phone" value="18688891984">
                    </div>
                    <div class="form-group">
                        <label>é¡¹ç›®ç»ç†å¾®ä¿¡</label>
                        <input type="text" id="party-b-wechat" value="Jorvikdu">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>åˆåŒä¿¡æ¯</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>åˆåŒç¼–å·</label>
                        <input type="text" id="contract-no" placeholder="å¦‚ï¼šINV-20252155">
                    </div>
                    <div class="form-group">
                        <label>åŸä»·ï¼ˆä¸‡å…ƒï¼‰</label>
                        <input type="text" id="original-price" placeholder="å¦‚ï¼š52">
                    </div>
                    <div class="form-group">
                        <label>ä¼˜æƒ ä»·ï¼ˆä¸‡å…ƒï¼‰</label>
                        <input type="text" id="discount-price" placeholder="å¦‚ï¼š36.8">
                    </div>
                    <div class="form-group">
                        <label>å¹´åº¦æœåŠ¡è´¹ï¼ˆå…ƒ/å¹´ï¼‰</label>
                        <input type="text" id="annual-fee" value="58000">
                    </div>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="showTab('plan')">â† è¿”å›æ–¹æ¡ˆé…ç½®</button>
                <button class="btn btn-next" onclick="generateContract()">ç”ŸæˆåˆåŒé¢„è§ˆ â†’</button>
            </div>
        </div>

        <!-- åˆåŒé¢„è§ˆé¢æ¿ -->
        <div id="preview-panel" class="panel">
            <div class="contract-edit-toolbar" id="contract-edit-toolbar">
                <div class="toolbar-left">
                    <button class="edit-mode-btn edit-off" id="editModeBtn" onclick="toggleContractEditMode()">ç¼–è¾‘åˆåŒå†…å®¹</button>
                    <button class="edit-mode-btn save-contract" onclick="saveContractContent()">ä¿å­˜åˆåŒ</button>
                    <button class="edit-mode-btn reset-contract" onclick="resetContractContent()">æ¢å¤é»˜è®¤</button>
                    <span class="toolbar-info" id="editModeInfo">ç‚¹å‡»"ç¼–è¾‘åˆåŒå†…å®¹"å¯ä»¥ç›´æ¥ä¿®æ”¹åˆåŒæ–‡å­—</span>
                </div>
            </div>
            <div id="contract-content" class="contract-preview">
                <!-- åˆåŒå†…å®¹å°†åŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="btn-group" style="margin-top: 30px;">
                <button class="btn btn-secondary" onclick="showTab('contract')">â† è¿”å›ä¿®æ”¹</button>
                <button class="btn btn-primary" onclick="printContract()">ğŸ–¨ï¸ æ‰“å°åˆåŒ</button>
                <button class="btn btn-info" onclick="downloadContract()">ğŸ“¥ ä¸‹è½½åˆåŒ</button>
            </div>
        </div>
    </div>

    <script>
        // é»˜è®¤æ•°æ®å‡½æ•°
        function getDefaultPlans() {
            return [
            { name: 'æ–¹æ¡ˆä¸€', subtitle: 'è‡ªå®šä¹‰', price: '', remark: '' },
            { name: 'æ–¹æ¡ˆäºŒ', subtitle: 'ç»æµå‹', price: '15ä¸‡', remark: '' },
            { name: 'æ–¹æ¡ˆä¸‰', subtitle: 'å…¨å¥—', price: '49ä¸‡', remark: '' }
        ];
        }

        function getDefaultFeatures() {
            return [
            { category: 'å•†åŠ¡ç³»ç»Ÿ', features: [] },
            { category: '', features: [
                { name: 'ç§æœ‰åŒ–è½¯ä»¶éƒ¨ç½²', values: ['', 'âœ”', 'âœ”'] },
                { name: 'å•†åŠ¡ç³»ç»Ÿæ¥æ”¶è®¢å•æ–¹å¼', values: ['', 'âœ”', 'âœ”'] },
                { name: 'å®¢æˆ·ç”µè„‘è‡ªåŠ©å¼ä¸‹å•ã€æŸ¥å•', values: ['', 'âœ”', 'âœ”'] },
                { name: 'å®¢æˆ·è‡ªåŠ©å°ç¨‹åºä¸‹å•ã€æŸ¥å•', values: ['', 'âœ”', 'âœ”'] },
                { name: 'å†…éƒ¨å‘˜å·¥ä»£å®¢ä¸‹å•', values: ['', 'âœ”', 'âœ”'] },
                { name: 'å¯¹æ¥ç¬¬ä¸‰æ–¹å•†åŸ', values: ['', 'âœ˜', 'âœ”'] },
                { name: 'ä¸‹å•å±æ€§æ˜¯å¦æ­£ç¡®è‡ªåŠ¨æ ¡éªŒï¼Œé˜²æ­¢å‡ºé”™', values: ['', 'âœ”', 'âœ”'] },
                { name: 'æ ‡å‡†äº§å“æŠ¥ä»·(çº¸å¼ è´¹ç”¨+æŠ„è¡¨è´¹ç”¨+åé“è´¹ç”¨)', values: ['', 'âœ”', 'âœ”'] },
                { name: 'ç”¨excelè¡¨æ ¼å¼€å•', values: ['', 'âœ”', 'âœ”'] },
                { name: 'ä»£ç†å•†æ¨¡å¼ï¼ˆä»£ç†å•†æ‹¥æœ‰è‡ªå·±çš„åŸŸåã€å“ç‰Œã€æŠ¥ä»·ä½“ç³»ï¼‰', values: ['', 'âœ˜', 'âœ”'] },
                { name: 'å¤šå“ç‰Œï¼Œå„å“ç‰Œç‹¬ç«‹æ ¸ç®—', values: ['', 'âœ˜', 'âœ”'] }
            ]},
            { category: 'å®¢æˆ·ç®¡ç†', features: [
                { name: 'å®¢æˆ·åˆ†ç»„ç®¡ç†', values: ['', 'âœ”', 'âœ”'] },
                { name: 'é˜¶æ¢¯ä»·æ ¼', values: ['', 'âœ”', 'âœ”'] },
                { name: 'åè®®ä»·', values: ['', 'âœ”', 'âœ”'] },
                { name: 'æŒ‰é”€å”®å•æ”¶æ¬¾', values: ['', 'âœ”', 'âœ”'] },
                { name: 'æŒ‰å‘è´§å•æ”¶æ¬¾', values: ['', 'âœ”', 'âœ”'] },
                { name: 'åº”æ”¶æ¬¾å¯¹è´¦è®°é”€å¸', values: ['', 'âœ”', 'âœ”'] },
                { name: 'é€€æ¬¾ç®¡ç†', values: ['', 'âœ”', 'âœ”'] }
            ]},
            { category: 'æ–‡ä»¶å¤„ç†(å¯¹æ¥Tflowå°å‰å¤„ç†ç³»ç»Ÿ)', features: [
                { name: 'æ–‡ä»¶å°ºå¯¸ã€é¡µæ•°ã€å•åŒé¢ã€è‰²å½©æ¨¡å¼é¢„æ£€', values: ['', 'âœ”', 'âœ”'] },
                { name: 'æ•°ç å°åˆ·è‡ªåŠ¨æ‹¼ç‰ˆ', values: ['', 'âœ”', 'âœ”'] },
                { name: 'è‡ªåŠ¨æ‰“è§’çº¿', values: ['', 'âœ”', 'âœ”'] },
                { name: 'è‡ªåŠ¨æ‰“ç”Ÿäº§æ¡ç ', values: ['', 'âœ”', 'âœ”'] },
                { name: 'æ•°ç çš„éª‘é©¬é’‰ï¼Œæ— çº¿èƒ¶è£…ã€é”çº¿ã€ç²¾è£…æ‹¼ç‰ˆ', values: ['', 'âœ”', 'âœ”'] },
                { name: 'åˆæ‰¹æ¬¡å•ç”Ÿäº§ï¼ˆè®¢å•è“„æ°´æ± ï¼Œè‡ªåŠ¨åˆæ‰¹æ¬¡æ··åˆåˆç‰ˆï¼‰', values: ['', 'âœ˜', 'âœ”'] },
                { name: 'ä¼ ç»Ÿåç‰‡ã€å•å¼ æ‹¼ç‰ˆåˆç‰ˆ', values: ['', 'âœ”', 'âœ”'] },
                { name: 'ä¼ ç»Ÿå°åˆ·ä¹¦åˆŠæ‹¼ç‰ˆã€åˆç‰ˆ', values: ['', 'âœ˜', 'âœ”'] },
                { name: 'åŒ…è£…äº§å“', values: ['', 'âœ˜', 'âœ”'] },
                { name: 'CDRã€AIæ–‡ä»¶è‡ªåŠ¨è½¬æˆPDF', values: ['', 'âœ˜', 'âœ”'] },
                { name: 'è‡ªåŠ¨åˆ†ç¦»åˆ€çº¿ï¼ˆéœ€æŒ‰ç…§ä¹™æ–¹çš„æ ‡å‡†å‘½åä¸“è‰²ï¼‰', values: ['', 'âœ”', 'âœ”'] }
            ]},
            { category: 'ç”Ÿäº§ç®¡ç†', features: [
                { name: 'ç”Ÿäº§è¿›åº¦ç›‘æ§', values: ['', 'âœ”', 'âœ”'] },
                { name: 'åé“è®¾å¤‡(è¦†è†œ,è£åˆ‡)', values: ['', 'âœ”', 'âœ”'] },
                { name: 'ç‰©æ–™ä½¿ç”¨è®¡ç®—ï¼Œåº“å­˜æ‰£å‡', values: ['', 'âœ”', 'âœ”'] },
                { name: 'ç¼©ç•¥å›¾æ˜¾ç¤º', values: ['', 'âœ”', 'âœ”'] },
                { name: 'è‡ªå®šä¹‰å·¥å•æ ·å¼', values: ['', 'âœ”', 'âœ”'] },
                { name: 'åˆ€ç‰ˆç®¡ç†', values: ['', 'âœ˜', 'âœ”'] },
                { name: 'å¥—åŸæœ‰åˆ€ç‰ˆ', values: ['', 'âœ˜', 'âœ”'] },
                { name: 'å¤šç”Ÿäº§ç«™ç‚¹ï¼ˆæ‰«ç ç”Ÿäº§ç®¡ç†ï¼Œå‡ºè´§ï¼‰', values: ['', 'âœ˜', 'âœ”'] }
            ]},
            { category: 'è´¢åŠ¡ç®¡ç†ï¼ˆå¾€æ¥æµæ°´è´¦ï¼‰', features: [
                { name: 'å¾€æ¥è´¦', values: ['', 'âœ”', 'âœ”'] },
                { name: 'ä¸šåŠ¡å‘˜è´Ÿè´£å®¢æˆ·ç®¡ç†', values: ['', 'âœ”', 'âœ”'] },
                { name: 'é€€æ¬¾ç®¡ç†', values: ['', 'âœ”', 'âœ”'] },
                { name: 'è‡ªå®šä¹‰å‘˜å·¥ç»©æ•ˆè®¡ç®—(excelè¡¨æ ¼è®¡ç®—)', values: ['', 'âœ”', 'âœ”'] }
            ]},
            { category: 'é«˜çº§è´¢åŠ¡ï¼ˆä¸šè´¢èåˆï¼‰', features: [
                { name: 'å¯¹æ¥é‡‘è¶ï¼ˆé‡‘è¶æ–¹é¢çš„å®æ–½è´¹ç”¨ï¼Œç”²æ–¹è‡ªè¡Œä¸é‡‘è¶æ–¹ç­¾åˆåŒï¼‰', values: ['', 'âœ˜', 'âœ”'] },
                { name: 'åˆ†ç±»æ˜ç»†è´¦', values: ['', 'âœ˜', 'âœ”'] },
                { name: 'åˆ†ç±»æ€»è´¦', values: ['', 'âœ˜', 'âœ”'] },
                { name: 'é“¶è¡Œæ—¥è®°è´¦', values: ['', 'âœ˜', 'âœ”'] },
                { name: 'ç°é‡‘æ—¥è®°è´¦', values: ['', 'âœ˜', 'âœ”'] },
                { name: 'èµ„äº§è´Ÿå€ºè¡¨ã€ç°é‡‘æµé‡è¡¨ã€åˆ©æ¶¦è¡¨', values: ['', 'âœ˜', 'âœ”'] },
                { name: 'ç”Ÿäº§æˆæœ¬ä¼šè®¡æ ¸ç®—ã€ç»“è½¬', values: ['', 'âœ˜', 'âœ”'] }
            ]},
            { category: 'å‘è´§ç®¡ç†', features: [
                { name: 'æ‰‹å·¥å¡«å…¥è®¡ç®—è¿è´¹', values: ['', 'âœ”', 'âœ”'] },
                { name: 'è‡ªåŠ¨è®¡ç®—è¿è´¹', values: ['', 'âœ˜', 'âœ”'] },
                { name: 'å¯¹æ¥é¡ºä¸°', values: ['', 'âœ”', 'âœ”'] },
                { name: 'å¯¹æ¥å¿«é€’100', values: ['', 'âœ”', 'âœ”'] },
                { name: 'åˆ†æ‰¹æ¬¡å‘è´§', values: ['', 'âœ”', 'âœ”'] },
                { name: 'å¤šåœ°å€å‘è´§', values: ['', 'âœ”', 'âœ”'] }
            ]},
            { category: 'æœåŠ¡', features: [
                { name: 'ç°åœºæœåŠ¡ï¼ˆä¸¤å‘¨ï¼‰', values: ['', 'âœ”', 'âœ”'] },
                { name: '5x8å°æ—¶å”®åæœåŠ¡', values: ['', 'âœ”', 'âœ”'] },
                { name: 'å¹´åº¦æœåŠ¡è´¹', values: ['', 'âœ”', 'âœ”'] }
            ]}
        ];
        }

        function getDefaultServices() {
            return [
            {
                level: 'æ‰€æœ‰çº§åˆ«å…±ç”¨',
                content: '1. è½¯ä»¶Bugä¿®æ­£\n2. è½¯ä»¶å‡çº§\n3. å¬å–å®¢æˆ·ä¿®æ”¹åŠå‡çº§æ„è§\n4. å¦‚åˆåŒæ¨¡å—æœ‰ç›¸åº”çº¦å®šï¼Œä¸Šäº†æŸäº›æ¨¡å—åå¿…é¡»è´­ä¹°2çº§åˆ«ä»¥ä¸ŠæœåŠ¡\n5. è‹¥å®¢æˆ·è´­ä¹°äº†1çº§åˆ«æœåŠ¡ï¼Œæƒ³å®šåˆ¶å…¶ä»–åŠŸèƒ½ï¼Œç”²ä¹™åŒæ–¹å¯å•†è®¨è´¹ç”¨',
                price: '-'
            },
            {
                level: 'çº§åˆ«1',
                content: '1. æ ‡å‡†å¹´åº¦å‡çº§\n2. 5x8å°æ—¶æ ‡å‡†æœåŠ¡ï¼ˆå‘¨ä¸€è‡³å‘¨äº” 9:00-18:00ï¼‰\n3. æ ‡å‡†æ‹¼ç‰ˆæ–¹æ³•\n4. ç¬¬ä¸€æ¬¡ç°åœºæœåŠ¡ä¸¤å¤©ï¼Œå…¶ä½™è¿œç¨‹æœåŠ¡\n5. æ¯å­£åº¦ä¸€æ¬¡è¿œç¨‹ç³»ç»Ÿå·¡æ£€ï¼Œæ£€æŸ¥ç³»ç»Ÿè¿è¡ŒçŠ¶æ€\n6. æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–å»ºè®®',
                price: 'å…¥é—¨:ï¿¥30,000/å¹´,åŠå¥—ï¿¥50,000/å¹´ï¼Œæ•°ç å°åˆ·å…¨å¥—:ï¿¥80,000/å¹´'
            },
            {
                level: 'çº§åˆ«2',
                content: 'å®šåˆ¶åŒ–å”®åæœåŠ¡ï¼Œå¦‚æœåŠ¡æ—¶é—´ã€å®šåˆ¶åŒ–å†…å®¹ä¿®æ”¹',
                price: 'åŒæ–¹å•†è®¨'
            }
        ];
        }

        // æ•°æ®å­˜å‚¨
        let plans = [];
        let features = [];
        let services = [];
        let selectedPlanIndex = -1;
        let contractBlocks = []; // åˆåŒå†…å®¹å—
        let contractEditMode = false; // åˆåŒç¼–è¾‘æ¨¡å¼

        // ç¼–è¾‘ä¸»æ ‡é¢˜
        function editMainTitle() {
            const currentTitle = localStorage.getItem('mainTitle') || 'å°åˆ·å…¨æµç¨‹è®¡åˆ’ä¹¦ä¸åˆåŒç”Ÿæˆç³»ç»Ÿ';
            const newTitle = prompt('è¯·è¾“å…¥è®¡åˆ’ä¹¦æ ‡é¢˜ï¼ˆå¦‚ï¼šXXå…¬å¸å…¨æµç¨‹è®¡åˆ’ä¹¦ï¼‰ï¼š', currentTitle);
            if (newTitle !== null && newTitle.trim()) {
                localStorage.setItem('mainTitle', newTitle.trim());
                document.getElementById('mainTitle').textContent = newTitle.trim();
            }
        }

        // ç¼–è¾‘å‰¯æ ‡é¢˜
        function editMainSubtitle() {
            const currentSubtitle = localStorage.getItem('mainSubtitle') || 'ä»¥ä¸‹ä¸ºæ–¹æ¡ˆæ˜ç»†ï¼Œåˆ—æ˜å»ºè®®çš„æ ‡å‡†é…ç½®æ¨¡å—åŠå¯é€‰æ¨¡å—';
            const newSubtitle = prompt('è¯·è¾“å…¥å‰¯æ ‡é¢˜ï¼š', currentSubtitle);
            if (newSubtitle !== null && newSubtitle.trim()) {
                localStorage.setItem('mainSubtitle', newSubtitle.trim());
                document.getElementById('mainSubtitle').textContent = newSubtitle.trim();
            }
        }

        // åŠ è½½æ ‡é¢˜
        function loadTitles() {
            const savedTitle = localStorage.getItem('mainTitle');
            const savedSubtitle = localStorage.getItem('mainSubtitle');
            if (savedTitle) {
                document.getElementById('mainTitle').textContent = savedTitle;
            }
            if (savedSubtitle) {
                document.getElementById('mainSubtitle').textContent = savedSubtitle;
            }
        }

        // å®¢æˆ·ç®¡ç†ç›¸å…³å˜é‡
        let currentCustomerId = 'default';
        let customers = {};

        // åŠ è½½å®¢æˆ·åˆ—è¡¨
        function loadCustomers() {
            const savedCustomers = localStorage.getItem('dms_customers');
            if (savedCustomers) {
                customers = JSON.parse(savedCustomers);
            } else {
                customers = {
                    'default': {
                        name: 'é»˜è®¤å®¢æˆ·',
                        title: 'å°åˆ·å…¨æµç¨‹è®¡åˆ’ä¹¦ä¸åˆåŒç”Ÿæˆç³»ç»Ÿ',
                        subtitle: 'ä»¥ä¸‹ä¸ºæ–¹æ¡ˆæ˜ç»†ï¼Œåˆ—æ˜å»ºè®®çš„æ ‡å‡†é…ç½®æ¨¡å—åŠå¯é€‰æ¨¡å—'
                    }
                };
            }
            currentCustomerId = localStorage.getItem('dms_currentCustomer') || 'default';
            renderCustomerSelect();
        }

        // æ¸²æŸ“å®¢æˆ·ä¸‹æ‹‰åˆ—è¡¨
        function renderCustomerSelect() {
            const select = document.getElementById('customerSelect');
            select.innerHTML = '';
            for (const id in customers) {
                const option = document.createElement('option');
                option.value = id;
                option.textContent = customers[id].name;
                if (id === currentCustomerId) {
                    option.selected = true;
                }
                select.appendChild(option);
            }
        }

        // ä¿å­˜å®¢æˆ·åˆ—è¡¨
        function saveCustomers() {
            localStorage.setItem('dms_customers', JSON.stringify(customers));
            localStorage.setItem('dms_currentCustomer', currentCustomerId);
        }

        // æ–°å¢å®¢æˆ·
        function addCustomer() {
            const name = prompt('è¯·è¾“å…¥å®¢æˆ·åç§°ï¼ˆå¦‚ï¼šé½é½å“ˆå°”äº‘ä¹‹å°ï¼‰ï¼š');
            if (name && name.trim()) {
                const id = 'customer_' + Date.now();
                const title = prompt('è¯·è¾“å…¥è®¡åˆ’ä¹¦æ ‡é¢˜ï¼ˆå¦‚ï¼šXXå…¬å¸å…¨æµç¨‹è®¡åˆ’ä¹¦ï¼‰ï¼š', name.trim() + 'å…¨æµç¨‹è®¡åˆ’ä¹¦');
                
                // è¯¢é—®æ˜¯å¦ä»ç°æœ‰å®¢æˆ·å¤åˆ¶æ–¹æ¡ˆ
                let copyFromId = null;
                const customerList = Object.keys(customers).filter(cid => cid !== id);
                if (customerList.length > 0) {
                    let copyOptions = 'è¯·é€‰æ‹©æ˜¯å¦ä»ç°æœ‰å®¢æˆ·å¤åˆ¶æ–¹æ¡ˆï¼š\n\n0 - ä½¿ç”¨é»˜è®¤æ–¹æ¡ˆï¼ˆä¸å¤åˆ¶ï¼‰\n';
                    customerList.forEach((cid, idx) => {
                        copyOptions += (idx + 1) + ' - å¤åˆ¶è‡ªã€Œ' + customers[cid].name + 'ã€\n';
                    });
                    const choice = prompt(copyOptions + '\nè¯·è¾“å…¥æ•°å­—ï¼š', '0');
                    if (choice && parseInt(choice) > 0 && parseInt(choice) <= customerList.length) {
                        copyFromId = customerList[parseInt(choice) - 1];
                    }
                }
                
                customers[id] = {
                    name: name.trim(),
                    title: title || name.trim() + 'å…¨æµç¨‹è®¡åˆ’ä¹¦',
                    subtitle: 'OPSæ¥å•åŠç”Ÿäº§ç®¡ç†ç³»ç»Ÿ & Tflowå°å‰è‡ªåŠ¨åŒ–ç³»ç»Ÿ - æ–¹æ¡ˆé…ç½®æ˜ç»†'
                };
                currentCustomerId = id;
                saveCustomers();
                renderCustomerSelect();
                
                // åŠ è½½æ•°æ®ï¼šå¤åˆ¶ç°æœ‰å®¢æˆ·æˆ–ä½¿ç”¨é»˜è®¤
                if (copyFromId) {
                    copyDataFromCustomer(copyFromId);
                    alert('å®¢æˆ· "' + name.trim() + '" å·²æ·»åŠ ï¼Œå¹¶å·²å¤åˆ¶ã€Œ' + customers[copyFromId].name + 'ã€çš„æ–¹æ¡ˆï¼');
                } else {
                    loadDefaultData();
                    alert('å®¢æˆ· "' + name.trim() + '" å·²æ·»åŠ ï¼');
                }
                updateTitleDisplay();
            }
        }
        
        // ä»ç°æœ‰å®¢æˆ·å¤åˆ¶æ•°æ®
        function copyDataFromCustomer(sourceId) {
            const sourcePlans = localStorage.getItem('dms_plans_' + sourceId);
            const sourceFeatures = localStorage.getItem('dms_features_' + sourceId);
            const sourceServices = localStorage.getItem('dms_services_' + sourceId);
            
            if (sourcePlans) {
                plans = JSON.parse(sourcePlans);
            } else {
                plans = JSON.parse(JSON.stringify(getDefaultPlans()));
            }
            if (sourceFeatures) {
                features = JSON.parse(sourceFeatures);
            } else {
                features = JSON.parse(JSON.stringify(getDefaultFeatures()));
            }
            if (sourceServices) {
                services = JSON.parse(sourceServices);
            } else {
                services = JSON.parse(JSON.stringify(getDefaultServices()));
            }
            
            saveData();
            renderPlanTable();
            renderServiceTable();
        }

        // åˆ é™¤å®¢æˆ·
        function deleteCustomer() {
            if (currentCustomerId === 'default') {
                alert('é»˜è®¤å®¢æˆ·ä¸èƒ½åˆ é™¤ï¼');
                return;
            }
            const customerName = customers[currentCustomerId].name;
            if (confirm('ç¡®å®šè¦åˆ é™¤å®¢æˆ· "' + customerName + '" å—ï¼Ÿ\nè¯¥å®¢æˆ·çš„æ‰€æœ‰æ–¹æ¡ˆæ•°æ®å°†è¢«åˆ é™¤ï¼')) {
                // åˆ é™¤å®¢æˆ·æ•°æ®
                localStorage.removeItem('dms_plans_' + currentCustomerId);
                localStorage.removeItem('dms_features_' + currentCustomerId);
                localStorage.removeItem('dms_services_' + currentCustomerId);
                localStorage.removeItem('dms_contract_' + currentCustomerId);
                localStorage.removeItem('dms_form_' + currentCustomerId);
                delete customers[currentCustomerId];
                currentCustomerId = 'default';
                saveCustomers();
                renderCustomerSelect();
                loadCustomerData();
                updateTitleDisplay();
                alert('å®¢æˆ·å·²åˆ é™¤ï¼');
            }
        }

        // åˆ‡æ¢å®¢æˆ·
        function switchCustomer() {
            const select = document.getElementById('customerSelect');
            currentCustomerId = select.value;
            saveCustomers();
            loadCustomerData();
            updateTitleDisplay();
        }

        // ä¿å­˜å½“å‰å®¢æˆ·çš„æ–¹æ¡ˆ
        function saveCurrentCustomer() {
            const key_plans = 'dms_plans_' + currentCustomerId;
            const key_features = 'dms_features_' + currentCustomerId;
            const key_services = 'dms_services_' + currentCustomerId;
            localStorage.setItem(key_plans, JSON.stringify(plans));
            localStorage.setItem(key_features, JSON.stringify(features));
            localStorage.setItem(key_services, JSON.stringify(services));
            // ä¿å­˜åˆåŒå†…å®¹
            if (contractBlocks && contractBlocks.length > 0) {
                saveContractBlocks();
            }
            // ä¿å­˜åˆåŒè¡¨å•æ•°æ®
            saveContractFormData();
            // ä¿å­˜æ ‡é¢˜
            customers[currentCustomerId].title = document.getElementById('mainTitle').textContent;
            customers[currentCustomerId].subtitle = document.getElementById('mainSubtitle').textContent;
            saveCustomers();
            alert('å®¢æˆ· "' + customers[currentCustomerId].name + '" çš„æ–¹æ¡ˆå’ŒåˆåŒå·²ä¿å­˜ï¼');
        }

        // åŠ è½½å®¢æˆ·æ•°æ®
        function loadCustomerData() {
            const key_plans = 'dms_plans_' + currentCustomerId;
            const key_features = 'dms_features_' + currentCustomerId;
            const key_services = 'dms_services_' + currentCustomerId;
            
            const savedPlans = localStorage.getItem(key_plans);
            const savedFeatures = localStorage.getItem(key_features);
            const savedServices = localStorage.getItem(key_services);
            
            if (savedPlans && savedFeatures) {
                plans = JSON.parse(savedPlans);
                features = JSON.parse(savedFeatures);
                services = savedServices ? JSON.parse(savedServices) : getDefaultServices();
            } else {
                loadDefaultData();
            }
            renderPlanTable();
            renderServiceTable();
            // åŠ è½½åˆåŒè¡¨å•æ•°æ®
            loadContractFormData();
        }

        // æ›´æ–°æ ‡é¢˜æ˜¾ç¤º
        function updateTitleDisplay() {
            const customer = customers[currentCustomerId];
            if (customer) {
                document.getElementById('mainTitle').textContent = customer.title;
                document.getElementById('mainSubtitle').textContent = customer.subtitle;
            }
        }

        // åŠ è½½é»˜è®¤æ•°æ®
        function loadDefaultData() {
            plans = JSON.parse(JSON.stringify(getDefaultPlans()));
            features = JSON.parse(JSON.stringify(getDefaultFeatures()));
            services = JSON.parse(JSON.stringify(getDefaultServices()));
        }

        // åˆå§‹åŒ–
        function init() {
            loadCustomers();
            loadCustomerData();
            loadContractFormData();
            updateTitleDisplay();
            // ä¸ºåˆåŒè¡¨å•è¾“å…¥æ¡†æ·»åŠ è‡ªåŠ¨ä¿å­˜
            setupFormAutoSave();
        }

        // ä¸ºåˆåŒè¡¨å•è¾“å…¥æ¡†æ·»åŠ è‡ªåŠ¨ä¿å­˜ï¼ˆå¤±å»ç„¦ç‚¹æ—¶ä¿å­˜ï¼‰
        function setupFormAutoSave() {
            const formInputIds = [
                'party-a-name', 'party-a-address', 'party-a-pm', 'party-a-phone',
                'party-b-name', 'party-b-address', 'party-b-pm', 'party-b-phone', 'party-b-wechat',
                'contract-no', 'original-price', 'discount-price', 'annual-fee'
            ];
            formInputIds.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.addEventListener('blur', saveContractFormData);
                    el.addEventListener('change', saveContractFormData);
                }
            });
        }

        // åŠ è½½æ•°æ®
        function loadData() {
            const savedPlans = localStorage.getItem('dms_plans');
            const savedFeatures = localStorage.getItem('dms_features');
            const savedServices = localStorage.getItem('dms_services');

            plans = savedPlans ? JSON.parse(savedPlans) : JSON.parse(JSON.stringify(getDefaultPlans()));
            features = savedFeatures ? JSON.parse(savedFeatures) : JSON.parse(JSON.stringify(getDefaultFeatures()));
            services = savedServices ? JSON.parse(savedServices) : JSON.parse(JSON.stringify(getDefaultServices()));
        }

        // ä¿å­˜æ•°æ®
        function saveData() {
            localStorage.setItem('dms_plans', JSON.stringify(plans));
            localStorage.setItem('dms_features', JSON.stringify(features));
            localStorage.setItem('dms_services', JSON.stringify(services));
            // åŒæ—¶ä¿å­˜åˆåŒè¡¨å•æ•°æ®
            saveContractFormData();
        }

        // ä¿å­˜åˆåŒè¡¨å•æ•°æ®ï¼ˆæŒ‰å®¢æˆ·ï¼‰
        function saveContractFormData() {
            const formData = {
                partyAName: document.getElementById('party-a-name').value,
                partyAAddress: document.getElementById('party-a-address').value,
                partyAPm: document.getElementById('party-a-pm').value,
                partyAPhone: document.getElementById('party-a-phone').value,
                partyBName: document.getElementById('party-b-name').value,
                partyBAddress: document.getElementById('party-b-address').value,
                partyBPm: document.getElementById('party-b-pm').value,
                partyBPhone: document.getElementById('party-b-phone').value,
                partyBWechat: document.getElementById('party-b-wechat').value,
                contractNo: document.getElementById('contract-no').value,
                originalPrice: document.getElementById('original-price').value,
                discountPrice: document.getElementById('discount-price').value,
                annualFee: document.getElementById('annual-fee').value
            };
            localStorage.setItem('dms_form_' + currentCustomerId, JSON.stringify(formData));
        }

        // åŠ è½½åˆåŒè¡¨å•æ•°æ®ï¼ˆæŒ‰å®¢æˆ·ï¼‰
        function loadContractFormData() {
            const saved = localStorage.getItem('dms_form_' + currentCustomerId);
            if (saved) {
                const formData = JSON.parse(saved);
                document.getElementById('party-a-name').value = formData.partyAName || '';
                document.getElementById('party-a-address').value = formData.partyAAddress || '';
                document.getElementById('party-a-pm').value = formData.partyAPm || '';
                document.getElementById('party-a-phone').value = formData.partyAPhone || '';
                document.getElementById('party-b-name').value = formData.partyBName || 'å¹¿å·å¤šæ™®ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸';
                document.getElementById('party-b-address').value = formData.partyBAddress || 'ä½›å±±å¸‚å—æµ·åŒºä¸‰å±±æ–°åŸå›½é™…åˆ›æ™ºå›­13B906';
                document.getElementById('party-b-pm').value = formData.partyBPm || 'æœä¿Šè£';
                document.getElementById('party-b-phone').value = formData.partyBPhone || '18688891984';
                document.getElementById('party-b-wechat').value = formData.partyBWechat || 'Jorvikdu';
                document.getElementById('contract-no').value = formData.contractNo || '';
                document.getElementById('original-price').value = formData.originalPrice || '';
                document.getElementById('discount-price').value = formData.discountPrice || '';
                document.getElementById('annual-fee').value = formData.annualFee || '58000';
            } else {
                // æ²¡æœ‰ä¿å­˜è¿‡ï¼Œæ¸…ç©ºç”²æ–¹ä¿¡æ¯ï¼Œä¿ç•™ä¹™æ–¹é»˜è®¤å€¼
                document.getElementById('party-a-name').value = '';
                document.getElementById('party-a-address').value = '';
                document.getElementById('party-a-pm').value = '';
                document.getElementById('party-a-phone').value = '';
                document.getElementById('party-b-name').value = 'å¹¿å·å¤šæ™®ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸';
                document.getElementById('party-b-address').value = 'ä½›å±±å¸‚å—æµ·åŒºä¸‰å±±æ–°åŸå›½é™…åˆ›æ™ºå›­13B906';
                document.getElementById('party-b-pm').value = 'æœä¿Šè£';
                document.getElementById('party-b-phone').value = '18688891984';
                document.getElementById('party-b-wechat').value = 'Jorvikdu';
                document.getElementById('contract-no').value = '';
                document.getElementById('original-price').value = '';
                document.getElementById('discount-price').value = '';
                document.getElementById('annual-fee').value = '58000';
            }
        }

        // æ¸²æŸ“æ–¹æ¡ˆè¡¨æ ¼
        function renderPlanTable() {
            const headerRow = document.getElementById('header-row');
            const tbody = document.getElementById('plan-body');

            // æ¸²æŸ“è¡¨å¤´
            headerRow.innerHTML = '<th class="feature-col">åŠŸèƒ½</th>';
            plans.forEach((plan, index) => {
                headerRow.innerHTML += `
                    <th class="plan-header plan-col">
                        <button class="delete-plan-top" onclick="deletePlan(${index})" title="åˆ é™¤æ­¤æ–¹æ¡ˆ">Ã—</button>
                        <span class="plan-name" onclick="editPlanName(${index})">${plan.name}</span>
                        <br>
                        <span class="plan-subtitle" onclick="editPlanSubtitle(${index})">(${plan.subtitle})</span>
                    </th>
                `;
            });

            // æ¸²æŸ“è¡¨ä½“
            tbody.innerHTML = '';

            // ä»·æ ¼è¡Œ
            let priceRow = '<tr class="price-row"><td class="feature-col" style="color: #d35400;">ä»·æ ¼</td>';
            plans.forEach((plan, index) => {
                priceRow += `<td><span class="editable" onclick="editPrice(${index})">${plan.price || 'ç‚¹å‡»è¾“å…¥'}</span></td>`;
            });
            priceRow += '</tr>';
            tbody.innerHTML += priceRow;
            
            // å¤‡æ³¨è¡Œ
            let remarkRow = '<tr class="remark-row"><td class="feature-col" style="color: #666;">å¤‡æ³¨</td>';
            plans.forEach((plan, index) => {
                remarkRow += `<td><span class="editable remark-text" onclick="editRemark(${index})">${plan.remark || 'ç‚¹å‡»æ·»åŠ å¤‡æ³¨'}</span></td>`;
            });
            remarkRow += '</tr>';
            tbody.innerHTML += remarkRow;

            // åŠŸèƒ½è¡Œ
            features.forEach((category, catIndex) => {
                if (category.category) {
                    tbody.innerHTML += `<tr class="category-row">
                        <td colspan="${plans.length + 1}" style="position:relative;">
                            ${category.category}
                            <div class="category-actions">
                                <button class="category-action-btn edit" onclick="editCategory(${catIndex})" title="ç¼–è¾‘åˆ†ç±»å">ç¼–è¾‘</button>
                                <button class="category-action-btn add" onclick="addFeatureToCategory(${catIndex})" title="æ·»åŠ åŠŸèƒ½é¡¹">æ·»åŠ é¡¹</button>
                                <button class="category-action-btn delete" onclick="deleteCategory(${catIndex})" title="åˆ é™¤åˆ†ç±»">åˆ é™¤</button>
                            </div>
                        </td>
                    </tr>`;
                }
                category.features.forEach((feature, featIndex) => {
                    let row = `<tr class="feature-row">
                        <td class="feature-col feature-name-cell">
                            <div class="row-actions">
                                <button class="row-action-btn add-above" onclick="addFeatureAbove(${catIndex}, ${featIndex})" title="åœ¨ä¸Šæ–¹æ·»åŠ ">â†‘</button>
                                <button class="row-action-btn add-below" onclick="addFeatureBelow(${catIndex}, ${featIndex})" title="åœ¨ä¸‹æ–¹æ·»åŠ ">â†“</button>
                                <button class="row-action-btn delete-row" onclick="deleteFeature(${catIndex}, ${featIndex})" title="åˆ é™¤æ­¤è¡Œ">Ã—</button>
                            </div>
                            <span class="feature-name-text" onclick="editFeatureName(${catIndex}, ${featIndex})">${feature.name}</span>
                        </td>`;
                    plans.forEach((plan, planIndex) => {
                        const value = feature.values[planIndex] || '';
                        let displayValue = '';
                        let className = 'empty';
                        if (value === 'âœ”') {
                            displayValue = 'âœ”';
                            className = 'check';
                        } else if (value === 'âœ˜') {
                            displayValue = 'âœ˜';
                            className = 'cross';
                        } else if (value && value !== '') {
                            // æ˜¾ç¤ºä»·æ ¼
                            displayValue = value;
                            className = 'price-value';
                        }
                        row += `<td><span class="${className}" onclick="toggleValue(${catIndex}, ${featIndex}, ${planIndex})">${displayValue || 'â—‹'}</span></td>`;
                    });
                    row += '</tr>';
                    tbody.innerHTML += row;
                });
            });
        }

        // æ¸²æŸ“æœåŠ¡çº§åˆ«è¡¨æ ¼
        function renderServiceTable() {
            const tbody = document.getElementById('service-body');
            tbody.innerHTML = '';

            services.forEach((service, index) => {
                tbody.innerHTML += `
                    <tr class="service-row">
                        <td class="editable-cell" onclick="editServiceCell(${index}, 'level')">
                            <div class="service-row-actions">
                                <button class="service-action-btn add-above" title="åœ¨ä¸Šæ–¹æ·»åŠ " onclick="event.stopPropagation();addServiceAt(${index})">â†‘</button>
                                <button class="service-action-btn add-below" title="åœ¨ä¸‹æ–¹æ·»åŠ " onclick="event.stopPropagation();addServiceAt(${index + 1})">â†“</button>
                                <button class="service-action-btn del-row" title="åˆ é™¤" onclick="event.stopPropagation();deleteService(${index})">Ã—</button>
                            </div>
                            ${service.level}
                        </td>
                        <td class="editable-cell" onclick="editServiceCell(${index}, 'content')" style="white-space: pre-line;">${service.content}</td>
                        <td class="editable-cell" onclick="editServiceCell(${index}, 'price')">${service.price}</td>
                    </tr>
                `;
            });
        }

        // åˆ‡æ¢å‹¾é€‰å€¼
        function toggleValue(catIndex, featIndex, planIndex) {
            const currentValue = features[catIndex].features[featIndex].values[planIndex] || '';
            let newValue = '';
            if (currentValue === '') {
                newValue = 'âœ”';
            } else if (currentValue === 'âœ”') {
                newValue = 'âœ˜';
            } else if (currentValue === 'âœ˜') {
                // åˆ‡æ¢åˆ°å¡«å†™ä»·æ ¼çŠ¶æ€
                const price = prompt('è¯·è¾“å…¥ä»·æ ¼ï¼ˆå¦‚ï¼š5000å…ƒã€1ä¸‡ï¼‰ï¼š', '');
                if (price !== null && price.trim()) {
                    newValue = price.trim();
                } else {
                    newValue = '';
                }
            } else {
                // å½“å‰æ˜¯ä»·æ ¼ï¼Œåˆ‡æ¢å›ç©ºç™½
                newValue = '';
            }
            features[catIndex].features[featIndex].values[planIndex] = newValue;
            saveData();
            renderPlanTable();
        }

        // ç¼–è¾‘æ–¹æ¡ˆåç§°
        function editPlanName(index) {
            const newName = prompt('è¯·è¾“å…¥æ–¹æ¡ˆåç§°ï¼š', plans[index].name);
            if (newName !== null && newName.trim()) {
                plans[index].name = newName.trim();
                saveData();
                renderPlanTable();
            }
        }

        // ç¼–è¾‘æ–¹æ¡ˆå‰¯æ ‡é¢˜
        function editPlanSubtitle(index) {
            const newSubtitle = prompt('è¯·è¾“å…¥æ–¹æ¡ˆå‰¯æ ‡é¢˜ï¼š', plans[index].subtitle);
            if (newSubtitle !== null) {
                plans[index].subtitle = newSubtitle.trim();
                saveData();
                renderPlanTable();
            }
        }

        // ç¼–è¾‘ä»·æ ¼
        function editPrice(index) {
            const newPrice = prompt('è¯·è¾“å…¥ä»·æ ¼ï¼š', plans[index].price);
            if (newPrice !== null) {
                plans[index].price = newPrice.trim();
                saveData();
                renderPlanTable();
            }
        }
        
        // ç¼–è¾‘å¤‡æ³¨
        function editRemark(index) {
            const newRemark = prompt('è¯·è¾“å…¥æ–¹æ¡ˆå¤‡æ³¨ï¼ˆæè¿°æ­¤æ–¹æ¡ˆçš„ç‰¹ç‚¹ï¼‰ï¼š', plans[index].remark || '');
            if (newRemark !== null) {
                plans[index].remark = newRemark.trim();
                saveData();
                renderPlanTable();
            }
        }

        // æ·»åŠ æ–¹æ¡ˆ
        function addPlan() {
            // æ„å»ºä½ç½®é€‰æ‹©å¯¹è¯æ¡†
            let positionOptions = '<option value="-1">åœ¨æœ€åæ·»åŠ </option>';
            for (let i = 0; i < plans.length; i++) {
                positionOptions += `<option value="${i}">åœ¨"${plans[i].name}"åé¢</option>`;
            }
            
            // åˆ›å»ºè‡ªå®šä¹‰å¯¹è¯æ¡†
            const dialog = document.createElement('div');
            dialog.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:10000;';
            dialog.innerHTML = `
                <div style="background:white;padding:30px;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.3);max-width:400px;width:90%;">
                    <h3 style="margin-bottom:20px;color:#2c5282;">æ·»åŠ æ–°æ–¹æ¡ˆ</h3>
                    <div style="margin-bottom:15px;">
                        <label style="display:block;margin-bottom:8px;font-weight:500;">æ–¹æ¡ˆåç§°ï¼š</label>
                        <input type="text" id="new-plan-name" value="æ–¹æ¡ˆ${plans.length + 1}" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:14px;">
                    </div>
                    <div style="margin-bottom:20px;">
                        <label style="display:block;margin-bottom:8px;font-weight:500;">æ’å…¥ä½ç½®ï¼š</label>
                        <select id="new-plan-position" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:14px;">
                            ${positionOptions}
                        </select>
                    </div>
                    <div style="display:flex;gap:10px;justify-content:flex-end;">
                        <button id="cancel-add-plan" style="padding:10px 20px;border:1px solid #ddd;background:white;border-radius:6px;cursor:pointer;">å–æ¶ˆ</button>
                        <button id="confirm-add-plan" style="padding:10px 20px;border:none;background:#27ae60;color:white;border-radius:6px;cursor:pointer;">ç¡®å®šæ·»åŠ </button>
                    </div>
                </div>
            `;
            document.body.appendChild(dialog);
            
            // èšç„¦åˆ°åç§°è¾“å…¥æ¡†
            document.getElementById('new-plan-name').focus();
            document.getElementById('new-plan-name').select();
            
            // å–æ¶ˆæŒ‰é’®
            document.getElementById('cancel-add-plan').onclick = function() {
                document.body.removeChild(dialog);
            };
            
            // ç¡®å®šæŒ‰é’®
            document.getElementById('confirm-add-plan').onclick = function() {
                const planName = document.getElementById('new-plan-name').value.trim() || `æ–¹æ¡ˆ${plans.length + 1}`;
                const position = parseInt(document.getElementById('new-plan-position').value);
                
                const newPlan = {
                    name: planName,
                    subtitle: 'è‡ªå®šä¹‰',
                    price: '',
                    remark: ''
                };
                
                if (position === -1) {
                    // æ·»åŠ åˆ°æœ€å
                    plans.push(newPlan);
                    features.forEach(category => {
                        category.features.forEach(feature => {
                            feature.values.push('');
                        });
                    });
                } else {
                    // æ’å…¥åˆ°æŒ‡å®šä½ç½®åé¢
                    const insertIndex = position + 1;
                    plans.splice(insertIndex, 0, newPlan);
                    features.forEach(category => {
                        category.features.forEach(feature => {
                            feature.values.splice(insertIndex, 0, '');
                        });
                    });
                }
                
                saveData();
                renderPlanTable();
                document.body.removeChild(dialog);
            };
            
            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            dialog.onclick = function(e) {
                if (e.target === dialog) {
                    document.body.removeChild(dialog);
                }
            };
            
            // å›è½¦ç¡®è®¤
            dialog.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('confirm-add-plan').click();
                } else if (e.key === 'Escape') {
                    document.body.removeChild(dialog);
                }
            });
        }

        // åˆ é™¤æ–¹æ¡ˆ
        function deletePlan(index) {
            if (plans.length <= 1) {
                alert('è‡³å°‘ä¿ç•™ä¸€ä¸ªæ–¹æ¡ˆï¼');
                return;
            }
            if (confirm(`ç¡®å®šåˆ é™¤"${plans[index].name}"å—ï¼Ÿ`)) {
                plans.splice(index, 1);
                features.forEach(category => {
                    category.features.forEach(feature => {
                        feature.values.splice(index, 1);
                    });
                });
                saveData();
                renderPlanTable();
            }
        }

        // ç¼–è¾‘æœåŠ¡çº§åˆ«å•å…ƒæ ¼
        function editServiceCell(index, field) {
            const currentValue = services[index][field];
            const newValue = prompt(`è¯·è¾“å…¥${field === 'level' ? 'æœåŠ¡çº§åˆ«' : field === 'content' ? 'æœåŠ¡å†…å®¹' : 'ä»·æ ¼'}ï¼š`, currentValue);
            if (newValue !== null) {
                services[index][field] = newValue;
                saveData();
                renderServiceTable();
            }
        }

        // ç¼–è¾‘åŠŸèƒ½é¡¹åç§°
        function editFeatureName(catIndex, featIndex) {
            const currentName = features[catIndex].features[featIndex].name;
            const newName = prompt('è¯·è¾“å…¥åŠŸèƒ½é¡¹åç§°ï¼š', currentName);
            if (newName !== null && newName.trim()) {
                features[catIndex].features[featIndex].name = newName.trim();
                saveData();
                renderPlanTable();
            }
        }

        // åœ¨ä¸Šæ–¹æ·»åŠ åŠŸèƒ½é¡¹
        function addFeatureAbove(catIndex, featIndex) {
            const newName = prompt('è¯·è¾“å…¥æ–°åŠŸèƒ½é¡¹åç§°ï¼š', 'æ–°åŠŸèƒ½é¡¹');
            if (newName !== null && newName.trim()) {
                const newFeature = {
                    name: newName.trim(),
                    values: plans.map(() => '')
                };
                features[catIndex].features.splice(featIndex, 0, newFeature);
                saveData();
                renderPlanTable();
            }
        }

        // åœ¨ä¸‹æ–¹æ·»åŠ åŠŸèƒ½é¡¹
        function addFeatureBelow(catIndex, featIndex) {
            const newName = prompt('è¯·è¾“å…¥æ–°åŠŸèƒ½é¡¹åç§°ï¼š', 'æ–°åŠŸèƒ½é¡¹');
            if (newName !== null && newName.trim()) {
                const newFeature = {
                    name: newName.trim(),
                    values: plans.map(() => '')
                };
                features[catIndex].features.splice(featIndex + 1, 0, newFeature);
                saveData();
                renderPlanTable();
            }
        }

        // åˆ é™¤åŠŸèƒ½é¡¹
        function deleteFeature(catIndex, featIndex) {
            const featureName = features[catIndex].features[featIndex].name;
            if (confirm(`ç¡®å®šåˆ é™¤â€œ${featureName}â€å—ï¼Ÿ`)) {
                features[catIndex].features.splice(featIndex, 1);
                saveData();
                renderPlanTable();
            }
        }

        // ç¼–è¾‘åˆ†ç±»åç§°
        function editCategory(catIndex) {
            const currentName = features[catIndex].category;
            const newName = prompt('è¯·è¾“å…¥åˆ†ç±»åç§°ï¼š', currentName);
            if (newName !== null) {
                features[catIndex].category = newName.trim();
                saveData();
                renderPlanTable();
            }
        }

        // å‘åˆ†ç±»æ·»åŠ åŠŸèƒ½é¡¹
        function addFeatureToCategory(catIndex) {
            const newName = prompt('è¯·è¾“å…¥æ–°åŠŸèƒ½é¡¹åç§°ï¼š', 'æ–°åŠŸèƒ½é¡¹');
            if (newName !== null && newName.trim()) {
                const newFeature = {
                    name: newName.trim(),
                    values: plans.map(() => '')
                };
                features[catIndex].features.push(newFeature);
                saveData();
                renderPlanTable();
            }
        }

        // åˆ é™¤åˆ†ç±»
        function deleteCategory(catIndex) {
            const categoryName = features[catIndex].category || 'æ­¤åˆ†ç±»';
            const featureCount = features[catIndex].features.length;
            if (confirm(`ç¡®å®šåˆ é™¤â€œ${categoryName}â€åŠå…¶ä¸‹çš„ ${featureCount} ä¸ªåŠŸèƒ½é¡¹å—ï¼Ÿ`)) {
                features.splice(catIndex, 1);
                saveData();
                renderPlanTable();
            }
        }

        // æ·»åŠ æœåŠ¡çº§åˆ«
        function addServiceLevel() {
            services.push({
                level: 'æ–°çº§åˆ«',
                content: 'è¯·è¾“å…¥æœåŠ¡å†…å®¹',
                price: 'å¾…å®š'
            });
            saveData();
            renderServiceTable();
        }

        // åœ¨æŒ‡å®šä½ç½®æ·»åŠ æœåŠ¡çº§åˆ«
        function addServiceAt(position) {
            const newService = {
                level: 'æ–°çº§åˆ«',
                content: 'è¯·è¾“å…¥æœåŠ¡å†…å®¹',
                price: 'å¾…å®š'
            };
            services.splice(position, 0, newService);
            saveData();
            renderServiceTable();
        }

        // åˆ é™¤æœåŠ¡çº§åˆ«
        function deleteService(index) {
            if (confirm('ç¡®å®šåˆ é™¤æ­¤æœåŠ¡çº§åˆ«å—ï¼Ÿ')) {
                services.splice(index, 1);
                saveData();
                renderServiceTable();
            }
        }

        // æ˜¾ç¤ºæ ‡ç­¾é¡µ
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.panel').forEach(panel => panel.classList.remove('active'));

            document.querySelector(`.tab[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}-panel`).classList.add('active');

            if (tabName === 'contract') {
                renderPlanCards();
            }
        }

        // æ¸²æŸ“æ–¹æ¡ˆé€‰æ‹©å¡ç‰‡
        function renderPlanCards() {
            const container = document.getElementById('plan-cards');
            container.innerHTML = '';

            plans.forEach((plan, index) => {
                container.innerHTML += `
                    <div class="plan-card ${selectedPlanIndex === index ? 'selected' : ''}" onclick="selectPlan(${index})">
                        <h4>${plan.name}</h4>
                        <p>${plan.subtitle}</p>
                        <p class="price">${plan.price || 'å¾…å®š'}</p>
                    </div>
                `;
            });
        }

        // é€‰æ‹©æ–¹æ¡ˆ
        function selectPlan(index) {
            selectedPlanIndex = index;
            renderPlanCards();
        }

        // ç”ŸæˆåˆåŒ
        function generateContract() {
            if (selectedPlanIndex === -1) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ–¹æ¡ˆï¼');
                return;
            }

            // åŠ è½½è¯¥å®¢æˆ·çš„åˆåŒå†…å®¹å—
            loadContractBlocks();

            const partyAName = document.getElementById('party-a-name').value || '________';
            const partyAAddress = document.getElementById('party-a-address').value || '________';
            const partyAPM = document.getElementById('party-a-pm').value || '________';
            const partyAPhone = document.getElementById('party-a-phone').value || '________';
            const partyBName = document.getElementById('party-b-name').value;
            const partyBAddress = document.getElementById('party-b-address').value;
            const partyBPM = document.getElementById('party-b-pm').value;
            const partyBPhone = document.getElementById('party-b-phone').value;
            const partyBWechat = document.getElementById('party-b-wechat').value;
            const contractNo = document.getElementById('contract-no').value || 'INV-________';
            const originalPrice = document.getElementById('original-price').value || '____';
            const discountPrice = document.getElementById('discount-price').value || '____';
            const annualFee = document.getElementById('annual-fee').value || '____';

            const selectedPlan = plans[selectedPlanIndex];

            // æ¨¡æ¿å˜é‡æ˜ å°„
            const templateVars = {
                '{{partyAName}}': partyAName,
                '{{partyAAddress}}': partyAAddress,
                '{{partyAPM}}': partyAPM,
                '{{partyAPhone}}': partyAPhone,
                '{{partyBName}}': partyBName,
                '{{partyBAddress}}': partyBAddress,
                '{{partyBPM}}': partyBPM,
                '{{partyBPhone}}': partyBPhone,
                '{{partyBWechat}}': partyBWechat,
                '{{contractNo}}': contractNo,
                '{{originalPrice}}': originalPrice,
                '{{discountPrice}}': discountPrice,
                '{{annualFee}}': annualFee
            };

            // ç”ŸæˆåŠŸèƒ½æ¸…å•è¡¨æ ¼
            let featureTableHTML = '<table style="width:100%; margin: 20px 0;"><thead><tr><th style="text-align:left;">åŠŸèƒ½</th><th style="width:80px;">åŒ…å«</th></tr></thead><tbody>';
            features.forEach(category => {
                if (category.category) {
                    featureTableHTML += `<tr class="category-row"><td colspan="2" style="background:#e8ecf4; font-weight:bold;">${category.category}</td></tr>`;
                }
                category.features.forEach(feature => {
                    const value = feature.values[selectedPlanIndex] || '';
                    const display = value === 'âœ”' ? '<span style="color:#27ae60;">âœ”</span>' : (value === 'âœ˜' ? '<span style="color:#e74c3c;">âœ˜</span>' : '-');
                    featureTableHTML += `<tr><td style="text-align:left;">${feature.name}</td><td style="text-align:center;">${display}</td></tr>`;
                });
            });
            featureTableHTML += '</tbody></table>';

            // ç”ŸæˆæœåŠ¡çº§åˆ«è¡¨æ ¼
            let serviceTableHTML = '<table style="width:100%; margin: 20px 0; table-layout: fixed;"><thead><tr><th style="width:12%">æœåŠ¡çº§åˆ«</th><th style="width:58%">æœåŠ¡å†…å®¹</th><th style="width:30%">ä»·æ ¼</th></tr></thead><tbody>';
            services.forEach(service => {
                serviceTableHTML += `<tr><td style="vertical-align:top; word-wrap:break-word;">${service.level}</td><td style="white-space:pre-line; text-align:left; word-wrap:break-word;">${service.content}</td><td style="text-align:right; word-wrap:break-word;">${service.price}</td></tr>`;
            });
            serviceTableHTML += '</tbody></table>';

            // ä» contractBlocks æ•°æ®é©±åŠ¨æ¸²æŸ“åˆåŒ
            let contractHTML = '';
            contractBlocks.forEach((block, idx) => {
                let blockContent = block.content;
                // æ›¿æ¢æ¨¡æ¿å˜é‡
                for (const [key, val] of Object.entries(templateVars)) {
                    blockContent = blockContent.split(key).join(val);
                }
                if (block.title) {
                    block.title = block.title;
                }

                let html = '';
                switch (block.type) {
                    case 'footer-info':
                        html = `<div class="footer-info">${blockContent}</div>`;
                        break;
                    case 'h1':
                        html = `<h1>${blockContent}</h1>`;
                        break;
                    case 'h2':
                        html = `<h2>${blockContent}</h2>`;
                        break;
                    case 'h3':
                        html = `<h3>${blockContent}</h3>`;
                        break;
                    case 'contract-header':
                        html = `<div class="contract-header">${blockContent}</div>`;
                        break;
                    case 'party-info':
                        const partyLines = blockContent.split('\n');
                        html = '<div class="party-info">' + partyLines.map(line => {
                            const parts = line.split('ï¼š');
                            return `<p><strong>${parts[0]}ï¼š</strong>${parts.slice(1).join('ï¼š')}</p>`;
                        }).join('') + '</div>';
                        break;
                    case 'paragraph':
                        html = `<p>${blockContent}</p>`;
                        break;
                    case 'paragraph-bold':
                        html = `<p><strong>${blockContent}</strong></p>`;
                        break;
                    case 'article':
                        html = `<div class="article"><p>${blockContent}</p></div>`;
                        break;
                    case 'article-titled':
                        const titleText = block.title || '';
                        const contentLines = blockContent.split('\n');
                        const firstLine = contentLines[0];
                        const restLines = contentLines.slice(1);
                        html = `<div class="article"><p class="article-title">${titleText}</p><p>${firstLine}</p>`;
                        restLines.forEach(line => {
                            html += `<p class="sub-item">${line}</p>`;
                        });
                        html += '</div>';
                        break;
                    case 'pm-info-a':
                    case 'pm-info-b':
                        const pmLines = blockContent.split('\n');
                        html = '<div class="article">';
                        pmLines.forEach((line, i) => {
                            if (i === 0) {
                                html += `<p><strong>${line}</strong></p>`;
                            } else {
                                html += `<p class="sub-item">${line}</p>`;
                            }
                        });
                        html += '</div>';
                        break;
                    case 'sub-items':
                        const subLines = blockContent.split('\n');
                        html = subLines.map(line => `<p class="sub-item">${line}</p>`).join('');
                        break;
                    case 'feature-table':
                        html = featureTableHTML;
                        break;
                    case 'service-table':
                        html = serviceTableHTML;
                        break;
                    case 'signature':
                        html = `<div class="signature">
                            <div class="signature-block">
                                <p><strong>ç”²æ–¹ï¼š</strong></p>
                                <div class="signature-line"></div>
                                <p><strong>ç­¾çº¦ä»£è¡¨ï¼š</strong></p>
                                <div class="signature-line"></div>
                                <p><strong>æ—¥æœŸï¼š</strong>____å¹´____æœˆ____æ—¥</p>
                            </div>
                            <div class="signature-block">
                                <p><strong>ä¹™æ–¹ï¼š</strong></p>
                                <div class="signature-line"></div>
                                <p><strong>ç­¾çº¦ä»£è¡¨ï¼š</strong></p>
                                <div class="signature-line"></div>
                                <p><strong>æ—¥æœŸï¼š</strong>____å¹´____æœˆ____æ—¥</p>
                            </div>
                        </div>`;
                        break;
                    case 'appendix-a-title':
                    case 'appendix-b-title':
                        html = `<div class="appendix"><h2>${blockContent}</h2></div>`;
                        break;
                    case 'sla-level':
                        const slaTitle = block.title || '';
                        const slaLines = blockContent.split('\n');
                        html = `<p><strong>${slaTitle}</strong></p>`;
                        slaLines.forEach(line => {
                            if (line.startsWith('â€¢')) {
                                html += `<p class="sub-item">${line}</p>`;
                            } else {
                                html += `<p>${line}</p>`;
                            }
                        });
                        break;
                    case 'appendix-b-table':
                        const rows = blockContent.split('\n');
                        html = '<table style="width:100%; margin: 20px 0;"><thead><tr><th>äº§å“</th><th>åŠŸèƒ½æè¿°</th><th>å•ä»·</th></tr></thead><tbody>';
                        rows.forEach(row => {
                            const cols = row.split('|');
                            html += `<tr><td>${cols[0] || ''}</td><td>${cols[1] || ''}</td><td>${cols[2] || ''}</td></tr>`;
                        });
                        html += '</tbody></table>';
                        break;
                    default:
                        html = `<p>${blockContent}</p>`;
                }

                // ç¼–è¾‘æ¨¡å¼ä¸‹åŒ…è£¹ editable-block
                contractHTML += `<div class="editable-block" data-block-idx="${idx}" onclick="editContractBlock(${idx})">
                    <div class="block-actions">
                        <button class="block-action-btn add-block" onclick="event.stopPropagation(); addContractBlock(${idx})" title="åœ¨ä¸Šæ–¹æ·»åŠ ">â†‘</button>
                        <button class="block-action-btn add-block" onclick="event.stopPropagation(); addContractBlock(${idx + 1})" title="åœ¨ä¸‹æ–¹æ·»åŠ ">â†“</button>
                        <button class="block-action-btn del-block" onclick="event.stopPropagation(); deleteContractBlock(${idx})" title="åˆ é™¤">Ã—</button>
                    </div>
                    ${html}
                </div>`;
            });

            document.getElementById('contract-content').innerHTML = contractHTML;
            showTab('preview');
        }

        // ======== åˆåŒå†…å®¹ç¼–è¾‘åŠŸèƒ½ ========

        // åŠ è½½åˆåŒå†…å®¹å—
        function loadContractBlocks() {
            const key = 'dms_contract_' + currentCustomerId;
            const saved = localStorage.getItem(key);
            if (saved) {
                contractBlocks = JSON.parse(saved);
            } else {
                contractBlocks = JSON.parse(JSON.stringify(getDefaultContractBlocks()));
            }
        }

        // ä¿å­˜åˆåŒå†…å®¹å—
        function saveContractBlocks() {
            const key = 'dms_contract_' + currentCustomerId;
            localStorage.setItem(key, JSON.stringify(contractBlocks));
        }

        // åˆ‡æ¢åˆåŒç¼–è¾‘æ¨¡å¼
        function toggleContractEditMode() {
            contractEditMode = !contractEditMode;
            const btn = document.getElementById('editModeBtn');
            const info = document.getElementById('editModeInfo');
            const preview = document.getElementById('contract-content');

            if (contractEditMode) {
                btn.textContent = 'é€€å‡ºç¼–è¾‘æ¨¡å¼';
                btn.className = 'edit-mode-btn edit-on';
                info.textContent = 'ç¼–è¾‘æ¨¡å¼å·²å¼€å¯ï¼šç‚¹å‡»ä»»æ„æ®µè½å¯ä¿®æ”¹å†…å®¹ï¼Œæ‚¬åœæ˜¾ç¤ºæ“ä½œæŒ‰é’®';
                preview.classList.add('editing');
            } else {
                btn.textContent = 'ç¼–è¾‘åˆåŒå†…å®¹';
                btn.className = 'edit-mode-btn edit-off';
                info.textContent = 'ç‚¹å‡»"ç¼–è¾‘åˆåŒå†…å®¹"å¯ä»¥ç›´æ¥ä¿®æ”¹åˆåŒæ–‡å­—';
                preview.classList.remove('editing');
            }
        }

        // ç¼–è¾‘åˆåŒå†…å®¹å—
        function editContractBlock(idx) {
            if (!contractEditMode) return;
            const block = contractBlocks[idx];
            if (!block) return;
            // ä¸å¯ç¼–è¾‘çš„ç±»å‹
            if (block.type === 'feature-table' || block.type === 'service-table' || block.type === 'signature') {
                alert('æ­¤å†…å®¹å—ä¸ºè‡ªåŠ¨ç”Ÿæˆï¼Œæ— æ³•ç›´æ¥ç¼–è¾‘ã€‚\nåŠŸèƒ½è¡¨æ ¼è¯·åœ¨"æ–¹æ¡ˆé…ç½®"ä¸­ä¿®æ”¹ï¼ŒæœåŠ¡è¡¨æ ¼è¯·åœ¨æœåŠ¡çº§åˆ«ä¸­ä¿®æ”¹ã€‚');
                return;
            }

            // åˆ›å»ºç¼–è¾‘å¯¹è¯æ¡†
            const dialog = document.createElement('div');
            dialog.className = 'contract-edit-dialog';
            dialog.onclick = function(e) { if (e.target === dialog) dialog.remove(); };

            const typeLabels = {
                'footer-info': 'é¡µè„šä¿¡æ¯', 'h1': 'ä¸»æ ‡é¢˜', 'h2': 'äºŒçº§æ ‡é¢˜', 'h3': 'ä¸‰çº§æ ‡é¢˜',
                'contract-header': 'åˆåŒå¤´éƒ¨', 'party-info': 'ç”²ä¹™æ–¹ä¿¡æ¯', 'paragraph': 'æ®µè½',
                'paragraph-bold': 'åŠ ç²—æ®µè½', 'article': 'æ¡æ¬¾', 'article-titled': 'å¸¦æ ‡é¢˜æ¡æ¬¾',
                'pm-info-a': 'ç”²æ–¹é¡¹ç›®ç»ç†', 'pm-info-b': 'ä¹™æ–¹é¡¹ç›®ç»ç†',
                'sub-items': 'å­é¡¹åˆ—è¡¨', 'sla-level': 'SLAçº§åˆ«',
                'appendix-a-title': 'é™„ä»¶Aæ ‡é¢˜', 'appendix-b-title': 'é™„ä»¶Bæ ‡é¢˜',
                'appendix-b-table': 'é™„ä»¶Bè¡¨æ ¼'
            };

            let titleField = '';
            if (block.type === 'article-titled' || block.type === 'sla-level') {
                titleField = `<div style="margin-bottom:10px;"><label style="font-weight:bold;">æ ‡é¢˜ï¼š</label><input type="text" id="edit-block-title" value="${(block.title || '').replace(/"/g, '&quot;')}" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;font-size:14px;"></div>`;
            }

            let typeOptions = '';
            for (const [t, label] of Object.entries(typeLabels)) {
                typeOptions += `<option value="${t}" ${t === block.type ? 'selected' : ''}>${label}</option>`;
            }

            dialog.innerHTML = `
                <div class="dialog-content">
                    <h3>ç¼–è¾‘åˆåŒå†…å®¹å— #${idx + 1}</h3>
                    <div style="margin-bottom:10px;">
                        <label style="font-weight:bold;">ç±»å‹ï¼š</label>
                        <select id="edit-block-type" style="padding:6px;border-radius:4px;border:1px solid #ddd;">
                            ${typeOptions}
                        </select>
                    </div>
                    ${titleField}
                    <label style="font-weight:bold;">å†…å®¹ï¼š</label>
                    <textarea id="edit-block-content">${block.content.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</textarea>
                    <p style="font-size:12px;color:#888;margin-top:5px;">æç¤ºï¼šç”¨ \n æ¢è¡Œï¼Œæ”¯æŒæ¨¡æ¿å˜é‡å¦‚ {{partyAName}}ã€{{contractNo}} ç­‰</p>
                    <div class="dialog-btns">
                        <button style="background:#eee;border:1px solid #ddd;" onclick="this.closest('.contract-edit-dialog').remove()">å–æ¶ˆ</button>
                        <button style="background:#3498db;color:white;border:none;" onclick="saveBlockEdit(${idx})">ä¿å­˜</button>
                    </div>
                </div>
            `;
            document.body.appendChild(dialog);
            // è‡ªåŠ¨èšç„¦textarea
            setTimeout(() => document.getElementById('edit-block-content').focus(), 100);
        }

        // ä¿å­˜å—ç¼–è¾‘
        function saveBlockEdit(idx) {
            const content = document.getElementById('edit-block-content').value;
            const type = document.getElementById('edit-block-type').value;
            const titleEl = document.getElementById('edit-block-title');

            contractBlocks[idx].content = content;
            contractBlocks[idx].type = type;
            if (titleEl) {
                contractBlocks[idx].title = titleEl.value;
            }

            saveContractBlocks();
            document.querySelector('.contract-edit-dialog').remove();
            // é‡æ–°æ¸²æŸ“åˆåŒ
            generateContract();
            // ä¿æŒç¼–è¾‘æ¨¡å¼
            if (contractEditMode) {
                document.getElementById('contract-content').classList.add('editing');
            }
        }

        // æ·»åŠ åˆåŒå†…å®¹å—
        function addContractBlock(position) {
            if (!contractEditMode) return;
            const typeLabels = {
                'paragraph': 'æ®µè½', 'paragraph-bold': 'åŠ ç²—æ®µè½', 'h2': 'äºŒçº§æ ‡é¢˜',
                'h3': 'ä¸‰çº§æ ‡é¢˜', 'sub-items': 'å­é¡¹åˆ—è¡¨', 'article': 'æ¡æ¬¾',
                'article-titled': 'å¸¦æ ‡é¢˜æ¡æ¬¾', 'footer-info': 'é¡µè„šä¿¡æ¯',
                'signature': 'ç­¾åæ ', 'sla-level': 'SLAçº§åˆ«'
            };

            const dialog = document.createElement('div');
            dialog.className = 'contract-edit-dialog';
            dialog.onclick = function(e) { if (e.target === dialog) dialog.remove(); };

            let typeOptions = '';
            for (const [t, label] of Object.entries(typeLabels)) {
                typeOptions += `<option value="${t}">${label}</option>`;
            }

            dialog.innerHTML = `
                <div class="dialog-content">
                    <h3>æ·»åŠ æ–°å†…å®¹å—ï¼ˆæ’å…¥åˆ°ç¬¬ ${position + 1} ä½ç½®ï¼‰</h3>
                    <div style="margin-bottom:10px;">
                        <label style="font-weight:bold;">ç±»å‹ï¼š</label>
                        <select id="new-block-type" style="padding:6px;border-radius:4px;border:1px solid #ddd;">
                            ${typeOptions}
                        </select>
                    </div>
                    <label style="font-weight:bold;">å†…å®¹ï¼š</label>
                    <textarea id="new-block-content" placeholder="è¯·è¾“å…¥å†…å®¹..."></textarea>
                    <div class="dialog-btns">
                        <button style="background:#eee;border:1px solid #ddd;" onclick="this.closest('.contract-edit-dialog').remove()">å–æ¶ˆ</button>
                        <button style="background:#27ae60;color:white;border:none;" onclick="confirmAddBlock(${position})">æ·»åŠ </button>
                    </div>
                </div>
            `;
            document.body.appendChild(dialog);
        }

        // ç¡®è®¤æ·»åŠ å—
        function confirmAddBlock(position) {
            const type = document.getElementById('new-block-type').value;
            const content = document.getElementById('new-block-content').value;
            if (!content.trim() && type !== 'signature') {
                alert('è¯·è¾“å…¥å†…å®¹ï¼');
                return;
            }
            const newBlock = { type: type, content: content };
            contractBlocks.splice(position, 0, newBlock);
            saveContractBlocks();
            document.querySelector('.contract-edit-dialog').remove();
            generateContract();
            if (contractEditMode) {
                document.getElementById('contract-content').classList.add('editing');
            }
        }

        // åˆ é™¤åˆåŒå†…å®¹å—
        function deleteContractBlock(idx) {
            if (!contractEditMode) return;
            const block = contractBlocks[idx];
            const preview = block.content.substring(0, 30) + (block.content.length > 30 ? '...' : '');
            if (confirm(`ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå†…å®¹å—å—ï¼Ÿ\n"${preview}"`)) {
                contractBlocks.splice(idx, 1);
                saveContractBlocks();
                generateContract();
                if (contractEditMode) {
                    document.getElementById('contract-content').classList.add('editing');
                }
            }
        }

        // ä¿å­˜åˆåŒå†…å®¹
        function saveContractContent() {
            saveContractBlocks();
            alert('åˆåŒå†…å®¹å·²ä¿å­˜åˆ°å®¢æˆ· "' + customers[currentCustomerId].name + '" ï¼');
        }

        // æ¢å¤é»˜è®¤åˆåŒå†…å®¹
        function resetContractContent() {
            if (confirm('ç¡®å®šè¦æ¢å¤é»˜è®¤åˆåŒå†…å®¹å—ï¼Ÿ\nå½“å‰å®¢æˆ·çš„åˆåŒä¿®æ”¹å°†ä¼šä¸¢å¤±ï¼')) {
                localStorage.removeItem('dms_contract_' + currentCustomerId);
                contractBlocks = JSON.parse(JSON.stringify(getDefaultContractBlocks()));
                generateContract();
                if (contractEditMode) {
                    document.getElementById('contract-content').classList.add('editing');
                }
                alert('å·²æ¢å¤é»˜è®¤åˆåŒå†…å®¹ï¼');
            }
        }

        // å¯¼å‡ºExcel
        function exportExcel() {
            let csv = '\ufeffåŠŸèƒ½';
            plans.forEach(plan => {
                csv += `,${plan.name}(${plan.subtitle})`;
            });
            csv += '\n';

            csv += 'ä»·æ ¼';
            plans.forEach(plan => {
                csv += `,${plan.price}`;
            });
            csv += '\n';

            features.forEach(category => {
                if (category.category) {
                    csv += `${category.category}\n`;
                }
                category.features.forEach(feature => {
                    csv += feature.name;
                    plans.forEach((plan, index) => {
                        csv += `,${feature.values[index] || ''}`;
                    });
                    csv += '\n';
                });
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'æ–¹æ¡ˆé…ç½®.csv';
            link.click();
        }

        // é‡ç½®æ•°æ®
        function resetData() {
            if (confirm('ç¡®å®šè¦é‡ç½®å½“å‰å®¢æˆ·çš„æ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                localStorage.removeItem('dms_plans_' + currentCustomerId);
                localStorage.removeItem('dms_features_' + currentCustomerId);
                localStorage.removeItem('dms_services_' + currentCustomerId);
                localStorage.removeItem('dms_contract_' + currentCustomerId);
                localStorage.removeItem('dms_form_' + currentCustomerId);
                plans = JSON.parse(JSON.stringify(getDefaultPlans()));
                features = JSON.parse(JSON.stringify(getDefaultFeatures()));
                services = JSON.parse(JSON.stringify(getDefaultServices()));
                contractBlocks = JSON.parse(JSON.stringify(getDefaultContractBlocks()));
                renderPlanTable();
                renderServiceTable();
                loadContractFormData();
            }
        }

        // è·å–é»˜è®¤åˆåŒå†…å®¹å—
        function getDefaultContractBlocks() {
            return [
                { type: 'footer-info', content: 'Deep Mind Solutions å¹¿å·å¤šæ™®ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸ info@deepmind.cn' },
                { type: 'h1', content: 'è½¯ä»¶ä½¿ç”¨è®¸å¯åŠæŠ€æœ¯å’¨è¯¢ã€æŠ€æœ¯å¼€å‘åˆåŒ' },
                { type: 'contract-header', content: 'åˆåŒç¼–å·ï¼š{{contractNo}}' },
                { type: 'party-info', content: 'ç”²æ–¹ï¼š{{partyAName}}\nåœ°å€ï¼š{{partyAAddress}}\nä¹™æ–¹ï¼š{{partyBName}}\nåœ°å€ï¼š{{partyBAddress}}' },
                { type: 'paragraph', content: 'ç”²ä¹™åŒæ–¹ç»å‹å¥½åå•†è¾¾æˆå¦‚ä¸‹åè®®ï¼Œä»¥å…±åŒéµå®ˆï¼š' },
                { type: 'article', content: '1. ç”²æ–¹å‘ä¹™æ–¹è´­ä¹°\u201cOPSæ¥å•åŠç”Ÿäº§ç®¡ç†ç³»ç»ŸåŠTflowå°å‰è‡ªåŠ¨åŒ–ç³»ç»Ÿ\u201dä½¿ç”¨æˆæƒåŠç›¸åº”çš„è½¯ä»¶å¼€å‘ã€æŠ€æœ¯å’¨è¯¢ç­‰æœåŠ¡ï¼›' },
                { type: 'article-titled', title: '2. åˆåŒæ€»åˆ™ï¼š', content: 'æœ¬åˆåŒæ¬²è¾¾æˆçš„ç›®çš„ä¸ºï¼š\n1. ç”²æ–¹é€šè¿‡ä¹™æ–¹äº¤ä»˜çš„ç³»ç»Ÿæˆ–æœåŠ¡ï¼Œå…¶å®¢æˆ·æˆ–å†…éƒ¨è½¯ä»¶èƒ½å°†æ–‡ä»¶ï¼Œé€šè¿‡è®¢å•ç³»ç»Ÿæ¥å…¥ï¼Œè¿›è¡Œï¼Œç”Ÿäº§è®¢å•ç®¡ç†ã€å‘è´§ç®¡ç†ï¼›\n2. ä¹™æ–¹è®¢å•ç®¡ç†ç³»ç»Ÿå°†ç”Ÿäº§æ–‡ä»¶å¯¹æ¥åˆ°ç”²æ–¹å°åˆ·è®¾å¤‡çš„çƒ­æ–‡ä»¶å¤¹æˆ–è€…JDFï¼ˆéœ€ç”²æ–¹è®¾å¤‡æ”¯æŒï¼‰å…¥å£ï¼›\n3. ç”²æ–¹é€šè¿‡ç”Ÿäº§ç®¡ç†ç³»ç»Ÿï¼Œèƒ½çŸ¥é“ç›®å‰è®¾å¤‡å°åˆ·åˆ°å“ªä¸ªæ–‡ä»¶ï¼Œè®¢å•çš„ç”Ÿäº§çŠ¶æ€ï¼›\n4. åœ¨åˆåŒå±¥è¡Œè¿‡ç¨‹ä¸­è‹¥é‡åˆ°åˆ†æ­§æˆ–éšœç¢ï¼Œç”²ä¹™åŒæ–¹åº”ä»¥æœ‰åˆ©äºå®ç°åˆåŒç›®çš„åŠä¿ƒè¿›äº¤æ˜“çš„åŸåˆ™å±¥è¡ŒåˆåŒã€è§£é‡ŠåˆåŒï¼›\n5. åŒæ–¹åœ¨åˆåŒç­¾è®¢å‰çš„å£å¤´çš„ï¼Œä¹¦é¢çš„è®¨è®ºï¼Œä»…ä½œåˆåŒè§£é‡Šçš„å‚è€ƒï¼Œå¦‚æœ‰å†²çªæˆ–è¶…å‡ºæ­¤åˆåŒçº¦å®šèŒƒå›´çš„ï¼Œä»¥æ­¤åˆåŒä¸ºå‡†ï¼›\n6. æœ¬åˆåŒæˆæƒçš„è½¯ä»¶ä¸ªæ•°ä¸ºé’ˆå¯¹å£¹ä¸ªOPSçš„æˆæƒåŠå£¹ä¸ªæ‹¼ç‰ˆè½¯ä»¶æˆæƒï¼Œå¦‚éœ€å¢åŠ ï¼Œå¦è¡Œæ”¯ä»˜è´¹ç”¨ï¼›\n7. æœ¬åˆåŒåªåšå°åˆ·ç›¸å…³çš„ä¸šåŠ¡ï¼Œç”Ÿäº§æµç¨‹ç­‰åŠŸèƒ½ï¼Œä¸åšè¯¸å¦‚OAè¡Œæ”¿åŠå…¬ç±»ï¼Œå‘˜å·¥æŠ¥é”€ç±»ç­‰çš„åŠŸèƒ½ã€‚\n8. åŒæ–¹åœ¨åˆåŒå±¥è¡Œçš„å„ä¸ªé˜¶æ®µï¼ˆå®‰è£…éƒ¨ç½²ï¼ŒåŸ¹è®­ï¼ŒéªŒæ”¶ï¼Œå”®åæœåŠ¡ç­‰ï¼‰ï¼Œå‡ä»¥æœ¬åˆåŒæŒ‡å®šçš„è”ç»œäººï¼ˆé¡¹ç›®ç»ç†ï¼‰çš„å¾®ä¿¡æ²Ÿé€šä¸ºå‡†ï¼Œç”²ä¹™åŒæ–¹é¡¹ç›®ç»ç†åº”è‡ªè¡Œåè°ƒå†…éƒ¨å¹¶å½¢æˆç»Ÿä¸€çš„æ„è§ï¼ŒåŒæ–¹å„è‡ªæŒ‡å®šçš„é¡¹ç›®ç»ç†çš„æ„è§ä¸ºä»£è¡¨è¯¥æ–¹çš„æœ€ç»ˆæ„è§ï¼Œè‹¥æŸæ–¹æ›´æ¢é¡¹ç›®ç»ç†ï¼Œåº”æå‰14å¤©ä»¥ä¹¦é¢å½¢å¼é€šçŸ¥å¯¹æ–¹ã€‚' },
                { type: 'pm-info-a', content: 'ç”²æ–¹é¡¹ç›®ç»ç†ï¼š\nå§“åï¼š{{partyAPM}}\nç”µè¯ï¼š{{partyAPhone}}' },
                { type: 'pm-info-b', content: 'ä¹™æ–¹é¡¹ç›®ç»ç†ï¼š\nå§“åï¼š{{partyBPM}}\nç”µè¯ï¼š{{partyBPhone}}\nå¾®ä¿¡ï¼š{{partyBWechat}}' },
                { type: 'h2', content: 'ä¸€ã€è½¯ä»¶è®¸å¯è¯è´¹ç”¨ã€ç»´æŠ¤è´¹' },
                { type: 'paragraph', content: 'æœ¬åˆåŒæ‰€æœ‰ä»·æ ¼å«ç¨è´¹ã€‚æœ¬åˆåŒæ‰€æœ‰ä»·æ ¼å«1%å¢å€¼ç¨ä¸“ç”¨å‘ç¥¨ï¼Œå¦‚é‡ä»¥åæ”¿åºœæé«˜ç¨è´¹ï¼Œåˆ™æŒ‰ä»˜æ¬¾å½“æ—¶çš„ç¨ç‡å¢åŠ ç›¸åº”çš„ç¨è´¹ã€‚' },
                { type: 'paragraph', content: 'è½¯ä»¶ç³»ç»Ÿæˆæƒä½¿ç”¨å†…å®¹åŠç›¸åº”å¼€å‘ã€æŠ€æœ¯å’¨è¯¢æœåŠ¡åœ¨ä¸‹è¡¨åˆ—æ˜ï¼š' },
                { type: 'feature-table', content: '[åŠŸèƒ½æ¸…å•è¡¨æ ¼ - è‡ªåŠ¨ç”Ÿæˆ]' },
                { type: 'paragraph-bold', content: 'OPSä¼šè®¡æ¨¡å—ï¼Œç»™ç”²æ–¹å…è´¹æ›´æ–°ï¼Œæœ‰ä»€ä¹ˆæ–°åŠŸèƒ½ï¼Œåªè¦ç”²æ–¹æ”¯ä»˜å¹´è´¹ï¼Œä¹™æ–¹éƒ½ç»™ç”²æ–¹å‡çº§ã€‚' },
                { type: 'h3', content: 'æœåŠ¡çº§åˆ«è¯´æ˜' },
                { type: 'service-table', content: '[æœåŠ¡çº§åˆ«è¡¨æ ¼ - è‡ªåŠ¨ç”Ÿæˆ]' },
                { type: 'h2', content: 'äºŒã€ä»˜æ¬¾æ–¹å¼' },
                { type: 'paragraph', content: 'æ€»ä»·ï¼šåŸä»·{{originalPrice}}ä¸‡ï¼ˆæ ‡å‡†ç‰ˆï¼‰ï¼Œç”²æ–¹ä¼˜æƒ ä»·ä¸º{{discountPrice}}ä¸‡ã€‚' },
                { type: 'paragraph', content: 'ä»˜æ¬¾æ–¹å¼ï¼š' },
                { type: 'sub-items', content: '1. åˆåŒç­¾ç½²åæ”¯ä»˜50%ã€‚\n2. åˆåŒç­¾è®¢åçš„ç¬¬ä¸€å¹´ï¼Œèµ é€ç¬¬ä¸€å¹´æœåŠ¡è´¹ã€‚\n3. ç³»ç»ŸæŠ•äº§åï¼Œæ”¯ä»˜30%ã€‚æŠ•äº§å®šä¹‰ï¼Œè§åˆåŒç¬¬ä¸‰æ¡\u201cäº¤ä»˜ã€éªŒæ”¶åŠæŠ•äº§\u201dçš„è¯´æ˜ã€‚\n4. ä½™æ¬¾20%åœ¨ç³»ç»Ÿä¸Šçº¿å3ä¸ªæœˆå†…ä»˜æ¸…ã€‚\n5. åˆåŒç­¾è®¢æ—¥çš„æ¯12ä¸ªæœˆï¼Œç”²æ–¹æ”¯ä»˜ä¸‹ä¸€å¹´åº¦çš„å¹´è´¹ã€‚\n6. ä¹™æ–¹åœ¨æ”¶åˆ°ç”²æ–¹ä»˜æ¬¾å5ä¸ªå·¥ä½œæ—¥å†…ï¼Œå¼€å…·ç›¸åº”çš„å¢å€¼ç¨ä¸“ç”¨å‘ç¥¨ã€‚' },
                { type: 'h2', content: 'ä¸‰ã€äº¤ä»˜ã€éªŒæ”¶åŠæŠ•äº§' },
                { type: 'paragraph', content: '(ä¸€) è½¯ä»¶äº¤ä»˜ï¼šè½¯ä»¶å®‰è£…åˆ°ç”²æ–¹æŒ‡å®šæœåŠ¡å™¨å¹¶æ¿€æ´»åï¼Œä¸ºè½¯ä»¶çš„äº¤ä»˜ã€‚ç”²æ–¹åº”ä¸ºè½¯ä»¶çš„å®‰è£…æä¾›ä¾¿åˆ©æ¡ä»¶ï¼Œå¦‚ç¬¦åˆç”²æ–¹ä¸šåŠ¡é‡ç›¸åº”éœ€è¦åŒ¹é…çš„èƒ½è®©ç³»ç»Ÿè¿è¡Œç•…é¡ºçš„çš„ç¡¬ä»¶ï¼Œç½‘ç»œç¯å¢ƒç­‰ï¼Œè‹¥å› ç”²æ–¹è‡ªèº«è¶…å‡ºçº¦å®šæ—¶é—´æœªèƒ½æä¾›ç¡¬ä»¶åŠç½‘ç»œé—®é¢˜å¯¼è‡´çš„æŠ•äº§è¿Ÿç¼“çš„ï¼Œä¸æ˜¯ä¹™æ–¹è´£ä»»ã€‚' },
                { type: 'paragraph', content: '(äºŒ) éªŒæ”¶æ€»åŸåˆ™åŠæŠ•äº§ï¼š' },
                { type: 'paragraph', content: '1. éªŒæ”¶æ€»åŸåˆ™ï¼š' },
                { type: 'sub-items', content: '1) ä»»ä½•å› ç”²æ–¹å†…éƒ¨äº‹åŠ¡çš„é—®é¢˜ï¼Œå¦‚äººå‘˜é…å¤‡ï¼Œäººå‘˜è°ƒå²—ï¼Œäººå‘˜è¾èŒï¼Œäººå‘˜å·¥ä½œæ—¶é—´åˆ†é…ä¸è¶³ï¼Œç”²æ–¹å†…éƒ¨å®¡æ‰¹æµç¨‹ï¼Œç”²æ–¹éƒ¨é—¨ä¹‹é—´çš„åä½œç­‰å†…éƒ¨äº‹åŠ¡å¯¼è‡´è½¯ä»¶æŠ•äº§è¿Ÿç¼“çš„ï¼Œå‡ä¸å±äºç”²æ–¹ä¸æ”¯ä»˜ä¹™æ–¹è´¹ç”¨çš„ç†ç”±ï¼›\n2) ç”²æ–¹æå‡ºçš„éœ€æ±‚ä¸å±äºåˆåŒæ‰€è¦†ç›–çš„åŠŸèƒ½çš„ï¼Œä¸èƒ½ä½œä¸ºç”²æ–¹ä¸æ”¯ä»˜ä¹™æ–¹è´¹ç”¨çš„ç†ç”±ï¼›\n3) å¦‚å› ç¬¬ä¸‰æ–¹æˆ–ç¬¬ä¸‰æ–¹è½¯ä»¶ç³»ç»Ÿå¯¼è‡´çš„åŠŸèƒ½éšœç¢ï¼Œç”²ä¹™åŒæ–¹åº”å°½é‡åå•†ï¼Œäº’ç›¸ååŠ©ï¼Œç»•å¼€ç¬¬ä¸‰æ–¹è½¯ä»¶çš„é™åˆ¶ï¼Œä»¥è®©é¡¹ç›®èƒ½æ­£å¸¸å¾€å‰æ¨è¿›ã€‚\n4) ä¹™æ–¹äº¤ä»˜åï¼Œç”²æ–¹åº”å¯¹è½¯ä»¶ç«‹å³åœ°ï¼Œç§¯æåœ°ï¼Œè‡ªå‘åœ°å±•å¼€æŠ•äº§å·¥ä½œï¼Œç”²æ–¹åº”è¯¥è‡ªè¡Œé…å¤‡è¶³å¤Ÿçš„äººå‘˜è´Ÿè´£æŠ•äº§å·¥ä½œã€‚è‹¥è½¯ä»¶åŠŸèƒ½ä¸ç”²æ–¹å®é™…ä¸šåŠ¡æµç¨‹æœ‰å·®å¼‚çš„ï¼ŒåŒæ–¹åº”å……åˆ†åœ°å–„æ„åœ°æ²Ÿé€šï¼Œè‹¥é€šè¿‡ç”²æ–¹è°ƒæ•´å·¥ä½œæµç¨‹åèƒ½æœ‰åˆ©äºæ¨è¿›é¡¹ç›®æŠ•äº§å¹¶è¾¾æœ‰åˆ©äºå®ç°åˆåŒç›®çš„çš„ï¼Œç”²æ–¹åº”å–„æ„åœ°ç§¯æåœ°äºˆä»¥é…åˆï¼ŒåŒ…æ‹¬ä½†ä¸é™äºæ”¹å˜å·²æœ‰å†…éƒ¨æµç¨‹ï¼Œå¢è´­æ¨¡å—ï¼ˆå¦‚æœ‰ï¼‰/æœåŠ¡ï¼Œå¢è´­å…¶ä½™ç¬¬ä¸‰æ–¹è½¯ä»¶ç³»ç»Ÿç­‰ã€‚\n5) è‹¥æœ‰é—®é¢˜ï¼Œä¹™æ–¹åº”ä»¥ä¹¦é¢å½¢å¼ï¼Œåˆ—å‡ºé—®é¢˜æ¸…å•ç»™ç”²æ–¹ã€‚\n6) ç”²æ–¹åº”åœ¨è½¯ä»¶äº¤ä»˜å15ä¸ªå·¥ä½œæ—¥å†…å®ŒæˆéªŒæ”¶ï¼Œå¹¶ä»¥ä¹¦é¢å½¢å¼å‘ä¹™æ–¹æäº¤éªŒæ”¶æŠ¥å‘Šæˆ–å¼‚è®®æ¸…å•ã€‚\n7) è‹¥ç”²æ–¹åœ¨è½¯ä»¶äº¤ä»˜å15ä¸ªå·¥ä½œæ—¥å†…æœªä»¥ä¹¦é¢å½¢å¼å‘ä¹™æ–¹æå‡ºå¼‚è®®çš„ï¼Œè§†ä¸ºéªŒæ”¶é€šè¿‡ã€‚' },
                { type: 'paragraph', content: '2. \u201cæŠ•äº§\u201dï¼š' },
                { type: 'paragraph', content: 'ç”²æ–¹çš„è®¢å•é€šè¿‡è½¯ä»¶çš„å„åŠŸèƒ½æ¨¡å—ï¼Œæ­£å¸¸æµè½¬ï¼Œç”²æ–¹é€šè¿‡ä¹™æ–¹ç³»ç»Ÿèƒ½å°†æˆå“äº¤ä»˜ç»™é¡¾å®¢çš„ï¼Œä¸ºæŠ•äº§æˆåŠŸã€‚å› ä¸å±äºä¹™æ–¹ç³»ç»Ÿå¯¼è‡´çš„ç”Ÿäº§éšœç¢ï¼Œè¯¸å¦‚æ–‡ä»¶æœ¬èº«çš„é—®é¢˜ã€æ‰“å°è®¾å¤‡è´¨é‡å¯¼è‡´é¡¾å®¢ä¸æ”¶è´§ã€ç½‘ç»œä¼ è¾“åŸå› å¯¼è‡´æ–‡ä»¶ä¼ è¾“å¤±è´¥ï¼Œæˆ–å…¶ä»–ç¬¬ä¸‰æ–¹è½¯ä»¶ã€ç³»ç»Ÿã€è®¾å¤‡å¯¼è‡´çš„æŠ•äº§é˜»ç¢ï¼Œä¸å±äºä¹™æ–¹è´£ä»»ã€‚' },
                { type: 'h2', content: 'å››ã€åŒæ–¹æƒåˆ©åŠä¹‰åŠ¡' },
                { type: 'paragraph', content: '(æŒ‰ä»¥ä¸‹æ’åˆ—çš„å…ˆåé¡ºåºç¡®å®šåŒæ–¹æƒåˆ©ä¹‰åŠ¡çš„å±¥è¡Œé¡ºåº)' },
                { type: 'sub-items', content: '1. ç”²æ–¹æ”¯ä»˜æ¬¾é¡¹ï¼›\n2. ä¹™æ–¹åœ¨æ”¶åˆ°ä»˜æ¬¾åï¼Œä½œå‡ºå‘ç”²æ–¹æŒ‡å®šæœåŠ¡å™¨å®‰è£…çš„å‡†å¤‡å·¥ä½œï¼›\n3. ç”²æ–¹æä¾›ç¬¦åˆç³»ç»Ÿè¦æ±‚çš„æœåŠ¡å™¨åŠç½‘ç»œç¯å¢ƒä¾›ä¹™æ–¹å®‰è£…è½¯ä»¶ï¼Œç”²æ–¹è´Ÿè´£è´­ä¹°æ‰€éœ€çš„ç¬¬ä¸‰æ–¹è½¯ç¡¬ä»¶ï¼Œå¦‚windowsæ“ä½œç³»ç»Ÿã€æ¡ç æªç­‰ï¼›\n4. ä¹™æ–¹å®‰è£…æ¥å•ç³»ç»Ÿåˆ°ç”²æ–¹æŒ‡å®šçš„æœåŠ¡å™¨å¹¶æ¿€æ´»è½¯ä»¶ï¼›\n5. ä¹™æ–¹æµ‹è¯•æ‹¼ç‰ˆç³»ç»Ÿï¼Œæ˜¯å¦ç¬¦åˆç”²æ–¹è¦æ±‚ã€‚\n6. ç”²æ–¹åº”å®‰æ’é¡¹ç›®äººå‘˜ä¸ä¹™æ–¹å¯¹æ¥ï¼Œå¦‚æµ‹è¯•æ–‡ä»¶å‡†å¤‡ï¼Œéœ€æ±‚æ–‡æ¡£å‡†å¤‡ç­‰ï¼›\n7. ä¹™æ–¹å®‰æ’äººå‘˜å¯¹ç”²æ–¹è¿›è¡Œé¡¹ç›®å¯¹æ¥ï¼Œè·å–é¡¹ç›®å…·ä½“çš„æµ‹è¯•æ–‡ä»¶ï¼ŒæœŸæœ›æ•ˆæœï¼›\n8. ç³»ç»Ÿäº¤ä»˜å®‰è£…åï¼Œç”²æ–¹åº”ç§¯æå¼€å±•æŠ•äº§å·¥ä½œã€‚æŒ‰åˆåŒçš„ä»˜æ¬¾æ¡ä»¶ä»˜æ¬¾ï¼›\n9. ä¹™æ–¹åœ¨ç”²æ–¹ä½¿ç”¨è½¯ä»¶çš„è¿‡ç¨‹ä¸­æŒ‰æœåŠ¡çº§åˆ«è¿œç¨‹åœ°æä¾›æŠ€æœ¯æ”¯æŒåŠè§£ç­”é—®é¢˜ï¼›\n10. ç”²æ–¹åº”ç§¯æä½¿ç”¨ç³»ç»Ÿï¼Œåœ¨æ¯æ¬¡æ·»åŠ æ–°äº§å“æˆ–ä¹™æ–¹è°ƒæ•´äº†ç³»ç»Ÿåï¼Œæ­£å¼ç”Ÿäº§å‰ï¼Œæœ‰ä¹‰åŠ¡å¯¹ç”Ÿäº§æ–‡ä»¶è¿›è¡Œå……åˆ†çš„æµ‹è¯•ï¼Œç„¶åä½¿ç³»ç»Ÿåº”ç”¨äºå®é™…ä¸šåŠ¡ï¼›\n11. ä¹™æ–¹æŒ‰æœ¬åˆåŒçš„ç»´æŠ¤æ¡æ¬¾è¿›è¡Œç»´æŠ¤ï¼›' },
                { type: 'h2', content: 'äº”ã€è®¡ç®—æœºè½¯ä»¶è‘—ä½œæƒåŠç›¸å…³çš„çŸ¥è¯†äº§æƒå½’å±' },
                { type: 'sub-items', content: '(ä¸€) æœ¬åˆåŒçš„è®¸å¯æ–¹å¼ä¸º\u201cä¸€èˆ¬è®¸å¯\u201dï¼Œç”±ä¹™æ–¹æˆæƒç”²æ–¹ä½¿ç”¨è½¯ä»¶ã€‚\n(äºŒ) ç”²æ–¹åŒæ„æ¥å—ä¸€ä¸ªä¸å¯è½¬è®©çš„éç‹¬å çš„ä½¿ç”¨è®¸å¯ï¼Œåªå‡†è®¸ç”²æ–¹äººå‘˜åœ¨æŒ‡å®šæœåŠ¡å™¨ä¸Šä½¿ç”¨è¯¥è®¸å¯è½¯ä»¶ï¼Œä¸Šè¿°ä½¿ç”¨ä»…é™äºç”²æ–¹ä½¿ç”¨ï¼Œè‹¥ç”²æ–¹åˆ†ç§Ÿç»™å…¶ä»–éç”²æ–¹äººå‘˜ä½¿ç”¨ï¼Œåˆ™å±è¿çº¦ï¼Œä¹™æ–¹æœ‰æƒé‡‡å–åŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹çš„é™åˆ¶æªæ–½ï¼Œ1.é™åˆ¶ç”²æ–¹æ–‡ä»¶ç³»ç»Ÿå¤„ç†æ•°é‡ï¼›2.é™åˆ¶ç”²æ–¹ç™»å½•ç³»ç»Ÿçš„äººå‘˜æ•°é‡ï¼›3.åœæ­¢ç”²æ–¹ä½¿ç”¨ç³»ç»Ÿã€‚\n(ä¸‰) æºä»£ç åŠè½¯ä»¶ç³»ç»Ÿé…ç½®ã€ç»„æˆç­‰è¯€çªï¼ˆåŒ…æ‹¬ä½†ä¸é™äºç”²æ–¹é‡‡è´­ã€ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹æŠ€æœ¯ã€ç”Ÿäº§å‚æ•°çš„è®¾å®šæŠ€å·§ï¼Œç”Ÿäº§åˆå•æ–¹å¼çš„æ’åˆ—ç»„åˆç­‰ï¼‰å±äºä¹™æ–¹çŸ¥è¯†äº§æƒåŠå•†ä¸šç§˜å¯†ï¼Œä¹™æ–¹æœ‰æƒä¸å‘ç”²æ–¹äº¤ä»˜åŠé€éœ²ã€‚\n(å››) ä¹™æ–¹åº”ä¿è¯å…¶åˆåŒèŒƒå›´å†…æ‰€å‡ºå”®çš„è½¯ä»¶æ— çŸ¥è¯†äº§æƒçº çº·ï¼Œè‹¥é‡ç¬¬ä¸‰æ–¹ç´¢å¿ï¼Œåº”ç”±ä¹™æ–¹æ‰¿æ‹…å› æ­¤äº§ç”Ÿçš„è´¹ç”¨ï¼Œä¸ç”²æ–¹æ— å…³ã€‚' },
                { type: 'h2', content: 'å…­ã€ä¿å¯†çº¦å®š' },
                { type: 'sub-items', content: '(ä¸€) ç”²æ–¹é€šè¿‡æœ¬è½¯ä»¶æ‰€è·å¾—çš„ä¸è½¯ä»¶æ— å…³çš„ä»»ä½•æ•°æ®å‡å½’ç”²æ–¹æ‰€æœ‰ï¼Œç”²ä¹™åŒæ–¹å¯¹åœ¨åˆä½œä¸­äº’ç›¸çŸ¥æ™“çš„å¯¹æ–¹çš„å•†ä¸šç§˜å¯†åŠæ•°æ®æœ‰ä¿å¯†çš„è´£ä»»ï¼Œæœªç»å¯¹æ–¹å…è®¸ä¸å¾—æ³„éœ²æˆ–ç”¨äºå…¶å®ƒç”¨é€”ã€‚\n(äºŒ) æœ¬åˆåŒé¡¹ä¸‹çš„ä»·æ ¼åŠåˆä½œæ–¹å¼äº¦å±ä¿å¯†äº‹é¡¹ï¼ŒåŒæ–¹å‡ä¸å¾—ä»¥ä»»ä½•æ–¹å¼å’Œç†ç”±é€éœ²ç»™ç¬¬ä¸‰æ–¹ï¼Œå¦åˆ™å®ˆçº¦æ–¹å°†ä¿ç•™ç»´æŠ¤æ­£å½“æƒç›Šçš„æƒåˆ©ã€‚\n(ä¸‰) ä¹™æ–¹æ‰€ä½¿ç”¨ã€é‡‡è´­çš„ç¬¬ä¸‰æ–¹æŠ€æœ¯å±äºä¹™æ–¹å•†ä¸šç§˜å¯†ï¼Œè‹¥ç”²æ–¹åœ¨åˆä½œè¿‡ç¨‹ä¸­çŸ¥æ‚‰ï¼Œåº”äºˆä»¥ä¿å¯†ã€‚' },
                { type: 'h2', content: 'ä¸ƒã€ä¸å¯æŠ—åŠ›' },
                { type: 'paragraph', content: 'ç”²ä¹™åŒæ–¹çš„ä»»ä½•ä¸€æ–¹ç”±äºä¸å¯æŠ—åŠ›çš„åŸå› ä¸èƒ½å±¥è¡ŒåˆåŒæ—¶ï¼Œåº”åŠæ—¶å‘å¯¹æ–¹é€šæŠ¥ä¸èƒ½å±¥è¡Œæˆ–ä¸èƒ½å®Œå…¨å±¥è¡Œçš„ç†ç”±ï¼Œåœ¨å–å¾—æœ‰å…³è¯æ˜ä»¥åï¼Œå…è®¸å»¶æœŸå±¥è¡Œã€éƒ¨åˆ†å±¥è¡Œæˆ–è€…ä¸å±¥è¡ŒåˆåŒï¼Œå¹¶æ ¹æ®æƒ…å†µå¯éƒ¨åˆ†æˆ–å…¨éƒ¨å…äºˆæ‰¿æ‹…è¿çº¦è´£ä»»ã€‚' },
                { type: 'paragraph', content: 'ç”²æ–¹åŒæ„é‰´äºäº’è”ç½‘çš„ç‰¹æ®Šæ€§ï¼Œä»–äººè“„æ„ç ´åï¼Œé»‘å®¢æ”»å‡»ï¼Œè®¡ç®—æœºç—…æ¯’å…¥ä¾µæˆ–å‘ä½œï¼Œç”µä¿¡éƒ¨é—¨æŠ€æœ¯ï¼Œæ”¿ç­–ï¼Œæ”¿åºœç®¡åˆ¶æˆ–è€…ç³»ç»Ÿæ•…éšœç­‰å±äºä¸å¯æŠ—åŠ›çš„ï¼Œç”±æ­¤ç»™ç”²æ–¹æˆ–è€…ç¬¬ä¸‰æ–¹é€ æˆçš„æŸå¤±ä¸åº”ç”±ä¹™æ–¹æ‰¿æ‹…ã€‚' },
                { type: 'h2', content: 'å…«ã€è¿çº¦è´£ä»»' },
                { type: 'sub-items', content: '(ä¸€) ç”²ä¹™åŒæ–¹æœ¬ç€çœŸè¯šåˆä½œã€ç›¸äº’ä¿¡èµ–çš„åŸåˆ™ï¼Œæ ¹æ®å›½å®¶ç›¸å…³çš„æ³•å¾‹ã€æ³•è§„ï¼Œåå•†è§£å†³åœ¨æœ¬åˆåŒæ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„è¿çº¦çº çº·å’Œè¿çº¦è´£ä»»ã€‚\n(äºŒ) è‹¥ç”²æ–¹æœªæŒ‰æœ¬åˆåŒæ‰€çº¦å®šçš„æœŸé™ç¼´ä»˜è½¯ä»¶è®¸å¯è¯è´¹ç”¨ï¼Œç»´æŠ¤è´¹çš„ï¼Œå®šåˆ¶è´¹ç”¨çš„ï¼Œæˆ–æœ‰æŸå®³ä¹™æ–¹åˆ©ç›Šçš„è¡Œä¸ºï¼Œä¹™æ–¹æœ‰æƒåœæ­¢ç”²æ–¹çš„è½¯ä»¶ä½¿ç”¨æƒï¼Œå¹¶åœæ­¢æœåŠ¡ã€‚\n(ä¸‰) è‹¥ä¹™æ–¹æœªæŒ‰æœ¬åˆåŒæ‰€çº¦å®šäº¤ä»˜è½¯ä»¶ã€æä¾›æœåŠ¡çš„ï¼Œç”²æ–¹æœ‰æƒåœæ­¢æ”¯ä»˜ç›¸åº”çš„æ¬¾é¡¹ã€‚\n(å››) è‹¥ç”²æ–¹é€éœ²åˆåŒæ‰€çº¦å®šçš„ä¼˜æƒ ä»·ç»™ç¬¬ä¸‰æ–¹ï¼Œå±é‡å¤§è¿çº¦ï¼Œé¡»è¡¥å›ä¸æ ‡å‡†æŠ¥ä»·çš„å·®ä»·ç»™ä¹™æ–¹ã€‚' },
                { type: 'h2', content: 'ä¹ã€äº‰è®®è§£å†³æ–¹å¼' },
                { type: 'paragraph', content: 'åŒæ–¹åˆåŒå±¥è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿäº‰è®®ï¼ŒåŒæ–¹åº”åå•†è§£å†³ã€‚å¦‚æœä¸èƒ½åå•†è§£å†³äº‰è®®ï¼Œä»»ä½•ä¸€æ–¹å‡å¯å°†æ­¤äº‰è®®å‘åŒæ–¹æ‰€åœ¨åœ°äººæ°‘æ³•é™¢èµ·è¯‰ã€‚' },
                { type: 'h2', content: 'åã€å…¶ä»–' },
                { type: 'sub-items', content: '(ä¸€) æœ¬åˆåŒè‡ªåŒæ–¹ç­¾ç½²ä¹‹æ—¥èµ·æˆç«‹å¹¶ç”Ÿæ•ˆï¼Œé™¤éç”²ä¹™åŒæ–¹è¾¾æˆåˆæ„ç»ˆæ­¢ï¼ŒåˆåŒè‡ªåŠ¨å»¶ç»­ã€‚\n(äºŒ) æœ¬åˆåŒä¸ºåŒæ–¹çš„æœ€ç»ˆåˆåŒï¼Œæœªç»åŒæ–¹ä¹¦é¢åŒæ„ï¼Œä¸å¾—å¯¹æ­¤ä½œä»»ä½•ä¿®æ”¹ã€‚å¦‚æœ‰æœªå°½äº‹å®œï¼Œå¯ç­¾è®¢ä¹¦é¢è¡¥å……åè®®ã€‚è¡¥å……åè®®ä¸æœ¬åè®®å…·æœ‰åŒç­‰æ³•å¾‹æ•ˆåŠ›ã€‚\n(ä¸‰) ç”²ä¹™åŒæ–¹å‡ç¡®è®¤æœ¬åˆåŒå†…ï¼ˆåˆåŒå¤´éƒ¨æˆ–åˆåŒå†…æŒ‡å®šçš„é¡¹ç›®ç»ç†è”ç»œæ–¹å¼ï¼‰æ‰€è½½åœ°å€ã€å¾®ä¿¡ã€ç”µå­é‚®ä»¶ã€ç”µè¯ä¸ºå…¶æœ‰æ•ˆçš„è”ç³»æ–¹å¼ï¼Œè‹¥ä»»ä½•ä¸€æ–¹è”ç³»æ–¹å¼å‘ç”Ÿå˜æ›´çš„ï¼Œéœ€äºå˜æ›´å‰æå‰14æ—¥ä¹¦é¢å‘ŠçŸ¥å¯¹æ–¹ï¼Œå¦åˆ™å¯¹å‘ç”Ÿå˜æ›´å‰åœ°å€ï¼ˆåŒ…æ‹¬ç”µå­é‚®ä»¶ï¼Œå¾®ä¿¡ï¼Œç”µè¯çŸ­ä¿¡ç­‰ï¼‰å‘é€çš„æ–‡ä»¶å‡è§†ä¸ºé€è¾¾ã€‚\n(å››) å¦‚ä¹™æ–¹å› ç»è¥å˜åŠ¨æˆ–äººå‘˜å˜åŠ¨ç­‰ä¸å†å…·å¤‡æä¾›ç»´æŠ¤æœåŠ¡æ—¶ï¼Œè‹¥åœ¨æœåŠ¡æœŸå†…ï¼Œåº”ä¿éšœæœåŠ¡åˆ°æœåŠ¡æœŸç»“æŸåæ–¹èƒ½ç»ˆæ­¢æœåŠ¡ï¼Œå¹¶åè°ƒç”²æ–¹ä¸å‚å®¶è¿›è¡ŒæœåŠ¡å¯¹æ¥äº‹å®œã€‚' },
                { type: 'h2', content: 'åä¸€ã€æœ¬åˆåŒä¸€å¼ä¸¤ä»½ï¼ŒåˆåŒåŒæ–¹å„æŒä¸€ä»½ï¼Œå‡å…·æœ‰åŒç­‰æ³•å¾‹æ•ˆåŠ›ã€‚' },
                { type: 'signature', content: '' },
                { type: 'appendix-a-title', content: 'åˆåŒé™„ä»¶A æœåŠ¡åè®®ï¼ˆService Level Agreementï¼‰æœåŠ¡èŒƒå›´åŠå“åº”æ—¶é—´' },
                { type: 'sub-items', content: '1. ä¹™æ–¹çš„æœåŠ¡èŒƒå›´ä»…é™äºä¹™æ–¹æ‰€å”®ä¹‹è½¯ä»¶çš„å„åŠŸèƒ½æ¨¡å—ï¼Œå¦‚ä¸åŒ…æ‹¬ç”²æ–¹è‡ªèº«è½¯ä»¶çš„APIç¼–ç¨‹ï¼Œç¬¬ä¸‰æ–¹è½¯ä»¶çš„æ”¯æŒã€ç½‘ç»œã€ç¡¬ä»¶ã€ç—…æ¯’ã€ç½‘ç»œå®‰å…¨ã€ç³»ç»Ÿå®‰å…¨ç­‰éä¹™æ–¹è½¯ä»¶å¼•èµ·çš„é—®é¢˜ã€‚å¯¹äºéä¹™æ–¹è½¯ä»¶å¼•èµ·çš„é—®é¢˜ã€‚ä¹™æ–¹å¯æä¾›ç›¸åº”çš„æŠ€æœ¯å»ºè®®ï¼Œä½†ä¸æ‰¿æ‹…è´£ä»»ã€‚\n2. ä¹™æ–¹åœ¨å·¥ä½œæ—¶é—´å†…ä¸ºç”²æ–¹æŒ‰ç…§æœåŠ¡åè®®çº¦å®šçš„æ–¹å¼æä¾›è½¯ä»¶æ‰€éœ€çš„å”®åæœåŠ¡ï¼Œå“åº”æ—¶é—´è¯·å‚è€ƒæœåŠ¡ç­‰çº§åŠå“åº”æ—¶é—´éƒ¨åˆ†ã€‚\n3. ä¹™æ–¹å¯¹è½¯ä»¶æä¾›æœ‰å¿çš„ç»ˆèº«æŠ€æœ¯æ”¯æŒã€‚å¯¹äºä¸åœ¨åˆåŒè§„å®šèŒƒå›´å†…çš„æœåŠ¡è¯·æ±‚ï¼Œç”²ä¹™åŒæ–¹åº”é‡æ–°åå•†è´¹ç”¨ã€‚\n4. å› ä¸ºPDFæµç¨‹ä¸å¯é¿å…å­˜åœ¨ä¸å¯é¢„çŸ¥çš„ç¼ºé™·ï¼Œä¹™æ–¹ä¸å¯¹æœ€åç”Ÿæˆçš„PDFæ–‡ä»¶ä½œæ— ç¼ºé™·æ‹…ä¿ï¼Œç”²æ–¹åº”å¯¹æ–°äº¤ä»˜çš„åŠŸèƒ½å¤„ç†çš„æ–‡ä»¶åœ¨ç”Ÿäº§å‰è¿›è¡Œå……åˆ†çš„æµ‹è¯•ï¼Œåº”å¯¹é‡‘é¢å¤§çš„æ–‡ä»¶è¿›è¡Œå¿…è¦çš„å°å‰æ£€æŸ¥ç­‰ï¼Œå› ç”Ÿäº§æ–‡ä»¶é€ æˆçš„ä»»ä½•ç›´æ¥æˆ–é—´æ¥æŸå¤±ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºæ•°æ®ä¸¢å¤±ã€åˆ©æ¶¦æŸå¤±ã€ä¸§å¤±å•†ä¸šæœºä¼šç­‰å‡ä¸æ‰¿æ‹…èµ”å¿è´£ä»»ã€‚ç”²æ–¹æœ‰è´£ä»»å¯¹ä¹™æ–¹è½¯ä»¶æ‰€äº§ç”Ÿçš„ç›¸å…³æ•°æ®è¿›è¡Œå¤‡ä»½ï¼Œå¹¶ç»´æŠ¤ç³»ç»Ÿçš„å®‰å…¨è¿è¡Œã€‚\n5. å¯¹äºAIæ–‡ä»¶ï¼ŒCDRæ–‡ä»¶ï¼Œï¼ˆå¦‚æ ‡ç­¾ï¼Œä¸å¹²èƒ¶ç­‰ï¼‰ï¼Œé€šå¸¸å®¢æˆ·ä¼šå°†ä¸åŒæ¬¾æ•°çš„æ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªç”»ç‰ˆä¸Šï¼Œå¦‚æœéœ€è¦è‡ªåŠ¨åŒ–å¤„ç†ï¼Œéœ€è¦å°†æ¯ä¸ªæ¬¾å¼å•ç‹¬æ”¾ç½®åœ¨ä¸€ä¸ªç”»ç‰ˆä¸Šï¼Œå¼‚å‹ã€åœ†å½¢çš„æ–‡ä»¶ï¼Œè¿˜éœ€è¦å¸¦ä¸Šä¸“è‰²åˆ€çº¿ã€‚' },
                { type: 'h3', content: 'æœåŠ¡ç­‰çº§åŠå“åº”æ—¶é—´' },
                { type: 'paragraph', content: 'ä¹™æ–¹å¹³æ—¶ä¼šå°†é‡åˆ°çš„å¸¸è§é—®é¢˜ï¼Œå†™æˆæ–‡æ¡£ï¼Œç»™äºˆç”²æ–¹è‡ªèº«çš„è¿ç»´äººå‘˜æŸ¥çœ‹ï¼Œä»¥ä¾¿å…¶è‡ªè¡Œå¤„ç†åœ¨ä»¥ä¸‹åˆ—åˆ—ä¸¾çš„å·¥ä½œæ—¶é—´ä»¥å¤–çš„éå·¥ä½œæ—¶é—´æ®µé‡åˆ°çš„é—®é¢˜ã€‚å¦‚éå·¥ä½œæ—¶é—´çš„æ™šä¸Šåç‚¹å‰ç³»ç»Ÿå‘ç”Ÿ1ã€2çº§æ•…éšœçš„ï¼Œç”²æ–¹åˆå®åœ¨æ— æ³•è‡ªè¡Œå¤„ç†çš„ï¼Œå¯è‡´ç”µä¹™æ–¹ï¼Œä¹™æ–¹å°½å¯èƒ½åœ°ç»™äºˆç”²æ–¹æœ€å¤§é™åº¦çš„å¸®åŠ©ã€‚' },
                { type: 'sla-level', title: 'ç¬¬1çº§ - ç³»ç»Ÿå¥”æºƒæˆ–ä¸èƒ½è®¿é—®', content: 'æ­¤ç­‰çº§ä¸ºå‡ºç°ä»¥ä¸‹æƒ…å†µï¼š\nâ€¢ æœåŠ¡å®Œå…¨å¯åŠ¨ä¸äº†æˆ–è®¿é—®ä¸äº†ç³»ç»Ÿ\nâ€¢ é¡¾å®¢æ— æ³•è®¿é—®ç³»ç»Ÿ\nâ€¢ ç³»ç»Ÿå†»ç»“æˆ–è€…æ²¡æœ‰ååº”\nå¤„ç†æ–¹å¼ï¼šæ­¤ç§æƒ…å†µå¯ä»¥ç›´æ¥ç”µè¯è”ç³»ä¹™æ–¹å·¥ç¨‹å¸ˆï¼Œä¹™æ–¹å·¥ç¨‹å¸ˆä»¥ç”µè¯åŠè¿œç¨‹ç™»å½•ååŠ©ç”²æ–¹æ’æŸ¥åŠæ’é™¤é—®é¢˜ã€‚\nç”µè¯æ²Ÿé€šæ—¶é—´ï¼šå·¥ä½œæ—¥ æ˜ŸæœŸä¸€è‡³äº” 9am â€“ 6pmï¼ŒåŒ—äº¬æ—¶é—´\nå·¥ä½œæ—¶é—´å†…60åˆ†é’Ÿå“åº”' },
                { type: 'sla-level', title: 'ç¬¬2çº§ - ä¸¥é‡å½±å“ä¸šåŠ¡', content: 'æ­¤ç­‰çº§ä¸ºå‡ºç°ä»¥ä¸‹æƒ…å†µï¼š\nâ€¢ è½¯ä»¶åŠŸèƒ½å‡é€€\nâ€¢ æŸåŠŸèƒ½ä¸èƒ½æ­£å¸¸ä½¿ç”¨\nâ€¢ äº¤è´§æœŸæˆ–äº§å“è´¨é‡å› ç³»ç»Ÿé—®é¢˜å—åˆ°å½±å“\nâ€¢ æ’ç‰ˆä¸æ­£ç¡®\nå¤„ç†æ–¹å¼ï¼šç”²æ–¹é¡»é€šè¿‡ç½‘ä¸Šå”®åç³»ç»Ÿæ±‡æŠ¥é—®é¢˜ï¼Œä¹™æ–¹å®‰æ’å·¥ç¨‹å¸ˆåœ¨æ”¶åˆ°å”®åè¯·æ±‚åè·Ÿè¿›ï¼Œä¹™æ–¹å¯é€šè¿‡ç½‘ä¸Šå”®åç³»ç»Ÿä¸ç”²æ–¹æ²Ÿé€šã€‚\nå¤„ç†æ—¶é—´ï¼šå·¥ä½œæ—¥ æ˜ŸæœŸä¸€è‡³äº” 9am â€“ 6pmï¼ŒåŒ—äº¬æ—¶é—´\n3å°æ—¶å“åº”æ—¶é—´' },
                { type: 'sla-level', title: 'ç¬¬3çº§ - æ—¥å¸¸å”®åå·¥ä½œä»¥åŠå¯¹ä¸šåŠ¡å¾®å°å½±å“', content: 'æ­¤ç­‰çº§ä¸ºå‡ºç°ä»¥ä¸‹æƒ…å†µï¼š\nâ€¢ ä¸šåŠ¡å—åˆ°è½»å¾®çš„å½±å“\nâ€¢ å› ä¸ºç³»ç»Ÿçš„åŸå› å¯¼è‡´ä½¿ç”¨ä¸æ–¹ä¾¿\nâ€¢ æ­å»ºæµç¨‹å¼€å‘é—®é¢˜\nâ€¢ æ“ä½œé—®é¢˜\nâ€¢ é¢å¤–çš„åŸ¹è®­è¯·æ±‚\nç”²æ–¹é¡»é€šè¿‡ç½‘ä¸Šå”®åç³»ç»Ÿæ±‡æŠ¥é—®é¢˜ï¼Œä¹™æ–¹å¯ä¸éœ€è¦ç«‹å³å›ç­”ã€‚\nå¤„ç†æ—¶é—´ï¼šå·¥ä½œæ—¶é—´ æ˜ŸæœŸä¸€è‡³äº” 9am â€“ 6pmï¼ŒåŒ—äº¬æ—¶é—´\n8å°æ—¶å“åº”æ—¶é—´' },
                { type: 'appendix-b-title', content: 'åˆåŒé™„ä»¶B' },
                { type: 'paragraph', content: 'æœ¬åˆåŒä¸åŒ…æ‹¬ä»¥ä¸‹è½¯ä»¶æˆ–è™½æœªåˆ—ä¸¾ä½†ç±»ä¼¼çš„å…¶ä»–è½¯ä»¶ï¼Œç”²æ–¹å¯ä»¥è‡ªè¡Œè´­ä¹°æˆ–å’¨è¯¢ä¹™æ–¹' },
                { type: 'appendix-b-table', content: 'Windowsæ“ä½œç³»ç»ŸåŠæœåŠ¡å™¨|æ‰¿è½½ä¹™æ–¹æ‰€æä¾›çš„è§£å†³æ–¹æ¡ˆï¼Œé¡»æŒ‰ä¹™æ–¹è¦æ±‚é…ç½®ã€‚|è‡ªè¡Œè´­ä¹°\nOfficeç³»åˆ—è½¯ä»¶|è½¬æ¡£Officeæ ¼å¼æ—¶å€™ç”¨åˆ°|è‡ªè¡Œè´­ä¹°\nAdobeç³»åˆ—è½¯ä»¶|è½¬æ¡£PDFæ ¼å¼æ—¶å€™ç”¨åˆ°|è‡ªè¡Œè´­ä¹°\nå°å‰é¢„æ£€|Pitstop, PDF toolBox|è‡ªè¡Œè´­ä¹°\nå¸¦å®½|n/a|è‡ªè¡Œè´­ä¹°' },
                { type: 'footer-info', content: 'Deep Mind Solutions å¹¿å·å¤šæ™®ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸ info@deepmind.cn' }
            ];
        }

        // æ‰“å°åˆåŒ
        function printContract() {
            // ä¸´æ—¶é€€å‡ºç¼–è¾‘æ¨¡å¼åæ‰“å°
            const wasEditing = contractEditMode;
            if (wasEditing) {
                document.getElementById('contract-content').classList.remove('editing');
            }
            window.print();
            if (wasEditing) {
                document.getElementById('contract-content').classList.add('editing');
            }
        }

        // ä¸‹è½½åˆåŒ
        function downloadContract() {
            // è·å–å†…å®¹å¹¶æ¸…é™¤ç¼–è¾‘æ¨¡å¼çš„æ ‡è®°
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = document.getElementById('contract-content').innerHTML;
            // ç§»é™¤æ‰€æœ‰ block-actions æŒ‰é’®
            tempDiv.querySelectorAll('.block-actions').forEach(el => el.remove());
            // ç§»é™¤ editable-block åŒ…è£¹ï¼Œä¿ç•™å†…å®¹
            tempDiv.querySelectorAll('.editable-block').forEach(el => {
                el.removeAttribute('onclick');
                el.removeAttribute('class');
                el.removeAttribute('data-block-idx');
            });
            const content = tempDiv.innerHTML;
            const html = `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>è½¯ä»¶ä½¿ç”¨è®¸å¯åŠæŠ€æœ¯å’¨è¯¢ã€æŠ€æœ¯å¼€å‘åˆåŒ</title>
    <style>
        body { font-family: 'Microsoft YaHei', sans-serif; padding: 50px; font-size: 14px; line-height: 1.8; }
        h1 { text-align: center; font-size: 22px; }
        h2 { font-size: 16px; margin: 20px 0 10px; color: #2c3e7b; }
        h3 { font-size: 14px; margin: 15px 0 10px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 12px; }
        th, td { padding: 8px; border: 1px solid #ddd; }
        th { background: #2c3e7b; color: white; }
        .sub-item { margin-left: 20px; }
        .signature { display: flex; justify-content: space-between; margin-top: 50px; }
        .signature-block { width: 45%; }
        .signature-line { border-bottom: 1px solid #333; margin: 10px 0; height: 30px; }
        .footer-info { text-align: center; margin: 30px 0; color: #666; font-size: 12px; }
        .appendix { margin-top: 40px; padding-top: 20px; border-top: 2px solid #2c3e7b; }
        .contract-header { text-align: right; margin-bottom: 30px; color: #666; }
        .article { margin: 15px 0; text-align: justify; }
    </style>
</head>
<body>${content}</body>
</html>`;

            const blob = new Blob([html], { type: 'text/html;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'è½¯ä»¶ä½¿ç”¨è®¸å¯åˆåŒ.html';
            link.click();
        }

        // è¾“å‡ºæ–¹æ¡ˆæ˜ç»†
        function exportPlanOnly() {
            // ç”Ÿæˆæ–¹æ¡ˆæ˜ç»†HTML
            let planHTML = `
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${(customers && customers[currentCustomerId] && customers[currentCustomerId].name && customers[currentCustomerId].name !== 'é»˜è®¤å®¢æˆ·') ? customers[currentCustomerId].name + ' - ' : ''}${localStorage.getItem('mainTitle') || 'å°åˆ·å…¨æµç¨‹è®¡åˆ’ä¹¦'} - æ–¹æ¡ˆé…ç½®</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif; background: #f5f7fa; color: #333; height: auto; min-height: auto; }
        .header { background: white; color: #333; padding: 15px 20px; display: flex; align-items: center; justify-content: center; gap: 20px; border-bottom: 2px solid #e0e0e0; }
        .header-logo { height: 50px; width: auto; }
        .header-text { text-align: left; }
        .header h1 { font-size: 20px; margin-bottom: 4px; font-weight: 400; color: #333; }
        .header p { font-size: 11px; color: #666; }
        .container { max-width: 100%; margin: 0 auto; padding: 15px; }
        .section { background: white; border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); }
        .section h2 { color: #2980b9; font-size: 16px; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 2px solid #3498db; }
        table { width: 100%; border-collapse: collapse; font-size: 11px; }
        th, td { padding: 6px 8px; text-align: center; border: 1px solid #ddd; }
        th { background: #2c5282; color: white; font-weight: 500; font-size: 10px; }
        .feature-col { text-align: left; background: #f8f9fa; font-weight: 500; min-width: 180px; font-size: 11px; }
        .category-row td { background: linear-gradient(135deg, #e8f6f3 0%, #d5f5e3 100%); font-weight: bold; color: #27ae60; text-align: left; font-size: 11px; }
        .price-row td { background: #fff8e6; color: #d35400; font-weight: bold; font-size: 12px; }
        .check { color: #27ae60; font-size: 14px; }
        .cross { color: #e74c3c; font-size: 14px; }
        .service-table { table-layout: fixed; width: 100%; }
        .service-table td { text-align: left; vertical-align: top; font-size: 11px; word-wrap: break-word; overflow-wrap: break-word; white-space: normal; }
        .service-table th:nth-child(1), .service-table td:nth-child(1) { width: 12%; font-weight: bold; color: #27ae60; }
        .service-table th:nth-child(2), .service-table td:nth-child(2) { width: 58%; }
        .service-table th:nth-child(3), .service-table td:nth-child(3) { width: 30%; text-align: right; font-weight: bold; color: #d35400; }
        .footer { text-align: center; padding: 10px; color: #666; font-size: 10px; }
        .btn-group { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; justify-content: center; }
        .btn { padding: 10px 20px; border: none; border-radius: 20px; cursor: pointer; font-size: 12px; font-weight: 500; background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); color: white; }
        @media print {
            @page { size: A4; margin: 10mm; }
            html, body { background: white !important; height: auto !important; min-height: auto !important; overflow: visible !important; }
            .header { background: white !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; padding: 12px 15px; border-bottom: 2px solid #e0e0e0; }
            .header h1 { font-size: 18px; }
            .header p { font-size: 9px; }
            .container { padding: 10px; }
            .section { box-shadow: none; padding: 10px; margin-bottom: 10px; page-break-inside: auto; }
            .section h2 { font-size: 14px; margin-bottom: 8px; color: #2980b9; }
            table { font-size: 9px; page-break-inside: auto; }
            tr { page-break-inside: avoid; page-break-after: auto; }
            thead { display: table-header-group; }
            th, td { padding: 4px 6px; }
            th { background: #2c5282 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; font-size: 9px; }
            .feature-col { min-width: 150px; font-size: 9px; }
            .category-row td { font-size: 9px; background: #d5f5e3 !important; color: #27ae60 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .price-row td { font-size: 10px; background: #fff8e6 !important; color: #d35400 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .check { font-size: 12px; color: #27ae60 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .cross { font-size: 12px; color: #e74c3c !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .service-table td { font-size: 9px; }
            .btn-group { display: none !important; }
            .footer { display: none !important; }
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="logo.png" alt="DMS Logo" class="header-logo">
        <div class="header-text">
            <h1>${(customers && customers[currentCustomerId] && customers[currentCustomerId].name && customers[currentCustomerId].name !== 'é»˜è®¤å®¢æˆ·') ? customers[currentCustomerId].name + ' - ' : ''}${localStorage.getItem('mainTitle') || 'å°åˆ·å…¨æµç¨‹è®¡åˆ’ä¹¦'}</h1>
            <p>${localStorage.getItem('mainSubtitle') || 'OPSæ¥å•åŠç”Ÿäº§ç®¡ç†ç³»ç»Ÿ & Tflowå°å‰è‡ªåŠ¨åŒ–ç³»ç»Ÿ - æ–¹æ¡ˆé…ç½®æ˜ç»†'}</p>
        </div>
    </div>
    <div class="container">
        <div class="section">
            <h2>ğŸ“‹ åŠŸèƒ½æ¨¡å—é…ç½®å¯¹æ¯”</h2>
            <table>
                <thead>
                    <tr>
                        <th class="feature-col">åŠŸèƒ½</th>`;
            
            // æ·»åŠ æ–¹æ¡ˆè¡¨å¤´
            plans.forEach(plan => {
                planHTML += `<th style="min-width: 150px;"><span style="font-size: 16px; font-weight: bold;">${plan.name}</span><br><span style="font-size: 12px; opacity: 0.8;">(${plan.subtitle})</span></th>`;
            });
            planHTML += `</tr></thead><tbody>`;
            
            // ä»·æ ¼è¡Œ
            planHTML += `<tr class="price-row"><td class="feature-col" style="color: #d35400;">ä»·æ ¼</td>`;
            plans.forEach(plan => {
                planHTML += `<td>${plan.price || 'å¾…å®š'}</td>`;
            });
            planHTML += `</tr>`;
            
            // å¤‡æ³¨è¡Œ
            planHTML += `<tr class="remark-row"><td class="feature-col" style="color: #666;">å¤‡æ³¨</td>`;
            plans.forEach(plan => {
                planHTML += `<td style="font-style: italic; color: #888;">${plan.remark || '-'}</td>`;
            });
            planHTML += `</tr>`;
            
            // åŠŸèƒ½è¡Œ
            features.forEach(category => {
                if (category.category) {
                    planHTML += `<tr class="category-row"><td colspan="${plans.length + 1}">${category.category}</td></tr>`;
                }
                category.features.forEach(feature => {
                    planHTML += `<tr><td class="feature-col">${feature.name}</td>`;
                    plans.forEach((plan, index) => {
                        const value = feature.values[index] || '';
                        if (value === 'âœ”') {
                            planHTML += `<td class="check">âœ”</td>`;
                        } else if (value === 'âœ˜') {
                            planHTML += `<td class="cross">âœ˜</td>`;
                        } else if (value && value !== '') {
                            planHTML += `<td style="color: #d35400; font-weight: bold;">${value}</td>`;
                        } else {
                            planHTML += `<td></td>`;
                        }
                    });
                    planHTML += `</tr>`;
                });
            });
            planHTML += `</tbody></table></div>`;
            
            // æœåŠ¡çº§åˆ«è¯´æ˜
            planHTML += `
        <div class="section">
            <h2>ğŸ› ï¸ æœåŠ¡çº§åˆ«è¯´æ˜</h2>
            <table class="service-table">
                <thead>
                    <tr>
                        <th>æœåŠ¡çº§åˆ«</th>
                        <th>æœåŠ¡å†…å®¹</th>
                        <th>ä»·æ ¼</th>
                    </tr>
                </thead>
                <tbody>`;
            
            services.forEach(service => {
                planHTML += `<tr>
                    <td>${service.level}</td>
                    <td style="white-space: pre-line;">${service.content}</td>
                    <td>${service.price}</td>
                </tr>`;
            });
            
            planHTML += `</tbody></table></div>
        <div class="btn-group">
            <button class="btn" onclick="window.print()">ğŸ–¨ï¸ æ‰“å°æ–¹æ¡ˆ</button>
        </div>
    </div>
    <div class="footer">
        <p>Deep Mind Solutions å¹¿å·å¤šæ™®ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸</p>
        <p>è”ç³»é‚®ç®±ï¼šinfo@deepmind.cn</p>
    </div>
</body>
</html>`;
            
            // æ‰“å¼€æ–°çª—å£æ˜¾ç¤ºæ–¹æ¡ˆæ˜ç»†
            const newWindow = window.open('', '_blank');
            newWindow.document.write(planHTML);
            newWindow.document.close();
        }

        // åˆå§‹åŒ–
        init();
    </script>
</body>
</html>
